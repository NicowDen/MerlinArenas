{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Node = void 0;\nconst Util_1 = require(\"./Util\");\nconst Factory_1 = require(\"./Factory\");\nconst Canvas_1 = require(\"./Canvas\");\nconst Global_1 = require(\"./Global\");\nconst DragAndDrop_1 = require(\"./DragAndDrop\");\nconst Validators_1 = require(\"./Validators\");\nvar ABSOLUTE_OPACITY = 'absoluteOpacity',\n  ALL_LISTENERS = 'allEventListeners',\n  ABSOLUTE_TRANSFORM = 'absoluteTransform',\n  ABSOLUTE_SCALE = 'absoluteScale',\n  CANVAS = 'canvas',\n  CHANGE = 'Change',\n  CHILDREN = 'children',\n  KONVA = 'konva',\n  LISTENING = 'listening',\n  MOUSEENTER = 'mouseenter',\n  MOUSELEAVE = 'mouseleave',\n  NAME = 'name',\n  SET = 'set',\n  SHAPE = 'Shape',\n  SPACE = ' ',\n  STAGE = 'stage',\n  TRANSFORM = 'transform',\n  UPPER_STAGE = 'Stage',\n  VISIBLE = 'visible',\n  TRANSFORM_CHANGE_STR = ['xChange.konva', 'yChange.konva', 'scaleXChange.konva', 'scaleYChange.konva', 'skewXChange.konva', 'skewYChange.konva', 'rotationChange.konva', 'offsetXChange.konva', 'offsetYChange.konva', 'transformsEnabledChange.konva'].join(SPACE);\nlet idCounter = 1;\nclass Node {\n  constructor(config) {\n    this._id = idCounter++;\n    this.eventListeners = {};\n    this.attrs = {};\n    this.index = 0;\n    this._allEventListeners = null;\n    this.parent = null;\n    this._cache = new Map();\n    this._attachedDepsListeners = new Map();\n    this._lastPos = null;\n    this._batchingTransformChange = false;\n    this._needClearTransformCache = false;\n    this._filterUpToDate = false;\n    this._isUnderCache = false;\n    this._dragEventId = null;\n    this._shouldFireChangeEvents = false;\n    this.setAttrs(config);\n    this._shouldFireChangeEvents = true;\n  }\n  hasChildren() {\n    return false;\n  }\n  _clearCache(attr) {\n    if ((attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM) && this._cache.get(attr)) {\n      this._cache.get(attr).dirty = true;\n    } else if (attr) {\n      this._cache.delete(attr);\n    } else {\n      this._cache.clear();\n    }\n  }\n  _getCache(attr, privateGetter) {\n    var cache = this._cache.get(attr);\n    var isTransform = attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM;\n    var invalid = cache === undefined || isTransform && cache.dirty === true;\n    if (invalid) {\n      cache = privateGetter.call(this);\n      this._cache.set(attr, cache);\n    }\n    return cache;\n  }\n  _calculate(name, deps, getter) {\n    if (!this._attachedDepsListeners.get(name)) {\n      const depsString = deps.map(dep => dep + 'Change.konva').join(SPACE);\n      this.on(depsString, () => {\n        this._clearCache(name);\n      });\n      this._attachedDepsListeners.set(name, true);\n    }\n    return this._getCache(name, getter);\n  }\n  _getCanvasCache() {\n    return this._cache.get(CANVAS);\n  }\n  _clearSelfAndDescendantCache(attr) {\n    this._clearCache(attr);\n    if (attr === ABSOLUTE_TRANSFORM) {\n      this.fire('absoluteTransformChange');\n    }\n  }\n  clearCache() {\n    if (this._cache.has(CANVAS)) {\n      const {\n        scene,\n        filter,\n        hit\n      } = this._cache.get(CANVAS);\n      Util_1.Util.releaseCanvas(scene, filter, hit);\n      this._cache.delete(CANVAS);\n    }\n    this._clearSelfAndDescendantCache();\n    this._requestDraw();\n    return this;\n  }\n  cache(config) {\n    var conf = config || {};\n    var rect = {};\n    if (conf.x === undefined || conf.y === undefined || conf.width === undefined || conf.height === undefined) {\n      rect = this.getClientRect({\n        skipTransform: true,\n        relativeTo: this.getParent()\n      });\n    }\n    var width = Math.ceil(conf.width || rect.width),\n      height = Math.ceil(conf.height || rect.height),\n      pixelRatio = conf.pixelRatio,\n      x = conf.x === undefined ? Math.floor(rect.x) : conf.x,\n      y = conf.y === undefined ? Math.floor(rect.y) : conf.y,\n      offset = conf.offset || 0,\n      drawBorder = conf.drawBorder || false,\n      hitCanvasPixelRatio = conf.hitCanvasPixelRatio || 1;\n    if (!width || !height) {\n      Util_1.Util.error('Can not cache the node. Width or height of the node equals 0. Caching is skipped.');\n      return;\n    }\n    width += offset * 2 + 1;\n    height += offset * 2 + 1;\n    x -= offset;\n    y -= offset;\n    var cachedSceneCanvas = new Canvas_1.SceneCanvas({\n        pixelRatio: pixelRatio,\n        width: width,\n        height: height\n      }),\n      cachedFilterCanvas = new Canvas_1.SceneCanvas({\n        pixelRatio: pixelRatio,\n        width: 0,\n        height: 0,\n        willReadFrequently: true\n      }),\n      cachedHitCanvas = new Canvas_1.HitCanvas({\n        pixelRatio: hitCanvasPixelRatio,\n        width: width,\n        height: height\n      }),\n      sceneContext = cachedSceneCanvas.getContext(),\n      hitContext = cachedHitCanvas.getContext();\n    cachedHitCanvas.isCache = true;\n    cachedSceneCanvas.isCache = true;\n    this._cache.delete(CANVAS);\n    this._filterUpToDate = false;\n    if (conf.imageSmoothingEnabled === false) {\n      cachedSceneCanvas.getContext()._context.imageSmoothingEnabled = false;\n      cachedFilterCanvas.getContext()._context.imageSmoothingEnabled = false;\n    }\n    sceneContext.save();\n    hitContext.save();\n    sceneContext.translate(-x, -y);\n    hitContext.translate(-x, -y);\n    this._isUnderCache = true;\n    this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n    this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n    this.drawScene(cachedSceneCanvas, this);\n    this.drawHit(cachedHitCanvas, this);\n    this._isUnderCache = false;\n    sceneContext.restore();\n    hitContext.restore();\n    if (drawBorder) {\n      sceneContext.save();\n      sceneContext.beginPath();\n      sceneContext.rect(0, 0, width, height);\n      sceneContext.closePath();\n      sceneContext.setAttr('strokeStyle', 'red');\n      sceneContext.setAttr('lineWidth', 5);\n      sceneContext.stroke();\n      sceneContext.restore();\n    }\n    this._cache.set(CANVAS, {\n      scene: cachedSceneCanvas,\n      filter: cachedFilterCanvas,\n      hit: cachedHitCanvas,\n      x: x,\n      y: y\n    });\n    this._requestDraw();\n    return this;\n  }\n  isCached() {\n    return this._cache.has(CANVAS);\n  }\n  getClientRect(config) {\n    throw new Error('abstract \"getClientRect\" method call');\n  }\n  _transformedRect(rect, top) {\n    var points = [{\n      x: rect.x,\n      y: rect.y\n    }, {\n      x: rect.x + rect.width,\n      y: rect.y\n    }, {\n      x: rect.x + rect.width,\n      y: rect.y + rect.height\n    }, {\n      x: rect.x,\n      y: rect.y + rect.height\n    }];\n    var minX, minY, maxX, maxY;\n    var trans = this.getAbsoluteTransform(top);\n    points.forEach(function (point) {\n      var transformed = trans.point(point);\n      if (minX === undefined) {\n        minX = maxX = transformed.x;\n        minY = maxY = transformed.y;\n      }\n      minX = Math.min(minX, transformed.x);\n      minY = Math.min(minY, transformed.y);\n      maxX = Math.max(maxX, transformed.x);\n      maxY = Math.max(maxY, transformed.y);\n    });\n    return {\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY\n    };\n  }\n  _drawCachedSceneCanvas(context) {\n    context.save();\n    context._applyOpacity(this);\n    context._applyGlobalCompositeOperation(this);\n    const canvasCache = this._getCanvasCache();\n    context.translate(canvasCache.x, canvasCache.y);\n    var cacheCanvas = this._getCachedSceneCanvas();\n    var ratio = cacheCanvas.pixelRatio;\n    context.drawImage(cacheCanvas._canvas, 0, 0, cacheCanvas.width / ratio, cacheCanvas.height / ratio);\n    context.restore();\n  }\n  _drawCachedHitCanvas(context) {\n    var canvasCache = this._getCanvasCache(),\n      hitCanvas = canvasCache.hit;\n    context.save();\n    context.translate(canvasCache.x, canvasCache.y);\n    context.drawImage(hitCanvas._canvas, 0, 0, hitCanvas.width / hitCanvas.pixelRatio, hitCanvas.height / hitCanvas.pixelRatio);\n    context.restore();\n  }\n  _getCachedSceneCanvas() {\n    var filters = this.filters(),\n      cachedCanvas = this._getCanvasCache(),\n      sceneCanvas = cachedCanvas.scene,\n      filterCanvas = cachedCanvas.filter,\n      filterContext = filterCanvas.getContext(),\n      len,\n      imageData,\n      n,\n      filter;\n    if (filters) {\n      if (!this._filterUpToDate) {\n        var ratio = sceneCanvas.pixelRatio;\n        filterCanvas.setSize(sceneCanvas.width / sceneCanvas.pixelRatio, sceneCanvas.height / sceneCanvas.pixelRatio);\n        try {\n          len = filters.length;\n          filterContext.clear();\n          filterContext.drawImage(sceneCanvas._canvas, 0, 0, sceneCanvas.getWidth() / ratio, sceneCanvas.getHeight() / ratio);\n          imageData = filterContext.getImageData(0, 0, filterCanvas.getWidth(), filterCanvas.getHeight());\n          for (n = 0; n < len; n++) {\n            filter = filters[n];\n            if (typeof filter !== 'function') {\n              Util_1.Util.error('Filter should be type of function, but got ' + typeof filter + ' instead. Please check correct filters');\n              continue;\n            }\n            filter.call(this, imageData);\n            filterContext.putImageData(imageData, 0, 0);\n          }\n        } catch (e) {\n          Util_1.Util.error('Unable to apply filter. ' + e.message + ' This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.');\n        }\n        this._filterUpToDate = true;\n      }\n      return filterCanvas;\n    }\n    return sceneCanvas;\n  }\n  on(evtStr, handler) {\n    this._cache && this._cache.delete(ALL_LISTENERS);\n    if (arguments.length === 3) {\n      return this._delegate.apply(this, arguments);\n    }\n    var events = evtStr.split(SPACE),\n      len = events.length,\n      n,\n      event,\n      parts,\n      baseEvent,\n      name;\n    for (n = 0; n < len; n++) {\n      event = events[n];\n      parts = event.split('.');\n      baseEvent = parts[0];\n      name = parts[1] || '';\n      if (!this.eventListeners[baseEvent]) {\n        this.eventListeners[baseEvent] = [];\n      }\n      this.eventListeners[baseEvent].push({\n        name: name,\n        handler: handler\n      });\n    }\n    return this;\n  }\n  off(evtStr, callback) {\n    var events = (evtStr || '').split(SPACE),\n      len = events.length,\n      n,\n      t,\n      event,\n      parts,\n      baseEvent,\n      name;\n    this._cache && this._cache.delete(ALL_LISTENERS);\n    if (!evtStr) {\n      for (t in this.eventListeners) {\n        this._off(t);\n      }\n    }\n    for (n = 0; n < len; n++) {\n      event = events[n];\n      parts = event.split('.');\n      baseEvent = parts[0];\n      name = parts[1];\n      if (baseEvent) {\n        if (this.eventListeners[baseEvent]) {\n          this._off(baseEvent, name, callback);\n        }\n      } else {\n        for (t in this.eventListeners) {\n          this._off(t, name, callback);\n        }\n      }\n    }\n    return this;\n  }\n  dispatchEvent(evt) {\n    var e = {\n      target: this,\n      type: evt.type,\n      evt: evt\n    };\n    this.fire(evt.type, e);\n    return this;\n  }\n  addEventListener(type, handler) {\n    this.on(type, function (evt) {\n      handler.call(this, evt.evt);\n    });\n    return this;\n  }\n  removeEventListener(type) {\n    this.off(type);\n    return this;\n  }\n  _delegate(event, selector, handler) {\n    var stopNode = this;\n    this.on(event, function (evt) {\n      var targets = evt.target.findAncestors(selector, true, stopNode);\n      for (var i = 0; i < targets.length; i++) {\n        evt = Util_1.Util.cloneObject(evt);\n        evt.currentTarget = targets[i];\n        handler.call(targets[i], evt);\n      }\n    });\n  }\n  remove() {\n    if (this.isDragging()) {\n      this.stopDrag();\n    }\n    DragAndDrop_1.DD._dragElements.delete(this._id);\n    this._remove();\n    return this;\n  }\n  _clearCaches() {\n    this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n    this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n    this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n    this._clearSelfAndDescendantCache(STAGE);\n    this._clearSelfAndDescendantCache(VISIBLE);\n    this._clearSelfAndDescendantCache(LISTENING);\n  }\n  _remove() {\n    this._clearCaches();\n    var parent = this.getParent();\n    if (parent && parent.children) {\n      parent.children.splice(this.index, 1);\n      parent._setChildrenIndices();\n      this.parent = null;\n    }\n  }\n  destroy() {\n    this.remove();\n    this.clearCache();\n    return this;\n  }\n  getAttr(attr) {\n    var method = 'get' + Util_1.Util._capitalize(attr);\n    if (Util_1.Util._isFunction(this[method])) {\n      return this[method]();\n    }\n    return this.attrs[attr];\n  }\n  getAncestors() {\n    var parent = this.getParent(),\n      ancestors = [];\n    while (parent) {\n      ancestors.push(parent);\n      parent = parent.getParent();\n    }\n    return ancestors;\n  }\n  getAttrs() {\n    return this.attrs || {};\n  }\n  setAttrs(config) {\n    this._batchTransformChanges(() => {\n      var key, method;\n      if (!config) {\n        return this;\n      }\n      for (key in config) {\n        if (key === CHILDREN) {\n          continue;\n        }\n        method = SET + Util_1.Util._capitalize(key);\n        if (Util_1.Util._isFunction(this[method])) {\n          this[method](config[key]);\n        } else {\n          this._setAttr(key, config[key]);\n        }\n      }\n    });\n    return this;\n  }\n  isListening() {\n    return this._getCache(LISTENING, this._isListening);\n  }\n  _isListening(relativeTo) {\n    const listening = this.listening();\n    if (!listening) {\n      return false;\n    }\n    const parent = this.getParent();\n    if (parent && parent !== relativeTo && this !== relativeTo) {\n      return parent._isListening(relativeTo);\n    } else {\n      return true;\n    }\n  }\n  isVisible() {\n    return this._getCache(VISIBLE, this._isVisible);\n  }\n  _isVisible(relativeTo) {\n    const visible = this.visible();\n    if (!visible) {\n      return false;\n    }\n    const parent = this.getParent();\n    if (parent && parent !== relativeTo && this !== relativeTo) {\n      return parent._isVisible(relativeTo);\n    } else {\n      return true;\n    }\n  }\n  shouldDrawHit(top) {\n    let skipDragCheck = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    if (top) {\n      return this._isVisible(top) && this._isListening(top);\n    }\n    var layer = this.getLayer();\n    var layerUnderDrag = false;\n    DragAndDrop_1.DD._dragElements.forEach(elem => {\n      if (elem.dragStatus !== 'dragging') {\n        return;\n      } else if (elem.node.nodeType === 'Stage') {\n        layerUnderDrag = true;\n      } else if (elem.node.getLayer() === layer) {\n        layerUnderDrag = true;\n      }\n    });\n    var dragSkip = !skipDragCheck && !Global_1.Konva.hitOnDragEnabled && layerUnderDrag;\n    return this.isListening() && this.isVisible() && !dragSkip;\n  }\n  show() {\n    this.visible(true);\n    return this;\n  }\n  hide() {\n    this.visible(false);\n    return this;\n  }\n  getZIndex() {\n    return this.index || 0;\n  }\n  getAbsoluteZIndex() {\n    var depth = this.getDepth(),\n      that = this,\n      index = 0,\n      nodes,\n      len,\n      n,\n      child;\n    function addChildren(children) {\n      nodes = [];\n      len = children.length;\n      for (n = 0; n < len; n++) {\n        child = children[n];\n        index++;\n        if (child.nodeType !== SHAPE) {\n          nodes = nodes.concat(child.getChildren().slice());\n        }\n        if (child._id === that._id) {\n          n = len;\n        }\n      }\n      if (nodes.length > 0 && nodes[0].getDepth() <= depth) {\n        addChildren(nodes);\n      }\n    }\n    if (that.nodeType !== UPPER_STAGE) {\n      addChildren(that.getStage().getChildren());\n    }\n    return index;\n  }\n  getDepth() {\n    var depth = 0,\n      parent = this.parent;\n    while (parent) {\n      depth++;\n      parent = parent.parent;\n    }\n    return depth;\n  }\n  _batchTransformChanges(func) {\n    this._batchingTransformChange = true;\n    func();\n    this._batchingTransformChange = false;\n    if (this._needClearTransformCache) {\n      this._clearCache(TRANSFORM);\n      this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n    }\n    this._needClearTransformCache = false;\n  }\n  setPosition(pos) {\n    this._batchTransformChanges(() => {\n      this.x(pos.x);\n      this.y(pos.y);\n    });\n    return this;\n  }\n  getPosition() {\n    return {\n      x: this.x(),\n      y: this.y()\n    };\n  }\n  getRelativePointerPosition() {\n    if (!this.getStage()) {\n      return null;\n    }\n    var pos = this.getStage().getPointerPosition();\n    if (!pos) {\n      return null;\n    }\n    var transform = this.getAbsoluteTransform().copy();\n    transform.invert();\n    return transform.point(pos);\n  }\n  getAbsolutePosition(top) {\n    let haveCachedParent = false;\n    let parent = this.parent;\n    while (parent) {\n      if (parent.isCached()) {\n        haveCachedParent = true;\n        break;\n      }\n      parent = parent.parent;\n    }\n    if (haveCachedParent && !top) {\n      top = true;\n    }\n    var absoluteMatrix = this.getAbsoluteTransform(top).getMatrix(),\n      absoluteTransform = new Util_1.Transform(),\n      offset = this.offset();\n    absoluteTransform.m = absoluteMatrix.slice();\n    absoluteTransform.translate(offset.x, offset.y);\n    return absoluteTransform.getTranslation();\n  }\n  setAbsolutePosition(pos) {\n    var origTrans = this._clearTransform();\n    this.attrs.x = origTrans.x;\n    this.attrs.y = origTrans.y;\n    delete origTrans.x;\n    delete origTrans.y;\n    this._clearCache(TRANSFORM);\n    var it = this._getAbsoluteTransform().copy();\n    it.invert();\n    it.translate(pos.x, pos.y);\n    pos = {\n      x: this.attrs.x + it.getTranslation().x,\n      y: this.attrs.y + it.getTranslation().y\n    };\n    this._setTransform(origTrans);\n    this.setPosition({\n      x: pos.x,\n      y: pos.y\n    });\n    this._clearCache(TRANSFORM);\n    this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n    return this;\n  }\n  _setTransform(trans) {\n    var key;\n    for (key in trans) {\n      this.attrs[key] = trans[key];\n    }\n  }\n  _clearTransform() {\n    var trans = {\n      x: this.x(),\n      y: this.y(),\n      rotation: this.rotation(),\n      scaleX: this.scaleX(),\n      scaleY: this.scaleY(),\n      offsetX: this.offsetX(),\n      offsetY: this.offsetY(),\n      skewX: this.skewX(),\n      skewY: this.skewY()\n    };\n    this.attrs.x = 0;\n    this.attrs.y = 0;\n    this.attrs.rotation = 0;\n    this.attrs.scaleX = 1;\n    this.attrs.scaleY = 1;\n    this.attrs.offsetX = 0;\n    this.attrs.offsetY = 0;\n    this.attrs.skewX = 0;\n    this.attrs.skewY = 0;\n    return trans;\n  }\n  move(change) {\n    var changeX = change.x,\n      changeY = change.y,\n      x = this.x(),\n      y = this.y();\n    if (changeX !== undefined) {\n      x += changeX;\n    }\n    if (changeY !== undefined) {\n      y += changeY;\n    }\n    this.setPosition({\n      x: x,\n      y: y\n    });\n    return this;\n  }\n  _eachAncestorReverse(func, top) {\n    var family = [],\n      parent = this.getParent(),\n      len,\n      n;\n    if (top && top._id === this._id) {\n      return;\n    }\n    family.unshift(this);\n    while (parent && (!top || parent._id !== top._id)) {\n      family.unshift(parent);\n      parent = parent.parent;\n    }\n    len = family.length;\n    for (n = 0; n < len; n++) {\n      func(family[n]);\n    }\n  }\n  rotate(theta) {\n    this.rotation(this.rotation() + theta);\n    return this;\n  }\n  moveToTop() {\n    if (!this.parent) {\n      Util_1.Util.warn('Node has no parent. moveToTop function is ignored.');\n      return false;\n    }\n    var index = this.index,\n      len = this.parent.getChildren().length;\n    if (index < len - 1) {\n      this.parent.children.splice(index, 1);\n      this.parent.children.push(this);\n      this.parent._setChildrenIndices();\n      return true;\n    }\n    return false;\n  }\n  moveUp() {\n    if (!this.parent) {\n      Util_1.Util.warn('Node has no parent. moveUp function is ignored.');\n      return false;\n    }\n    var index = this.index,\n      len = this.parent.getChildren().length;\n    if (index < len - 1) {\n      this.parent.children.splice(index, 1);\n      this.parent.children.splice(index + 1, 0, this);\n      this.parent._setChildrenIndices();\n      return true;\n    }\n    return false;\n  }\n  moveDown() {\n    if (!this.parent) {\n      Util_1.Util.warn('Node has no parent. moveDown function is ignored.');\n      return false;\n    }\n    var index = this.index;\n    if (index > 0) {\n      this.parent.children.splice(index, 1);\n      this.parent.children.splice(index - 1, 0, this);\n      this.parent._setChildrenIndices();\n      return true;\n    }\n    return false;\n  }\n  moveToBottom() {\n    if (!this.parent) {\n      Util_1.Util.warn('Node has no parent. moveToBottom function is ignored.');\n      return false;\n    }\n    var index = this.index;\n    if (index > 0) {\n      this.parent.children.splice(index, 1);\n      this.parent.children.unshift(this);\n      this.parent._setChildrenIndices();\n      return true;\n    }\n    return false;\n  }\n  setZIndex(zIndex) {\n    if (!this.parent) {\n      Util_1.Util.warn('Node has no parent. zIndex parameter is ignored.');\n      return this;\n    }\n    if (zIndex < 0 || zIndex >= this.parent.children.length) {\n      Util_1.Util.warn('Unexpected value ' + zIndex + ' for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to ' + (this.parent.children.length - 1) + '.');\n    }\n    var index = this.index;\n    this.parent.children.splice(index, 1);\n    this.parent.children.splice(zIndex, 0, this);\n    this.parent._setChildrenIndices();\n    return this;\n  }\n  getAbsoluteOpacity() {\n    return this._getCache(ABSOLUTE_OPACITY, this._getAbsoluteOpacity);\n  }\n  _getAbsoluteOpacity() {\n    var absOpacity = this.opacity();\n    var parent = this.getParent();\n    if (parent && !parent._isUnderCache) {\n      absOpacity *= parent.getAbsoluteOpacity();\n    }\n    return absOpacity;\n  }\n  moveTo(newContainer) {\n    if (this.getParent() !== newContainer) {\n      this._remove();\n      newContainer.add(this);\n    }\n    return this;\n  }\n  toObject() {\n    var obj = {},\n      attrs = this.getAttrs(),\n      key,\n      val,\n      getter,\n      defaultValue,\n      nonPlainObject;\n    obj.attrs = {};\n    for (key in attrs) {\n      val = attrs[key];\n      nonPlainObject = Util_1.Util.isObject(val) && !Util_1.Util._isPlainObject(val) && !Util_1.Util._isArray(val);\n      if (nonPlainObject) {\n        continue;\n      }\n      getter = typeof this[key] === 'function' && this[key];\n      delete attrs[key];\n      defaultValue = getter ? getter.call(this) : null;\n      attrs[key] = val;\n      if (defaultValue !== val) {\n        obj.attrs[key] = val;\n      }\n    }\n    obj.className = this.getClassName();\n    return Util_1.Util._prepareToStringify(obj);\n  }\n  toJSON() {\n    return JSON.stringify(this.toObject());\n  }\n  getParent() {\n    return this.parent;\n  }\n  findAncestors(selector, includeSelf, stopNode) {\n    var res = [];\n    if (includeSelf && this._isMatch(selector)) {\n      res.push(this);\n    }\n    var ancestor = this.parent;\n    while (ancestor) {\n      if (ancestor === stopNode) {\n        return res;\n      }\n      if (ancestor._isMatch(selector)) {\n        res.push(ancestor);\n      }\n      ancestor = ancestor.parent;\n    }\n    return res;\n  }\n  isAncestorOf(node) {\n    return false;\n  }\n  findAncestor(selector, includeSelf, stopNode) {\n    return this.findAncestors(selector, includeSelf, stopNode)[0];\n  }\n  _isMatch(selector) {\n    if (!selector) {\n      return false;\n    }\n    if (typeof selector === 'function') {\n      return selector(this);\n    }\n    var selectorArr = selector.replace(/ /g, '').split(','),\n      len = selectorArr.length,\n      n,\n      sel;\n    for (n = 0; n < len; n++) {\n      sel = selectorArr[n];\n      if (!Util_1.Util.isValidSelector(sel)) {\n        Util_1.Util.warn('Selector \"' + sel + '\" is invalid. Allowed selectors examples are \"#foo\", \".bar\" or \"Group\".');\n        Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like \"Triangle\".');\n        Util_1.Util.warn('Konva is awesome, right?');\n      }\n      if (sel.charAt(0) === '#') {\n        if (this.id() === sel.slice(1)) {\n          return true;\n        }\n      } else if (sel.charAt(0) === '.') {\n        if (this.hasName(sel.slice(1))) {\n          return true;\n        }\n      } else if (this.className === sel || this.nodeType === sel) {\n        return true;\n      }\n    }\n    return false;\n  }\n  getLayer() {\n    var parent = this.getParent();\n    return parent ? parent.getLayer() : null;\n  }\n  getStage() {\n    return this._getCache(STAGE, this._getStage);\n  }\n  _getStage() {\n    var parent = this.getParent();\n    if (parent) {\n      return parent.getStage();\n    } else {\n      return undefined;\n    }\n  }\n  fire(eventType) {\n    let evt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let bubble = arguments.length > 2 ? arguments[2] : undefined;\n    evt.target = evt.target || this;\n    if (bubble) {\n      this._fireAndBubble(eventType, evt);\n    } else {\n      this._fire(eventType, evt);\n    }\n    return this;\n  }\n  getAbsoluteTransform(top) {\n    if (top) {\n      return this._getAbsoluteTransform(top);\n    } else {\n      return this._getCache(ABSOLUTE_TRANSFORM, this._getAbsoluteTransform);\n    }\n  }\n  _getAbsoluteTransform(top) {\n    var at;\n    if (top) {\n      at = new Util_1.Transform();\n      this._eachAncestorReverse(function (node) {\n        var transformsEnabled = node.transformsEnabled();\n        if (transformsEnabled === 'all') {\n          at.multiply(node.getTransform());\n        } else if (transformsEnabled === 'position') {\n          at.translate(node.x() - node.offsetX(), node.y() - node.offsetY());\n        }\n      }, top);\n      return at;\n    } else {\n      at = this._cache.get(ABSOLUTE_TRANSFORM) || new Util_1.Transform();\n      if (this.parent) {\n        this.parent.getAbsoluteTransform().copyInto(at);\n      } else {\n        at.reset();\n      }\n      var transformsEnabled = this.transformsEnabled();\n      if (transformsEnabled === 'all') {\n        at.multiply(this.getTransform());\n      } else if (transformsEnabled === 'position') {\n        const x = this.attrs.x || 0;\n        const y = this.attrs.y || 0;\n        const offsetX = this.attrs.offsetX || 0;\n        const offsetY = this.attrs.offsetY || 0;\n        at.translate(x - offsetX, y - offsetY);\n      }\n      at.dirty = false;\n      return at;\n    }\n  }\n  getAbsoluteScale(top) {\n    var parent = this;\n    while (parent) {\n      if (parent._isUnderCache) {\n        top = parent;\n      }\n      parent = parent.getParent();\n    }\n    const transform = this.getAbsoluteTransform(top);\n    const attrs = transform.decompose();\n    return {\n      x: attrs.scaleX,\n      y: attrs.scaleY\n    };\n  }\n  getAbsoluteRotation() {\n    return this.getAbsoluteTransform().decompose().rotation;\n  }\n  getTransform() {\n    return this._getCache(TRANSFORM, this._getTransform);\n  }\n  _getTransform() {\n    var _a, _b;\n    var m = this._cache.get(TRANSFORM) || new Util_1.Transform();\n    m.reset();\n    var x = this.x(),\n      y = this.y(),\n      rotation = Global_1.Konva.getAngle(this.rotation()),\n      scaleX = (_a = this.attrs.scaleX) !== null && _a !== void 0 ? _a : 1,\n      scaleY = (_b = this.attrs.scaleY) !== null && _b !== void 0 ? _b : 1,\n      skewX = this.attrs.skewX || 0,\n      skewY = this.attrs.skewY || 0,\n      offsetX = this.attrs.offsetX || 0,\n      offsetY = this.attrs.offsetY || 0;\n    if (x !== 0 || y !== 0) {\n      m.translate(x, y);\n    }\n    if (rotation !== 0) {\n      m.rotate(rotation);\n    }\n    if (skewX !== 0 || skewY !== 0) {\n      m.skew(skewX, skewY);\n    }\n    if (scaleX !== 1 || scaleY !== 1) {\n      m.scale(scaleX, scaleY);\n    }\n    if (offsetX !== 0 || offsetY !== 0) {\n      m.translate(-1 * offsetX, -1 * offsetY);\n    }\n    m.dirty = false;\n    return m;\n  }\n  clone(obj) {\n    var attrs = Util_1.Util.cloneObject(this.attrs),\n      key,\n      allListeners,\n      len,\n      n,\n      listener;\n    for (key in obj) {\n      attrs[key] = obj[key];\n    }\n    var node = new this.constructor(attrs);\n    for (key in this.eventListeners) {\n      allListeners = this.eventListeners[key];\n      len = allListeners.length;\n      for (n = 0; n < len; n++) {\n        listener = allListeners[n];\n        if (listener.name.indexOf(KONVA) < 0) {\n          if (!node.eventListeners[key]) {\n            node.eventListeners[key] = [];\n          }\n          node.eventListeners[key].push(listener);\n        }\n      }\n    }\n    return node;\n  }\n  _toKonvaCanvas(config) {\n    config = config || {};\n    var box = this.getClientRect();\n    var stage = this.getStage(),\n      x = config.x !== undefined ? config.x : Math.floor(box.x),\n      y = config.y !== undefined ? config.y : Math.floor(box.y),\n      pixelRatio = config.pixelRatio || 1,\n      canvas = new Canvas_1.SceneCanvas({\n        width: config.width || Math.ceil(box.width) || (stage ? stage.width() : 0),\n        height: config.height || Math.ceil(box.height) || (stage ? stage.height() : 0),\n        pixelRatio: pixelRatio\n      }),\n      context = canvas.getContext();\n    if (config.imageSmoothingEnabled === false) {\n      context._context.imageSmoothingEnabled = false;\n    }\n    context.save();\n    if (x || y) {\n      context.translate(-1 * x, -1 * y);\n    }\n    this.drawScene(canvas);\n    context.restore();\n    return canvas;\n  }\n  toCanvas(config) {\n    return this._toKonvaCanvas(config)._canvas;\n  }\n  toDataURL(config) {\n    config = config || {};\n    var mimeType = config.mimeType || null,\n      quality = config.quality || null;\n    var url = this._toKonvaCanvas(config).toDataURL(mimeType, quality);\n    if (config.callback) {\n      config.callback(url);\n    }\n    return url;\n  }\n  toImage(config) {\n    return new Promise((resolve, reject) => {\n      try {\n        const callback = config === null || config === void 0 ? void 0 : config.callback;\n        if (callback) delete config.callback;\n        Util_1.Util._urlToImage(this.toDataURL(config), function (img) {\n          resolve(img);\n          callback === null || callback === void 0 ? void 0 : callback(img);\n        });\n      } catch (err) {\n        reject(err);\n      }\n    });\n  }\n  toBlob(config) {\n    return new Promise((resolve, reject) => {\n      try {\n        const callback = config === null || config === void 0 ? void 0 : config.callback;\n        if (callback) delete config.callback;\n        this.toCanvas(config).toBlob(blob => {\n          resolve(blob);\n          callback === null || callback === void 0 ? void 0 : callback(blob);\n        });\n      } catch (err) {\n        reject(err);\n      }\n    });\n  }\n  setSize(size) {\n    this.width(size.width);\n    this.height(size.height);\n    return this;\n  }\n  getSize() {\n    return {\n      width: this.width(),\n      height: this.height()\n    };\n  }\n  getClassName() {\n    return this.className || this.nodeType;\n  }\n  getType() {\n    return this.nodeType;\n  }\n  getDragDistance() {\n    if (this.attrs.dragDistance !== undefined) {\n      return this.attrs.dragDistance;\n    } else if (this.parent) {\n      return this.parent.getDragDistance();\n    } else {\n      return Global_1.Konva.dragDistance;\n    }\n  }\n  _off(type, name, callback) {\n    var evtListeners = this.eventListeners[type],\n      i,\n      evtName,\n      handler;\n    for (i = 0; i < evtListeners.length; i++) {\n      evtName = evtListeners[i].name;\n      handler = evtListeners[i].handler;\n      if ((evtName !== 'konva' || name === 'konva') && (!name || evtName === name) && (!callback || callback === handler)) {\n        evtListeners.splice(i, 1);\n        if (evtListeners.length === 0) {\n          delete this.eventListeners[type];\n          break;\n        }\n        i--;\n      }\n    }\n  }\n  _fireChangeEvent(attr, oldVal, newVal) {\n    this._fire(attr + CHANGE, {\n      oldVal: oldVal,\n      newVal: newVal\n    });\n  }\n  addName(name) {\n    if (!this.hasName(name)) {\n      var oldName = this.name();\n      var newName = oldName ? oldName + ' ' + name : name;\n      this.name(newName);\n    }\n    return this;\n  }\n  hasName(name) {\n    if (!name) {\n      return false;\n    }\n    const fullName = this.name();\n    if (!fullName) {\n      return false;\n    }\n    var names = (fullName || '').split(/\\s/g);\n    return names.indexOf(name) !== -1;\n  }\n  removeName(name) {\n    var names = (this.name() || '').split(/\\s/g);\n    var index = names.indexOf(name);\n    if (index !== -1) {\n      names.splice(index, 1);\n      this.name(names.join(' '));\n    }\n    return this;\n  }\n  setAttr(attr, val) {\n    var func = this[SET + Util_1.Util._capitalize(attr)];\n    if (Util_1.Util._isFunction(func)) {\n      func.call(this, val);\n    } else {\n      this._setAttr(attr, val);\n    }\n    return this;\n  }\n  _requestDraw() {\n    if (Global_1.Konva.autoDrawEnabled) {\n      const drawNode = this.getLayer() || this.getStage();\n      drawNode === null || drawNode === void 0 ? void 0 : drawNode.batchDraw();\n    }\n  }\n  _setAttr(key, val) {\n    var oldVal = this.attrs[key];\n    if (oldVal === val && !Util_1.Util.isObject(val)) {\n      return;\n    }\n    if (val === undefined || val === null) {\n      delete this.attrs[key];\n    } else {\n      this.attrs[key] = val;\n    }\n    if (this._shouldFireChangeEvents) {\n      this._fireChangeEvent(key, oldVal, val);\n    }\n    this._requestDraw();\n  }\n  _setComponentAttr(key, component, val) {\n    var oldVal;\n    if (val !== undefined) {\n      oldVal = this.attrs[key];\n      if (!oldVal) {\n        this.attrs[key] = this.getAttr(key);\n      }\n      this.attrs[key][component] = val;\n      this._fireChangeEvent(key, oldVal, val);\n    }\n  }\n  _fireAndBubble(eventType, evt, compareShape) {\n    if (evt && this.nodeType === SHAPE) {\n      evt.target = this;\n    }\n    var shouldStop = (eventType === MOUSEENTER || eventType === MOUSELEAVE) && (compareShape && (this === compareShape || this.isAncestorOf && this.isAncestorOf(compareShape)) || this.nodeType === 'Stage' && !compareShape);\n    if (!shouldStop) {\n      this._fire(eventType, evt);\n      var stopBubble = (eventType === MOUSEENTER || eventType === MOUSELEAVE) && compareShape && compareShape.isAncestorOf && compareShape.isAncestorOf(this) && !compareShape.isAncestorOf(this.parent);\n      if ((evt && !evt.cancelBubble || !evt) && this.parent && this.parent.isListening() && !stopBubble) {\n        if (compareShape && compareShape.parent) {\n          this._fireAndBubble.call(this.parent, eventType, evt, compareShape);\n        } else {\n          this._fireAndBubble.call(this.parent, eventType, evt);\n        }\n      }\n    }\n  }\n  _getProtoListeners(eventType) {\n    var _a, _b, _c;\n    const allListeners = (_a = this._cache.get(ALL_LISTENERS)) !== null && _a !== void 0 ? _a : {};\n    let events = allListeners === null || allListeners === void 0 ? void 0 : allListeners[eventType];\n    if (events === undefined) {\n      events = [];\n      let obj = Object.getPrototypeOf(this);\n      while (obj) {\n        const hierarchyEvents = (_c = (_b = obj.eventListeners) === null || _b === void 0 ? void 0 : _b[eventType]) !== null && _c !== void 0 ? _c : [];\n        events.push(...hierarchyEvents);\n        obj = Object.getPrototypeOf(obj);\n      }\n      allListeners[eventType] = events;\n      this._cache.set(ALL_LISTENERS, allListeners);\n    }\n    return events;\n  }\n  _fire(eventType, evt) {\n    evt = evt || {};\n    evt.currentTarget = this;\n    evt.type = eventType;\n    const topListeners = this._getProtoListeners(eventType);\n    if (topListeners) {\n      for (var i = 0; i < topListeners.length; i++) {\n        topListeners[i].handler.call(this, evt);\n      }\n    }\n    const selfListeners = this.eventListeners[eventType];\n    if (selfListeners) {\n      for (var i = 0; i < selfListeners.length; i++) {\n        selfListeners[i].handler.call(this, evt);\n      }\n    }\n  }\n  draw() {\n    this.drawScene();\n    this.drawHit();\n    return this;\n  }\n  _createDragElement(evt) {\n    var pointerId = evt ? evt.pointerId : undefined;\n    var stage = this.getStage();\n    var ap = this.getAbsolutePosition();\n    var pos = stage._getPointerById(pointerId) || stage._changedPointerPositions[0] || ap;\n    DragAndDrop_1.DD._dragElements.set(this._id, {\n      node: this,\n      startPointerPos: pos,\n      offset: {\n        x: pos.x - ap.x,\n        y: pos.y - ap.y\n      },\n      dragStatus: 'ready',\n      pointerId\n    });\n  }\n  startDrag(evt) {\n    let bubbleEvent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    if (!DragAndDrop_1.DD._dragElements.has(this._id)) {\n      this._createDragElement(evt);\n    }\n    const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n    elem.dragStatus = 'dragging';\n    this.fire('dragstart', {\n      type: 'dragstart',\n      target: this,\n      evt: evt && evt.evt\n    }, bubbleEvent);\n  }\n  _setDragPosition(evt, elem) {\n    const pos = this.getStage()._getPointerById(elem.pointerId);\n    if (!pos) {\n      return;\n    }\n    var newNodePos = {\n      x: pos.x - elem.offset.x,\n      y: pos.y - elem.offset.y\n    };\n    var dbf = this.dragBoundFunc();\n    if (dbf !== undefined) {\n      const bounded = dbf.call(this, newNodePos, evt);\n      if (!bounded) {\n        Util_1.Util.warn('dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.');\n      } else {\n        newNodePos = bounded;\n      }\n    }\n    if (!this._lastPos || this._lastPos.x !== newNodePos.x || this._lastPos.y !== newNodePos.y) {\n      this.setAbsolutePosition(newNodePos);\n      this._requestDraw();\n    }\n    this._lastPos = newNodePos;\n  }\n  stopDrag(evt) {\n    const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n    if (elem) {\n      elem.dragStatus = 'stopped';\n    }\n    DragAndDrop_1.DD._endDragBefore(evt);\n    DragAndDrop_1.DD._endDragAfter(evt);\n  }\n  setDraggable(draggable) {\n    this._setAttr('draggable', draggable);\n    this._dragChange();\n  }\n  isDragging() {\n    const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n    return elem ? elem.dragStatus === 'dragging' : false;\n  }\n  _listenDrag() {\n    this._dragCleanup();\n    this.on('mousedown.konva touchstart.konva', function (evt) {\n      var shouldCheckButton = evt.evt['button'] !== undefined;\n      var canDrag = !shouldCheckButton || Global_1.Konva.dragButtons.indexOf(evt.evt['button']) >= 0;\n      if (!canDrag) {\n        return;\n      }\n      if (this.isDragging()) {\n        return;\n      }\n      var hasDraggingChild = false;\n      DragAndDrop_1.DD._dragElements.forEach(elem => {\n        if (this.isAncestorOf(elem.node)) {\n          hasDraggingChild = true;\n        }\n      });\n      if (!hasDraggingChild) {\n        this._createDragElement(evt);\n      }\n    });\n  }\n  _dragChange() {\n    if (this.attrs.draggable) {\n      this._listenDrag();\n    } else {\n      this._dragCleanup();\n      var stage = this.getStage();\n      if (!stage) {\n        return;\n      }\n      const dragElement = DragAndDrop_1.DD._dragElements.get(this._id);\n      const isDragging = dragElement && dragElement.dragStatus === 'dragging';\n      const isReady = dragElement && dragElement.dragStatus === 'ready';\n      if (isDragging) {\n        this.stopDrag();\n      } else if (isReady) {\n        DragAndDrop_1.DD._dragElements.delete(this._id);\n      }\n    }\n  }\n  _dragCleanup() {\n    this.off('mousedown.konva');\n    this.off('touchstart.konva');\n  }\n  isClientRectOnScreen() {\n    let margin = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      x: 0,\n      y: 0\n    };\n    const stage = this.getStage();\n    if (!stage) {\n      return false;\n    }\n    const screenRect = {\n      x: -margin.x,\n      y: -margin.y,\n      width: stage.width() + 2 * margin.x,\n      height: stage.height() + 2 * margin.y\n    };\n    return Util_1.Util.haveIntersection(screenRect, this.getClientRect());\n  }\n  static create(data, container) {\n    if (Util_1.Util._isString(data)) {\n      data = JSON.parse(data);\n    }\n    return this._createNode(data, container);\n  }\n  static _createNode(obj, container) {\n    var className = Node.prototype.getClassName.call(obj),\n      children = obj.children,\n      no,\n      len,\n      n;\n    if (container) {\n      obj.attrs.container = container;\n    }\n    if (!Global_1.Konva[className]) {\n      Util_1.Util.warn('Can not find a node with class name \"' + className + '\". Fallback to \"Shape\".');\n      className = 'Shape';\n    }\n    const Class = Global_1.Konva[className];\n    no = new Class(obj.attrs);\n    if (children) {\n      len = children.length;\n      for (n = 0; n < len; n++) {\n        no.add(Node._createNode(children[n]));\n      }\n    }\n    return no;\n  }\n}\nexports.Node = Node;\nNode.prototype.nodeType = 'Node';\nNode.prototype._attrsAffectingSize = [];\nNode.prototype.eventListeners = {};\nNode.prototype.on.call(Node.prototype, TRANSFORM_CHANGE_STR, function () {\n  if (this._batchingTransformChange) {\n    this._needClearTransformCache = true;\n    return;\n  }\n  this._clearCache(TRANSFORM);\n  this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n});\nNode.prototype.on.call(Node.prototype, 'visibleChange.konva', function () {\n  this._clearSelfAndDescendantCache(VISIBLE);\n});\nNode.prototype.on.call(Node.prototype, 'listeningChange.konva', function () {\n  this._clearSelfAndDescendantCache(LISTENING);\n});\nNode.prototype.on.call(Node.prototype, 'opacityChange.konva', function () {\n  this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n});\nconst addGetterSetter = Factory_1.Factory.addGetterSetter;\naddGetterSetter(Node, 'zIndex');\naddGetterSetter(Node, 'absolutePosition');\naddGetterSetter(Node, 'position');\naddGetterSetter(Node, 'x', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'y', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'globalCompositeOperation', 'source-over', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'opacity', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'name', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'id', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'rotation', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'scale', ['x', 'y']);\naddGetterSetter(Node, 'scaleX', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'scaleY', 1, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'skew', ['x', 'y']);\naddGetterSetter(Node, 'skewX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'skewY', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'offset', ['x', 'y']);\naddGetterSetter(Node, 'offsetX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'offsetY', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'dragDistance', null, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'width', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'height', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'listening', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'preventDefault', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'filters', null, function (val) {\n  this._filterUpToDate = false;\n  return val;\n});\naddGetterSetter(Node, 'visible', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'transformsEnabled', 'all', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'size');\naddGetterSetter(Node, 'dragBoundFunc');\naddGetterSetter(Node, 'draggable', false, (0, Validators_1.getBooleanValidator)());\nFactory_1.Factory.backCompat(Node, {\n  rotateDeg: 'rotate',\n  setRotationDeg: 'setRotation',\n  getRotationDeg: 'getRotation'\n});","map":{"version":3,"names":["Object","defineProperty","exports","value","Node","Util_1","require","Factory_1","Canvas_1","Global_1","DragAndDrop_1","Validators_1","ABSOLUTE_OPACITY","ALL_LISTENERS","ABSOLUTE_TRANSFORM","ABSOLUTE_SCALE","CANVAS","CHANGE","CHILDREN","KONVA","LISTENING","MOUSEENTER","MOUSELEAVE","NAME","SET","SHAPE","SPACE","STAGE","TRANSFORM","UPPER_STAGE","VISIBLE","TRANSFORM_CHANGE_STR","join","idCounter","constructor","config","_id","eventListeners","attrs","index","_allEventListeners","parent","_cache","Map","_attachedDepsListeners","_lastPos","_batchingTransformChange","_needClearTransformCache","_filterUpToDate","_isUnderCache","_dragEventId","_shouldFireChangeEvents","setAttrs","hasChildren","_clearCache","attr","get","dirty","delete","clear","_getCache","privateGetter","cache","isTransform","invalid","undefined","call","set","_calculate","name","deps","getter","depsString","map","dep","on","_getCanvasCache","_clearSelfAndDescendantCache","fire","clearCache","has","scene","filter","hit","Util","releaseCanvas","_requestDraw","conf","rect","x","y","width","height","getClientRect","skipTransform","relativeTo","getParent","Math","ceil","pixelRatio","floor","offset","drawBorder","hitCanvasPixelRatio","error","cachedSceneCanvas","SceneCanvas","cachedFilterCanvas","willReadFrequently","cachedHitCanvas","HitCanvas","sceneContext","getContext","hitContext","isCache","imageSmoothingEnabled","_context","save","translate","drawScene","drawHit","restore","beginPath","closePath","setAttr","stroke","isCached","Error","_transformedRect","top","points","minX","minY","maxX","maxY","trans","getAbsoluteTransform","forEach","point","transformed","min","max","_drawCachedSceneCanvas","context","_applyOpacity","_applyGlobalCompositeOperation","canvasCache","cacheCanvas","_getCachedSceneCanvas","ratio","drawImage","_canvas","_drawCachedHitCanvas","hitCanvas","filters","cachedCanvas","sceneCanvas","filterCanvas","filterContext","len","imageData","n","setSize","length","getWidth","getHeight","getImageData","putImageData","e","message","evtStr","handler","arguments","_delegate","apply","events","split","event","parts","baseEvent","push","off","callback","t","_off","dispatchEvent","evt","target","type","addEventListener","removeEventListener","selector","stopNode","targets","findAncestors","i","cloneObject","currentTarget","remove","isDragging","stopDrag","DD","_dragElements","_remove","_clearCaches","children","splice","_setChildrenIndices","destroy","getAttr","method","_capitalize","_isFunction","getAncestors","ancestors","getAttrs","_batchTransformChanges","key","_setAttr","isListening","_isListening","listening","isVisible","_isVisible","visible","shouldDrawHit","skipDragCheck","layer","getLayer","layerUnderDrag","elem","dragStatus","node","nodeType","dragSkip","Konva","hitOnDragEnabled","show","hide","getZIndex","getAbsoluteZIndex","depth","getDepth","that","nodes","child","addChildren","concat","getChildren","slice","getStage","func","setPosition","pos","getPosition","getRelativePointerPosition","getPointerPosition","transform","copy","invert","getAbsolutePosition","haveCachedParent","absoluteMatrix","getMatrix","absoluteTransform","Transform","m","getTranslation","setAbsolutePosition","origTrans","_clearTransform","it","_getAbsoluteTransform","_setTransform","rotation","scaleX","scaleY","offsetX","offsetY","skewX","skewY","move","change","changeX","changeY","_eachAncestorReverse","family","unshift","rotate","theta","moveToTop","warn","moveUp","moveDown","moveToBottom","setZIndex","zIndex","getAbsoluteOpacity","_getAbsoluteOpacity","absOpacity","opacity","moveTo","newContainer","add","toObject","obj","val","defaultValue","nonPlainObject","isObject","_isPlainObject","_isArray","className","getClassName","_prepareToStringify","toJSON","JSON","stringify","includeSelf","res","_isMatch","ancestor","isAncestorOf","findAncestor","selectorArr","replace","sel","isValidSelector","charAt","id","hasName","_getStage","eventType","bubble","_fireAndBubble","_fire","at","transformsEnabled","multiply","getTransform","copyInto","reset","getAbsoluteScale","decompose","getAbsoluteRotation","_getTransform","_a","_b","getAngle","skew","scale","clone","allListeners","listener","indexOf","_toKonvaCanvas","box","stage","canvas","toCanvas","toDataURL","mimeType","quality","url","toImage","Promise","resolve","reject","_urlToImage","img","err","toBlob","blob","size","getSize","getType","getDragDistance","dragDistance","evtListeners","evtName","_fireChangeEvent","oldVal","newVal","addName","oldName","newName","fullName","names","removeName","autoDrawEnabled","drawNode","batchDraw","_setComponentAttr","component","compareShape","shouldStop","stopBubble","cancelBubble","_getProtoListeners","_c","getPrototypeOf","hierarchyEvents","topListeners","selfListeners","draw","_createDragElement","pointerId","ap","_getPointerById","_changedPointerPositions","startPointerPos","startDrag","bubbleEvent","_setDragPosition","newNodePos","dbf","dragBoundFunc","bounded","_endDragBefore","_endDragAfter","setDraggable","draggable","_dragChange","_listenDrag","_dragCleanup","shouldCheckButton","canDrag","dragButtons","hasDraggingChild","dragElement","isReady","isClientRectOnScreen","margin","screenRect","haveIntersection","create","data","container","_isString","parse","_createNode","prototype","no","Class","_attrsAffectingSize","addGetterSetter","Factory","getNumberValidator","getStringValidator","addComponentsGetterSetter","getBooleanValidator","backCompat","rotateDeg","setRotationDeg","getRotationDeg"],"sources":["/Users/nicolasgrenier/Documents/Code/fighting_RPG/node_modules/konva/lib/Node.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Node = void 0;\nconst Util_1 = require(\"./Util\");\nconst Factory_1 = require(\"./Factory\");\nconst Canvas_1 = require(\"./Canvas\");\nconst Global_1 = require(\"./Global\");\nconst DragAndDrop_1 = require(\"./DragAndDrop\");\nconst Validators_1 = require(\"./Validators\");\nvar ABSOLUTE_OPACITY = 'absoluteOpacity', ALL_LISTENERS = 'allEventListeners', ABSOLUTE_TRANSFORM = 'absoluteTransform', ABSOLUTE_SCALE = 'absoluteScale', CANVAS = 'canvas', CHANGE = 'Change', CHILDREN = 'children', KONVA = 'konva', LISTENING = 'listening', MOUSEENTER = 'mouseenter', MOUSELEAVE = 'mouseleave', NAME = 'name', SET = 'set', SHAPE = 'Shape', SPACE = ' ', STAGE = 'stage', TRANSFORM = 'transform', UPPER_STAGE = 'Stage', VISIBLE = 'visible', TRANSFORM_CHANGE_STR = [\n    'xChange.konva',\n    'yChange.konva',\n    'scaleXChange.konva',\n    'scaleYChange.konva',\n    'skewXChange.konva',\n    'skewYChange.konva',\n    'rotationChange.konva',\n    'offsetXChange.konva',\n    'offsetYChange.konva',\n    'transformsEnabledChange.konva',\n].join(SPACE);\nlet idCounter = 1;\nclass Node {\n    constructor(config) {\n        this._id = idCounter++;\n        this.eventListeners = {};\n        this.attrs = {};\n        this.index = 0;\n        this._allEventListeners = null;\n        this.parent = null;\n        this._cache = new Map();\n        this._attachedDepsListeners = new Map();\n        this._lastPos = null;\n        this._batchingTransformChange = false;\n        this._needClearTransformCache = false;\n        this._filterUpToDate = false;\n        this._isUnderCache = false;\n        this._dragEventId = null;\n        this._shouldFireChangeEvents = false;\n        this.setAttrs(config);\n        this._shouldFireChangeEvents = true;\n    }\n    hasChildren() {\n        return false;\n    }\n    _clearCache(attr) {\n        if ((attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM) &&\n            this._cache.get(attr)) {\n            this._cache.get(attr).dirty = true;\n        }\n        else if (attr) {\n            this._cache.delete(attr);\n        }\n        else {\n            this._cache.clear();\n        }\n    }\n    _getCache(attr, privateGetter) {\n        var cache = this._cache.get(attr);\n        var isTransform = attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM;\n        var invalid = cache === undefined || (isTransform && cache.dirty === true);\n        if (invalid) {\n            cache = privateGetter.call(this);\n            this._cache.set(attr, cache);\n        }\n        return cache;\n    }\n    _calculate(name, deps, getter) {\n        if (!this._attachedDepsListeners.get(name)) {\n            const depsString = deps.map((dep) => dep + 'Change.konva').join(SPACE);\n            this.on(depsString, () => {\n                this._clearCache(name);\n            });\n            this._attachedDepsListeners.set(name, true);\n        }\n        return this._getCache(name, getter);\n    }\n    _getCanvasCache() {\n        return this._cache.get(CANVAS);\n    }\n    _clearSelfAndDescendantCache(attr) {\n        this._clearCache(attr);\n        if (attr === ABSOLUTE_TRANSFORM) {\n            this.fire('absoluteTransformChange');\n        }\n    }\n    clearCache() {\n        if (this._cache.has(CANVAS)) {\n            const { scene, filter, hit } = this._cache.get(CANVAS);\n            Util_1.Util.releaseCanvas(scene, filter, hit);\n            this._cache.delete(CANVAS);\n        }\n        this._clearSelfAndDescendantCache();\n        this._requestDraw();\n        return this;\n    }\n    cache(config) {\n        var conf = config || {};\n        var rect = {};\n        if (conf.x === undefined ||\n            conf.y === undefined ||\n            conf.width === undefined ||\n            conf.height === undefined) {\n            rect = this.getClientRect({\n                skipTransform: true,\n                relativeTo: this.getParent(),\n            });\n        }\n        var width = Math.ceil(conf.width || rect.width), height = Math.ceil(conf.height || rect.height), pixelRatio = conf.pixelRatio, x = conf.x === undefined ? Math.floor(rect.x) : conf.x, y = conf.y === undefined ? Math.floor(rect.y) : conf.y, offset = conf.offset || 0, drawBorder = conf.drawBorder || false, hitCanvasPixelRatio = conf.hitCanvasPixelRatio || 1;\n        if (!width || !height) {\n            Util_1.Util.error('Can not cache the node. Width or height of the node equals 0. Caching is skipped.');\n            return;\n        }\n        width += offset * 2 + 1;\n        height += offset * 2 + 1;\n        x -= offset;\n        y -= offset;\n        var cachedSceneCanvas = new Canvas_1.SceneCanvas({\n            pixelRatio: pixelRatio,\n            width: width,\n            height: height,\n        }), cachedFilterCanvas = new Canvas_1.SceneCanvas({\n            pixelRatio: pixelRatio,\n            width: 0,\n            height: 0,\n            willReadFrequently: true,\n        }), cachedHitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: hitCanvasPixelRatio,\n            width: width,\n            height: height,\n        }), sceneContext = cachedSceneCanvas.getContext(), hitContext = cachedHitCanvas.getContext();\n        cachedHitCanvas.isCache = true;\n        cachedSceneCanvas.isCache = true;\n        this._cache.delete(CANVAS);\n        this._filterUpToDate = false;\n        if (conf.imageSmoothingEnabled === false) {\n            cachedSceneCanvas.getContext()._context.imageSmoothingEnabled = false;\n            cachedFilterCanvas.getContext()._context.imageSmoothingEnabled = false;\n        }\n        sceneContext.save();\n        hitContext.save();\n        sceneContext.translate(-x, -y);\n        hitContext.translate(-x, -y);\n        this._isUnderCache = true;\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        this.drawScene(cachedSceneCanvas, this);\n        this.drawHit(cachedHitCanvas, this);\n        this._isUnderCache = false;\n        sceneContext.restore();\n        hitContext.restore();\n        if (drawBorder) {\n            sceneContext.save();\n            sceneContext.beginPath();\n            sceneContext.rect(0, 0, width, height);\n            sceneContext.closePath();\n            sceneContext.setAttr('strokeStyle', 'red');\n            sceneContext.setAttr('lineWidth', 5);\n            sceneContext.stroke();\n            sceneContext.restore();\n        }\n        this._cache.set(CANVAS, {\n            scene: cachedSceneCanvas,\n            filter: cachedFilterCanvas,\n            hit: cachedHitCanvas,\n            x: x,\n            y: y,\n        });\n        this._requestDraw();\n        return this;\n    }\n    isCached() {\n        return this._cache.has(CANVAS);\n    }\n    getClientRect(config) {\n        throw new Error('abstract \"getClientRect\" method call');\n    }\n    _transformedRect(rect, top) {\n        var points = [\n            { x: rect.x, y: rect.y },\n            { x: rect.x + rect.width, y: rect.y },\n            { x: rect.x + rect.width, y: rect.y + rect.height },\n            { x: rect.x, y: rect.y + rect.height },\n        ];\n        var minX, minY, maxX, maxY;\n        var trans = this.getAbsoluteTransform(top);\n        points.forEach(function (point) {\n            var transformed = trans.point(point);\n            if (minX === undefined) {\n                minX = maxX = transformed.x;\n                minY = maxY = transformed.y;\n            }\n            minX = Math.min(minX, transformed.x);\n            minY = Math.min(minY, transformed.y);\n            maxX = Math.max(maxX, transformed.x);\n            maxY = Math.max(maxY, transformed.y);\n        });\n        return {\n            x: minX,\n            y: minY,\n            width: maxX - minX,\n            height: maxY - minY,\n        };\n    }\n    _drawCachedSceneCanvas(context) {\n        context.save();\n        context._applyOpacity(this);\n        context._applyGlobalCompositeOperation(this);\n        const canvasCache = this._getCanvasCache();\n        context.translate(canvasCache.x, canvasCache.y);\n        var cacheCanvas = this._getCachedSceneCanvas();\n        var ratio = cacheCanvas.pixelRatio;\n        context.drawImage(cacheCanvas._canvas, 0, 0, cacheCanvas.width / ratio, cacheCanvas.height / ratio);\n        context.restore();\n    }\n    _drawCachedHitCanvas(context) {\n        var canvasCache = this._getCanvasCache(), hitCanvas = canvasCache.hit;\n        context.save();\n        context.translate(canvasCache.x, canvasCache.y);\n        context.drawImage(hitCanvas._canvas, 0, 0, hitCanvas.width / hitCanvas.pixelRatio, hitCanvas.height / hitCanvas.pixelRatio);\n        context.restore();\n    }\n    _getCachedSceneCanvas() {\n        var filters = this.filters(), cachedCanvas = this._getCanvasCache(), sceneCanvas = cachedCanvas.scene, filterCanvas = cachedCanvas.filter, filterContext = filterCanvas.getContext(), len, imageData, n, filter;\n        if (filters) {\n            if (!this._filterUpToDate) {\n                var ratio = sceneCanvas.pixelRatio;\n                filterCanvas.setSize(sceneCanvas.width / sceneCanvas.pixelRatio, sceneCanvas.height / sceneCanvas.pixelRatio);\n                try {\n                    len = filters.length;\n                    filterContext.clear();\n                    filterContext.drawImage(sceneCanvas._canvas, 0, 0, sceneCanvas.getWidth() / ratio, sceneCanvas.getHeight() / ratio);\n                    imageData = filterContext.getImageData(0, 0, filterCanvas.getWidth(), filterCanvas.getHeight());\n                    for (n = 0; n < len; n++) {\n                        filter = filters[n];\n                        if (typeof filter !== 'function') {\n                            Util_1.Util.error('Filter should be type of function, but got ' +\n                                typeof filter +\n                                ' instead. Please check correct filters');\n                            continue;\n                        }\n                        filter.call(this, imageData);\n                        filterContext.putImageData(imageData, 0, 0);\n                    }\n                }\n                catch (e) {\n                    Util_1.Util.error('Unable to apply filter. ' +\n                        e.message +\n                        ' This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.');\n                }\n                this._filterUpToDate = true;\n            }\n            return filterCanvas;\n        }\n        return sceneCanvas;\n    }\n    on(evtStr, handler) {\n        this._cache && this._cache.delete(ALL_LISTENERS);\n        if (arguments.length === 3) {\n            return this._delegate.apply(this, arguments);\n        }\n        var events = evtStr.split(SPACE), len = events.length, n, event, parts, baseEvent, name;\n        for (n = 0; n < len; n++) {\n            event = events[n];\n            parts = event.split('.');\n            baseEvent = parts[0];\n            name = parts[1] || '';\n            if (!this.eventListeners[baseEvent]) {\n                this.eventListeners[baseEvent] = [];\n            }\n            this.eventListeners[baseEvent].push({\n                name: name,\n                handler: handler,\n            });\n        }\n        return this;\n    }\n    off(evtStr, callback) {\n        var events = (evtStr || '').split(SPACE), len = events.length, n, t, event, parts, baseEvent, name;\n        this._cache && this._cache.delete(ALL_LISTENERS);\n        if (!evtStr) {\n            for (t in this.eventListeners) {\n                this._off(t);\n            }\n        }\n        for (n = 0; n < len; n++) {\n            event = events[n];\n            parts = event.split('.');\n            baseEvent = parts[0];\n            name = parts[1];\n            if (baseEvent) {\n                if (this.eventListeners[baseEvent]) {\n                    this._off(baseEvent, name, callback);\n                }\n            }\n            else {\n                for (t in this.eventListeners) {\n                    this._off(t, name, callback);\n                }\n            }\n        }\n        return this;\n    }\n    dispatchEvent(evt) {\n        var e = {\n            target: this,\n            type: evt.type,\n            evt: evt,\n        };\n        this.fire(evt.type, e);\n        return this;\n    }\n    addEventListener(type, handler) {\n        this.on(type, function (evt) {\n            handler.call(this, evt.evt);\n        });\n        return this;\n    }\n    removeEventListener(type) {\n        this.off(type);\n        return this;\n    }\n    _delegate(event, selector, handler) {\n        var stopNode = this;\n        this.on(event, function (evt) {\n            var targets = evt.target.findAncestors(selector, true, stopNode);\n            for (var i = 0; i < targets.length; i++) {\n                evt = Util_1.Util.cloneObject(evt);\n                evt.currentTarget = targets[i];\n                handler.call(targets[i], evt);\n            }\n        });\n    }\n    remove() {\n        if (this.isDragging()) {\n            this.stopDrag();\n        }\n        DragAndDrop_1.DD._dragElements.delete(this._id);\n        this._remove();\n        return this;\n    }\n    _clearCaches() {\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        this._clearSelfAndDescendantCache(STAGE);\n        this._clearSelfAndDescendantCache(VISIBLE);\n        this._clearSelfAndDescendantCache(LISTENING);\n    }\n    _remove() {\n        this._clearCaches();\n        var parent = this.getParent();\n        if (parent && parent.children) {\n            parent.children.splice(this.index, 1);\n            parent._setChildrenIndices();\n            this.parent = null;\n        }\n    }\n    destroy() {\n        this.remove();\n        this.clearCache();\n        return this;\n    }\n    getAttr(attr) {\n        var method = 'get' + Util_1.Util._capitalize(attr);\n        if (Util_1.Util._isFunction(this[method])) {\n            return this[method]();\n        }\n        return this.attrs[attr];\n    }\n    getAncestors() {\n        var parent = this.getParent(), ancestors = [];\n        while (parent) {\n            ancestors.push(parent);\n            parent = parent.getParent();\n        }\n        return ancestors;\n    }\n    getAttrs() {\n        return this.attrs || {};\n    }\n    setAttrs(config) {\n        this._batchTransformChanges(() => {\n            var key, method;\n            if (!config) {\n                return this;\n            }\n            for (key in config) {\n                if (key === CHILDREN) {\n                    continue;\n                }\n                method = SET + Util_1.Util._capitalize(key);\n                if (Util_1.Util._isFunction(this[method])) {\n                    this[method](config[key]);\n                }\n                else {\n                    this._setAttr(key, config[key]);\n                }\n            }\n        });\n        return this;\n    }\n    isListening() {\n        return this._getCache(LISTENING, this._isListening);\n    }\n    _isListening(relativeTo) {\n        const listening = this.listening();\n        if (!listening) {\n            return false;\n        }\n        const parent = this.getParent();\n        if (parent && parent !== relativeTo && this !== relativeTo) {\n            return parent._isListening(relativeTo);\n        }\n        else {\n            return true;\n        }\n    }\n    isVisible() {\n        return this._getCache(VISIBLE, this._isVisible);\n    }\n    _isVisible(relativeTo) {\n        const visible = this.visible();\n        if (!visible) {\n            return false;\n        }\n        const parent = this.getParent();\n        if (parent && parent !== relativeTo && this !== relativeTo) {\n            return parent._isVisible(relativeTo);\n        }\n        else {\n            return true;\n        }\n    }\n    shouldDrawHit(top, skipDragCheck = false) {\n        if (top) {\n            return this._isVisible(top) && this._isListening(top);\n        }\n        var layer = this.getLayer();\n        var layerUnderDrag = false;\n        DragAndDrop_1.DD._dragElements.forEach((elem) => {\n            if (elem.dragStatus !== 'dragging') {\n                return;\n            }\n            else if (elem.node.nodeType === 'Stage') {\n                layerUnderDrag = true;\n            }\n            else if (elem.node.getLayer() === layer) {\n                layerUnderDrag = true;\n            }\n        });\n        var dragSkip = !skipDragCheck && !Global_1.Konva.hitOnDragEnabled && layerUnderDrag;\n        return this.isListening() && this.isVisible() && !dragSkip;\n    }\n    show() {\n        this.visible(true);\n        return this;\n    }\n    hide() {\n        this.visible(false);\n        return this;\n    }\n    getZIndex() {\n        return this.index || 0;\n    }\n    getAbsoluteZIndex() {\n        var depth = this.getDepth(), that = this, index = 0, nodes, len, n, child;\n        function addChildren(children) {\n            nodes = [];\n            len = children.length;\n            for (n = 0; n < len; n++) {\n                child = children[n];\n                index++;\n                if (child.nodeType !== SHAPE) {\n                    nodes = nodes.concat(child.getChildren().slice());\n                }\n                if (child._id === that._id) {\n                    n = len;\n                }\n            }\n            if (nodes.length > 0 && nodes[0].getDepth() <= depth) {\n                addChildren(nodes);\n            }\n        }\n        if (that.nodeType !== UPPER_STAGE) {\n            addChildren(that.getStage().getChildren());\n        }\n        return index;\n    }\n    getDepth() {\n        var depth = 0, parent = this.parent;\n        while (parent) {\n            depth++;\n            parent = parent.parent;\n        }\n        return depth;\n    }\n    _batchTransformChanges(func) {\n        this._batchingTransformChange = true;\n        func();\n        this._batchingTransformChange = false;\n        if (this._needClearTransformCache) {\n            this._clearCache(TRANSFORM);\n            this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        }\n        this._needClearTransformCache = false;\n    }\n    setPosition(pos) {\n        this._batchTransformChanges(() => {\n            this.x(pos.x);\n            this.y(pos.y);\n        });\n        return this;\n    }\n    getPosition() {\n        return {\n            x: this.x(),\n            y: this.y(),\n        };\n    }\n    getRelativePointerPosition() {\n        if (!this.getStage()) {\n            return null;\n        }\n        var pos = this.getStage().getPointerPosition();\n        if (!pos) {\n            return null;\n        }\n        var transform = this.getAbsoluteTransform().copy();\n        transform.invert();\n        return transform.point(pos);\n    }\n    getAbsolutePosition(top) {\n        let haveCachedParent = false;\n        let parent = this.parent;\n        while (parent) {\n            if (parent.isCached()) {\n                haveCachedParent = true;\n                break;\n            }\n            parent = parent.parent;\n        }\n        if (haveCachedParent && !top) {\n            top = true;\n        }\n        var absoluteMatrix = this.getAbsoluteTransform(top).getMatrix(), absoluteTransform = new Util_1.Transform(), offset = this.offset();\n        absoluteTransform.m = absoluteMatrix.slice();\n        absoluteTransform.translate(offset.x, offset.y);\n        return absoluteTransform.getTranslation();\n    }\n    setAbsolutePosition(pos) {\n        var origTrans = this._clearTransform();\n        this.attrs.x = origTrans.x;\n        this.attrs.y = origTrans.y;\n        delete origTrans.x;\n        delete origTrans.y;\n        this._clearCache(TRANSFORM);\n        var it = this._getAbsoluteTransform().copy();\n        it.invert();\n        it.translate(pos.x, pos.y);\n        pos = {\n            x: this.attrs.x + it.getTranslation().x,\n            y: this.attrs.y + it.getTranslation().y,\n        };\n        this._setTransform(origTrans);\n        this.setPosition({ x: pos.x, y: pos.y });\n        this._clearCache(TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        return this;\n    }\n    _setTransform(trans) {\n        var key;\n        for (key in trans) {\n            this.attrs[key] = trans[key];\n        }\n    }\n    _clearTransform() {\n        var trans = {\n            x: this.x(),\n            y: this.y(),\n            rotation: this.rotation(),\n            scaleX: this.scaleX(),\n            scaleY: this.scaleY(),\n            offsetX: this.offsetX(),\n            offsetY: this.offsetY(),\n            skewX: this.skewX(),\n            skewY: this.skewY(),\n        };\n        this.attrs.x = 0;\n        this.attrs.y = 0;\n        this.attrs.rotation = 0;\n        this.attrs.scaleX = 1;\n        this.attrs.scaleY = 1;\n        this.attrs.offsetX = 0;\n        this.attrs.offsetY = 0;\n        this.attrs.skewX = 0;\n        this.attrs.skewY = 0;\n        return trans;\n    }\n    move(change) {\n        var changeX = change.x, changeY = change.y, x = this.x(), y = this.y();\n        if (changeX !== undefined) {\n            x += changeX;\n        }\n        if (changeY !== undefined) {\n            y += changeY;\n        }\n        this.setPosition({ x: x, y: y });\n        return this;\n    }\n    _eachAncestorReverse(func, top) {\n        var family = [], parent = this.getParent(), len, n;\n        if (top && top._id === this._id) {\n            return;\n        }\n        family.unshift(this);\n        while (parent && (!top || parent._id !== top._id)) {\n            family.unshift(parent);\n            parent = parent.parent;\n        }\n        len = family.length;\n        for (n = 0; n < len; n++) {\n            func(family[n]);\n        }\n    }\n    rotate(theta) {\n        this.rotation(this.rotation() + theta);\n        return this;\n    }\n    moveToTop() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveToTop function is ignored.');\n            return false;\n        }\n        var index = this.index, len = this.parent.getChildren().length;\n        if (index < len - 1) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.push(this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    moveUp() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveUp function is ignored.');\n            return false;\n        }\n        var index = this.index, len = this.parent.getChildren().length;\n        if (index < len - 1) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.splice(index + 1, 0, this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    moveDown() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveDown function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        if (index > 0) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.splice(index - 1, 0, this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    moveToBottom() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveToBottom function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        if (index > 0) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.unshift(this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    setZIndex(zIndex) {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. zIndex parameter is ignored.');\n            return this;\n        }\n        if (zIndex < 0 || zIndex >= this.parent.children.length) {\n            Util_1.Util.warn('Unexpected value ' +\n                zIndex +\n                ' for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to ' +\n                (this.parent.children.length - 1) +\n                '.');\n        }\n        var index = this.index;\n        this.parent.children.splice(index, 1);\n        this.parent.children.splice(zIndex, 0, this);\n        this.parent._setChildrenIndices();\n        return this;\n    }\n    getAbsoluteOpacity() {\n        return this._getCache(ABSOLUTE_OPACITY, this._getAbsoluteOpacity);\n    }\n    _getAbsoluteOpacity() {\n        var absOpacity = this.opacity();\n        var parent = this.getParent();\n        if (parent && !parent._isUnderCache) {\n            absOpacity *= parent.getAbsoluteOpacity();\n        }\n        return absOpacity;\n    }\n    moveTo(newContainer) {\n        if (this.getParent() !== newContainer) {\n            this._remove();\n            newContainer.add(this);\n        }\n        return this;\n    }\n    toObject() {\n        var obj = {}, attrs = this.getAttrs(), key, val, getter, defaultValue, nonPlainObject;\n        obj.attrs = {};\n        for (key in attrs) {\n            val = attrs[key];\n            nonPlainObject =\n                Util_1.Util.isObject(val) && !Util_1.Util._isPlainObject(val) && !Util_1.Util._isArray(val);\n            if (nonPlainObject) {\n                continue;\n            }\n            getter = typeof this[key] === 'function' && this[key];\n            delete attrs[key];\n            defaultValue = getter ? getter.call(this) : null;\n            attrs[key] = val;\n            if (defaultValue !== val) {\n                obj.attrs[key] = val;\n            }\n        }\n        obj.className = this.getClassName();\n        return Util_1.Util._prepareToStringify(obj);\n    }\n    toJSON() {\n        return JSON.stringify(this.toObject());\n    }\n    getParent() {\n        return this.parent;\n    }\n    findAncestors(selector, includeSelf, stopNode) {\n        var res = [];\n        if (includeSelf && this._isMatch(selector)) {\n            res.push(this);\n        }\n        var ancestor = this.parent;\n        while (ancestor) {\n            if (ancestor === stopNode) {\n                return res;\n            }\n            if (ancestor._isMatch(selector)) {\n                res.push(ancestor);\n            }\n            ancestor = ancestor.parent;\n        }\n        return res;\n    }\n    isAncestorOf(node) {\n        return false;\n    }\n    findAncestor(selector, includeSelf, stopNode) {\n        return this.findAncestors(selector, includeSelf, stopNode)[0];\n    }\n    _isMatch(selector) {\n        if (!selector) {\n            return false;\n        }\n        if (typeof selector === 'function') {\n            return selector(this);\n        }\n        var selectorArr = selector.replace(/ /g, '').split(','), len = selectorArr.length, n, sel;\n        for (n = 0; n < len; n++) {\n            sel = selectorArr[n];\n            if (!Util_1.Util.isValidSelector(sel)) {\n                Util_1.Util.warn('Selector \"' +\n                    sel +\n                    '\" is invalid. Allowed selectors examples are \"#foo\", \".bar\" or \"Group\".');\n                Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like \"Triangle\".');\n                Util_1.Util.warn('Konva is awesome, right?');\n            }\n            if (sel.charAt(0) === '#') {\n                if (this.id() === sel.slice(1)) {\n                    return true;\n                }\n            }\n            else if (sel.charAt(0) === '.') {\n                if (this.hasName(sel.slice(1))) {\n                    return true;\n                }\n            }\n            else if (this.className === sel || this.nodeType === sel) {\n                return true;\n            }\n        }\n        return false;\n    }\n    getLayer() {\n        var parent = this.getParent();\n        return parent ? parent.getLayer() : null;\n    }\n    getStage() {\n        return this._getCache(STAGE, this._getStage);\n    }\n    _getStage() {\n        var parent = this.getParent();\n        if (parent) {\n            return parent.getStage();\n        }\n        else {\n            return undefined;\n        }\n    }\n    fire(eventType, evt = {}, bubble) {\n        evt.target = evt.target || this;\n        if (bubble) {\n            this._fireAndBubble(eventType, evt);\n        }\n        else {\n            this._fire(eventType, evt);\n        }\n        return this;\n    }\n    getAbsoluteTransform(top) {\n        if (top) {\n            return this._getAbsoluteTransform(top);\n        }\n        else {\n            return this._getCache(ABSOLUTE_TRANSFORM, this._getAbsoluteTransform);\n        }\n    }\n    _getAbsoluteTransform(top) {\n        var at;\n        if (top) {\n            at = new Util_1.Transform();\n            this._eachAncestorReverse(function (node) {\n                var transformsEnabled = node.transformsEnabled();\n                if (transformsEnabled === 'all') {\n                    at.multiply(node.getTransform());\n                }\n                else if (transformsEnabled === 'position') {\n                    at.translate(node.x() - node.offsetX(), node.y() - node.offsetY());\n                }\n            }, top);\n            return at;\n        }\n        else {\n            at = this._cache.get(ABSOLUTE_TRANSFORM) || new Util_1.Transform();\n            if (this.parent) {\n                this.parent.getAbsoluteTransform().copyInto(at);\n            }\n            else {\n                at.reset();\n            }\n            var transformsEnabled = this.transformsEnabled();\n            if (transformsEnabled === 'all') {\n                at.multiply(this.getTransform());\n            }\n            else if (transformsEnabled === 'position') {\n                const x = this.attrs.x || 0;\n                const y = this.attrs.y || 0;\n                const offsetX = this.attrs.offsetX || 0;\n                const offsetY = this.attrs.offsetY || 0;\n                at.translate(x - offsetX, y - offsetY);\n            }\n            at.dirty = false;\n            return at;\n        }\n    }\n    getAbsoluteScale(top) {\n        var parent = this;\n        while (parent) {\n            if (parent._isUnderCache) {\n                top = parent;\n            }\n            parent = parent.getParent();\n        }\n        const transform = this.getAbsoluteTransform(top);\n        const attrs = transform.decompose();\n        return {\n            x: attrs.scaleX,\n            y: attrs.scaleY,\n        };\n    }\n    getAbsoluteRotation() {\n        return this.getAbsoluteTransform().decompose().rotation;\n    }\n    getTransform() {\n        return this._getCache(TRANSFORM, this._getTransform);\n    }\n    _getTransform() {\n        var _a, _b;\n        var m = this._cache.get(TRANSFORM) || new Util_1.Transform();\n        m.reset();\n        var x = this.x(), y = this.y(), rotation = Global_1.Konva.getAngle(this.rotation()), scaleX = (_a = this.attrs.scaleX) !== null && _a !== void 0 ? _a : 1, scaleY = (_b = this.attrs.scaleY) !== null && _b !== void 0 ? _b : 1, skewX = this.attrs.skewX || 0, skewY = this.attrs.skewY || 0, offsetX = this.attrs.offsetX || 0, offsetY = this.attrs.offsetY || 0;\n        if (x !== 0 || y !== 0) {\n            m.translate(x, y);\n        }\n        if (rotation !== 0) {\n            m.rotate(rotation);\n        }\n        if (skewX !== 0 || skewY !== 0) {\n            m.skew(skewX, skewY);\n        }\n        if (scaleX !== 1 || scaleY !== 1) {\n            m.scale(scaleX, scaleY);\n        }\n        if (offsetX !== 0 || offsetY !== 0) {\n            m.translate(-1 * offsetX, -1 * offsetY);\n        }\n        m.dirty = false;\n        return m;\n    }\n    clone(obj) {\n        var attrs = Util_1.Util.cloneObject(this.attrs), key, allListeners, len, n, listener;\n        for (key in obj) {\n            attrs[key] = obj[key];\n        }\n        var node = new this.constructor(attrs);\n        for (key in this.eventListeners) {\n            allListeners = this.eventListeners[key];\n            len = allListeners.length;\n            for (n = 0; n < len; n++) {\n                listener = allListeners[n];\n                if (listener.name.indexOf(KONVA) < 0) {\n                    if (!node.eventListeners[key]) {\n                        node.eventListeners[key] = [];\n                    }\n                    node.eventListeners[key].push(listener);\n                }\n            }\n        }\n        return node;\n    }\n    _toKonvaCanvas(config) {\n        config = config || {};\n        var box = this.getClientRect();\n        var stage = this.getStage(), x = config.x !== undefined ? config.x : Math.floor(box.x), y = config.y !== undefined ? config.y : Math.floor(box.y), pixelRatio = config.pixelRatio || 1, canvas = new Canvas_1.SceneCanvas({\n            width: config.width || Math.ceil(box.width) || (stage ? stage.width() : 0),\n            height: config.height ||\n                Math.ceil(box.height) ||\n                (stage ? stage.height() : 0),\n            pixelRatio: pixelRatio,\n        }), context = canvas.getContext();\n        if (config.imageSmoothingEnabled === false) {\n            context._context.imageSmoothingEnabled = false;\n        }\n        context.save();\n        if (x || y) {\n            context.translate(-1 * x, -1 * y);\n        }\n        this.drawScene(canvas);\n        context.restore();\n        return canvas;\n    }\n    toCanvas(config) {\n        return this._toKonvaCanvas(config)._canvas;\n    }\n    toDataURL(config) {\n        config = config || {};\n        var mimeType = config.mimeType || null, quality = config.quality || null;\n        var url = this._toKonvaCanvas(config).toDataURL(mimeType, quality);\n        if (config.callback) {\n            config.callback(url);\n        }\n        return url;\n    }\n    toImage(config) {\n        return new Promise((resolve, reject) => {\n            try {\n                const callback = config === null || config === void 0 ? void 0 : config.callback;\n                if (callback)\n                    delete config.callback;\n                Util_1.Util._urlToImage(this.toDataURL(config), function (img) {\n                    resolve(img);\n                    callback === null || callback === void 0 ? void 0 : callback(img);\n                });\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n    toBlob(config) {\n        return new Promise((resolve, reject) => {\n            try {\n                const callback = config === null || config === void 0 ? void 0 : config.callback;\n                if (callback)\n                    delete config.callback;\n                this.toCanvas(config).toBlob((blob) => {\n                    resolve(blob);\n                    callback === null || callback === void 0 ? void 0 : callback(blob);\n                });\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n    setSize(size) {\n        this.width(size.width);\n        this.height(size.height);\n        return this;\n    }\n    getSize() {\n        return {\n            width: this.width(),\n            height: this.height(),\n        };\n    }\n    getClassName() {\n        return this.className || this.nodeType;\n    }\n    getType() {\n        return this.nodeType;\n    }\n    getDragDistance() {\n        if (this.attrs.dragDistance !== undefined) {\n            return this.attrs.dragDistance;\n        }\n        else if (this.parent) {\n            return this.parent.getDragDistance();\n        }\n        else {\n            return Global_1.Konva.dragDistance;\n        }\n    }\n    _off(type, name, callback) {\n        var evtListeners = this.eventListeners[type], i, evtName, handler;\n        for (i = 0; i < evtListeners.length; i++) {\n            evtName = evtListeners[i].name;\n            handler = evtListeners[i].handler;\n            if ((evtName !== 'konva' || name === 'konva') &&\n                (!name || evtName === name) &&\n                (!callback || callback === handler)) {\n                evtListeners.splice(i, 1);\n                if (evtListeners.length === 0) {\n                    delete this.eventListeners[type];\n                    break;\n                }\n                i--;\n            }\n        }\n    }\n    _fireChangeEvent(attr, oldVal, newVal) {\n        this._fire(attr + CHANGE, {\n            oldVal: oldVal,\n            newVal: newVal,\n        });\n    }\n    addName(name) {\n        if (!this.hasName(name)) {\n            var oldName = this.name();\n            var newName = oldName ? oldName + ' ' + name : name;\n            this.name(newName);\n        }\n        return this;\n    }\n    hasName(name) {\n        if (!name) {\n            return false;\n        }\n        const fullName = this.name();\n        if (!fullName) {\n            return false;\n        }\n        var names = (fullName || '').split(/\\s/g);\n        return names.indexOf(name) !== -1;\n    }\n    removeName(name) {\n        var names = (this.name() || '').split(/\\s/g);\n        var index = names.indexOf(name);\n        if (index !== -1) {\n            names.splice(index, 1);\n            this.name(names.join(' '));\n        }\n        return this;\n    }\n    setAttr(attr, val) {\n        var func = this[SET + Util_1.Util._capitalize(attr)];\n        if (Util_1.Util._isFunction(func)) {\n            func.call(this, val);\n        }\n        else {\n            this._setAttr(attr, val);\n        }\n        return this;\n    }\n    _requestDraw() {\n        if (Global_1.Konva.autoDrawEnabled) {\n            const drawNode = this.getLayer() || this.getStage();\n            drawNode === null || drawNode === void 0 ? void 0 : drawNode.batchDraw();\n        }\n    }\n    _setAttr(key, val) {\n        var oldVal = this.attrs[key];\n        if (oldVal === val && !Util_1.Util.isObject(val)) {\n            return;\n        }\n        if (val === undefined || val === null) {\n            delete this.attrs[key];\n        }\n        else {\n            this.attrs[key] = val;\n        }\n        if (this._shouldFireChangeEvents) {\n            this._fireChangeEvent(key, oldVal, val);\n        }\n        this._requestDraw();\n    }\n    _setComponentAttr(key, component, val) {\n        var oldVal;\n        if (val !== undefined) {\n            oldVal = this.attrs[key];\n            if (!oldVal) {\n                this.attrs[key] = this.getAttr(key);\n            }\n            this.attrs[key][component] = val;\n            this._fireChangeEvent(key, oldVal, val);\n        }\n    }\n    _fireAndBubble(eventType, evt, compareShape) {\n        if (evt && this.nodeType === SHAPE) {\n            evt.target = this;\n        }\n        var shouldStop = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\n            ((compareShape &&\n                (this === compareShape ||\n                    (this.isAncestorOf && this.isAncestorOf(compareShape)))) ||\n                (this.nodeType === 'Stage' && !compareShape));\n        if (!shouldStop) {\n            this._fire(eventType, evt);\n            var stopBubble = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\n                compareShape &&\n                compareShape.isAncestorOf &&\n                compareShape.isAncestorOf(this) &&\n                !compareShape.isAncestorOf(this.parent);\n            if (((evt && !evt.cancelBubble) || !evt) &&\n                this.parent &&\n                this.parent.isListening() &&\n                !stopBubble) {\n                if (compareShape && compareShape.parent) {\n                    this._fireAndBubble.call(this.parent, eventType, evt, compareShape);\n                }\n                else {\n                    this._fireAndBubble.call(this.parent, eventType, evt);\n                }\n            }\n        }\n    }\n    _getProtoListeners(eventType) {\n        var _a, _b, _c;\n        const allListeners = (_a = this._cache.get(ALL_LISTENERS)) !== null && _a !== void 0 ? _a : {};\n        let events = allListeners === null || allListeners === void 0 ? void 0 : allListeners[eventType];\n        if (events === undefined) {\n            events = [];\n            let obj = Object.getPrototypeOf(this);\n            while (obj) {\n                const hierarchyEvents = (_c = (_b = obj.eventListeners) === null || _b === void 0 ? void 0 : _b[eventType]) !== null && _c !== void 0 ? _c : [];\n                events.push(...hierarchyEvents);\n                obj = Object.getPrototypeOf(obj);\n            }\n            allListeners[eventType] = events;\n            this._cache.set(ALL_LISTENERS, allListeners);\n        }\n        return events;\n    }\n    _fire(eventType, evt) {\n        evt = evt || {};\n        evt.currentTarget = this;\n        evt.type = eventType;\n        const topListeners = this._getProtoListeners(eventType);\n        if (topListeners) {\n            for (var i = 0; i < topListeners.length; i++) {\n                topListeners[i].handler.call(this, evt);\n            }\n        }\n        const selfListeners = this.eventListeners[eventType];\n        if (selfListeners) {\n            for (var i = 0; i < selfListeners.length; i++) {\n                selfListeners[i].handler.call(this, evt);\n            }\n        }\n    }\n    draw() {\n        this.drawScene();\n        this.drawHit();\n        return this;\n    }\n    _createDragElement(evt) {\n        var pointerId = evt ? evt.pointerId : undefined;\n        var stage = this.getStage();\n        var ap = this.getAbsolutePosition();\n        var pos = stage._getPointerById(pointerId) ||\n            stage._changedPointerPositions[0] ||\n            ap;\n        DragAndDrop_1.DD._dragElements.set(this._id, {\n            node: this,\n            startPointerPos: pos,\n            offset: {\n                x: pos.x - ap.x,\n                y: pos.y - ap.y,\n            },\n            dragStatus: 'ready',\n            pointerId,\n        });\n    }\n    startDrag(evt, bubbleEvent = true) {\n        if (!DragAndDrop_1.DD._dragElements.has(this._id)) {\n            this._createDragElement(evt);\n        }\n        const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        elem.dragStatus = 'dragging';\n        this.fire('dragstart', {\n            type: 'dragstart',\n            target: this,\n            evt: evt && evt.evt,\n        }, bubbleEvent);\n    }\n    _setDragPosition(evt, elem) {\n        const pos = this.getStage()._getPointerById(elem.pointerId);\n        if (!pos) {\n            return;\n        }\n        var newNodePos = {\n            x: pos.x - elem.offset.x,\n            y: pos.y - elem.offset.y,\n        };\n        var dbf = this.dragBoundFunc();\n        if (dbf !== undefined) {\n            const bounded = dbf.call(this, newNodePos, evt);\n            if (!bounded) {\n                Util_1.Util.warn('dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.');\n            }\n            else {\n                newNodePos = bounded;\n            }\n        }\n        if (!this._lastPos ||\n            this._lastPos.x !== newNodePos.x ||\n            this._lastPos.y !== newNodePos.y) {\n            this.setAbsolutePosition(newNodePos);\n            this._requestDraw();\n        }\n        this._lastPos = newNodePos;\n    }\n    stopDrag(evt) {\n        const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        if (elem) {\n            elem.dragStatus = 'stopped';\n        }\n        DragAndDrop_1.DD._endDragBefore(evt);\n        DragAndDrop_1.DD._endDragAfter(evt);\n    }\n    setDraggable(draggable) {\n        this._setAttr('draggable', draggable);\n        this._dragChange();\n    }\n    isDragging() {\n        const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        return elem ? elem.dragStatus === 'dragging' : false;\n    }\n    _listenDrag() {\n        this._dragCleanup();\n        this.on('mousedown.konva touchstart.konva', function (evt) {\n            var shouldCheckButton = evt.evt['button'] !== undefined;\n            var canDrag = !shouldCheckButton || Global_1.Konva.dragButtons.indexOf(evt.evt['button']) >= 0;\n            if (!canDrag) {\n                return;\n            }\n            if (this.isDragging()) {\n                return;\n            }\n            var hasDraggingChild = false;\n            DragAndDrop_1.DD._dragElements.forEach((elem) => {\n                if (this.isAncestorOf(elem.node)) {\n                    hasDraggingChild = true;\n                }\n            });\n            if (!hasDraggingChild) {\n                this._createDragElement(evt);\n            }\n        });\n    }\n    _dragChange() {\n        if (this.attrs.draggable) {\n            this._listenDrag();\n        }\n        else {\n            this._dragCleanup();\n            var stage = this.getStage();\n            if (!stage) {\n                return;\n            }\n            const dragElement = DragAndDrop_1.DD._dragElements.get(this._id);\n            const isDragging = dragElement && dragElement.dragStatus === 'dragging';\n            const isReady = dragElement && dragElement.dragStatus === 'ready';\n            if (isDragging) {\n                this.stopDrag();\n            }\n            else if (isReady) {\n                DragAndDrop_1.DD._dragElements.delete(this._id);\n            }\n        }\n    }\n    _dragCleanup() {\n        this.off('mousedown.konva');\n        this.off('touchstart.konva');\n    }\n    isClientRectOnScreen(margin = { x: 0, y: 0 }) {\n        const stage = this.getStage();\n        if (!stage) {\n            return false;\n        }\n        const screenRect = {\n            x: -margin.x,\n            y: -margin.y,\n            width: stage.width() + 2 * margin.x,\n            height: stage.height() + 2 * margin.y,\n        };\n        return Util_1.Util.haveIntersection(screenRect, this.getClientRect());\n    }\n    static create(data, container) {\n        if (Util_1.Util._isString(data)) {\n            data = JSON.parse(data);\n        }\n        return this._createNode(data, container);\n    }\n    static _createNode(obj, container) {\n        var className = Node.prototype.getClassName.call(obj), children = obj.children, no, len, n;\n        if (container) {\n            obj.attrs.container = container;\n        }\n        if (!Global_1.Konva[className]) {\n            Util_1.Util.warn('Can not find a node with class name \"' +\n                className +\n                '\". Fallback to \"Shape\".');\n            className = 'Shape';\n        }\n        const Class = Global_1.Konva[className];\n        no = new Class(obj.attrs);\n        if (children) {\n            len = children.length;\n            for (n = 0; n < len; n++) {\n                no.add(Node._createNode(children[n]));\n            }\n        }\n        return no;\n    }\n}\nexports.Node = Node;\nNode.prototype.nodeType = 'Node';\nNode.prototype._attrsAffectingSize = [];\nNode.prototype.eventListeners = {};\nNode.prototype.on.call(Node.prototype, TRANSFORM_CHANGE_STR, function () {\n    if (this._batchingTransformChange) {\n        this._needClearTransformCache = true;\n        return;\n    }\n    this._clearCache(TRANSFORM);\n    this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n});\nNode.prototype.on.call(Node.prototype, 'visibleChange.konva', function () {\n    this._clearSelfAndDescendantCache(VISIBLE);\n});\nNode.prototype.on.call(Node.prototype, 'listeningChange.konva', function () {\n    this._clearSelfAndDescendantCache(LISTENING);\n});\nNode.prototype.on.call(Node.prototype, 'opacityChange.konva', function () {\n    this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n});\nconst addGetterSetter = Factory_1.Factory.addGetterSetter;\naddGetterSetter(Node, 'zIndex');\naddGetterSetter(Node, 'absolutePosition');\naddGetterSetter(Node, 'position');\naddGetterSetter(Node, 'x', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'y', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'globalCompositeOperation', 'source-over', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'opacity', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'name', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'id', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'rotation', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'scale', ['x', 'y']);\naddGetterSetter(Node, 'scaleX', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'scaleY', 1, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'skew', ['x', 'y']);\naddGetterSetter(Node, 'skewX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'skewY', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'offset', ['x', 'y']);\naddGetterSetter(Node, 'offsetX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'offsetY', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'dragDistance', null, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'width', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'height', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'listening', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'preventDefault', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'filters', null, function (val) {\n    this._filterUpToDate = false;\n    return val;\n});\naddGetterSetter(Node, 'visible', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'transformsEnabled', 'all', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'size');\naddGetterSetter(Node, 'dragBoundFunc');\naddGetterSetter(Node, 'draggable', false, (0, Validators_1.getBooleanValidator)());\nFactory_1.Factory.backCompat(Node, {\n    rotateDeg: 'rotate',\n    setRotationDeg: 'setRotation',\n    getRotationDeg: 'getRotation',\n});\n"],"mappings":"AAAA,YAAY;;AACZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,IAAI,GAAG,KAAK,CAAC;AACrB,MAAMC,MAAM,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAMC,SAAS,GAAGD,OAAO,CAAC,WAAW,CAAC;AACtC,MAAME,QAAQ,GAAGF,OAAO,CAAC,UAAU,CAAC;AACpC,MAAMG,QAAQ,GAAGH,OAAO,CAAC,UAAU,CAAC;AACpC,MAAMI,aAAa,GAAGJ,OAAO,CAAC,eAAe,CAAC;AAC9C,MAAMK,YAAY,GAAGL,OAAO,CAAC,cAAc,CAAC;AAC5C,IAAIM,gBAAgB,GAAG,iBAAiB;EAAEC,aAAa,GAAG,mBAAmB;EAAEC,kBAAkB,GAAG,mBAAmB;EAAEC,cAAc,GAAG,eAAe;EAAEC,MAAM,GAAG,QAAQ;EAAEC,MAAM,GAAG,QAAQ;EAAEC,QAAQ,GAAG,UAAU;EAAEC,KAAK,GAAG,OAAO;EAAEC,SAAS,GAAG,WAAW;EAAEC,UAAU,GAAG,YAAY;EAAEC,UAAU,GAAG,YAAY;EAAEC,IAAI,GAAG,MAAM;EAAEC,GAAG,GAAG,KAAK;EAAEC,KAAK,GAAG,OAAO;EAAEC,KAAK,GAAG,GAAG;EAAEC,KAAK,GAAG,OAAO;EAAEC,SAAS,GAAG,WAAW;EAAEC,WAAW,GAAG,OAAO;EAAEC,OAAO,GAAG,SAAS;EAAEC,oBAAoB,GAAG,CAC3d,eAAe,EACf,eAAe,EACf,oBAAoB,EACpB,oBAAoB,EACpB,mBAAmB,EACnB,mBAAmB,EACnB,sBAAsB,EACtB,qBAAqB,EACrB,qBAAqB,EACrB,+BAA+B,CAClC,CAACC,IAAI,CAACN,KAAK,CAAC;AACb,IAAIO,SAAS,GAAG,CAAC;AACjB,MAAM7B,IAAI,CAAC;EACP8B,WAAW,CAACC,MAAM,EAAE;IAChB,IAAI,CAACC,GAAG,GAAGH,SAAS,EAAE;IACtB,IAAI,CAACI,cAAc,GAAG,CAAC,CAAC;IACxB,IAAI,CAACC,KAAK,GAAG,CAAC,CAAC;IACf,IAAI,CAACC,KAAK,GAAG,CAAC;IACd,IAAI,CAACC,kBAAkB,GAAG,IAAI;IAC9B,IAAI,CAACC,MAAM,GAAG,IAAI;IAClB,IAAI,CAACC,MAAM,GAAG,IAAIC,GAAG,EAAE;IACvB,IAAI,CAACC,sBAAsB,GAAG,IAAID,GAAG,EAAE;IACvC,IAAI,CAACE,QAAQ,GAAG,IAAI;IACpB,IAAI,CAACC,wBAAwB,GAAG,KAAK;IACrC,IAAI,CAACC,wBAAwB,GAAG,KAAK;IACrC,IAAI,CAACC,eAAe,GAAG,KAAK;IAC5B,IAAI,CAACC,aAAa,GAAG,KAAK;IAC1B,IAAI,CAACC,YAAY,GAAG,IAAI;IACxB,IAAI,CAACC,uBAAuB,GAAG,KAAK;IACpC,IAAI,CAACC,QAAQ,CAACjB,MAAM,CAAC;IACrB,IAAI,CAACgB,uBAAuB,GAAG,IAAI;EACvC;EACAE,WAAW,GAAG;IACV,OAAO,KAAK;EAChB;EACAC,WAAW,CAACC,IAAI,EAAE;IACd,IAAI,CAACA,IAAI,KAAK3B,SAAS,IAAI2B,IAAI,KAAKzC,kBAAkB,KAClD,IAAI,CAAC4B,MAAM,CAACc,GAAG,CAACD,IAAI,CAAC,EAAE;MACvB,IAAI,CAACb,MAAM,CAACc,GAAG,CAACD,IAAI,CAAC,CAACE,KAAK,GAAG,IAAI;IACtC,CAAC,MACI,IAAIF,IAAI,EAAE;MACX,IAAI,CAACb,MAAM,CAACgB,MAAM,CAACH,IAAI,CAAC;IAC5B,CAAC,MACI;MACD,IAAI,CAACb,MAAM,CAACiB,KAAK,EAAE;IACvB;EACJ;EACAC,SAAS,CAACL,IAAI,EAAEM,aAAa,EAAE;IAC3B,IAAIC,KAAK,GAAG,IAAI,CAACpB,MAAM,CAACc,GAAG,CAACD,IAAI,CAAC;IACjC,IAAIQ,WAAW,GAAGR,IAAI,KAAK3B,SAAS,IAAI2B,IAAI,KAAKzC,kBAAkB;IACnE,IAAIkD,OAAO,GAAGF,KAAK,KAAKG,SAAS,IAAKF,WAAW,IAAID,KAAK,CAACL,KAAK,KAAK,IAAK;IAC1E,IAAIO,OAAO,EAAE;MACTF,KAAK,GAAGD,aAAa,CAACK,IAAI,CAAC,IAAI,CAAC;MAChC,IAAI,CAACxB,MAAM,CAACyB,GAAG,CAACZ,IAAI,EAAEO,KAAK,CAAC;IAChC;IACA,OAAOA,KAAK;EAChB;EACAM,UAAU,CAACC,IAAI,EAAEC,IAAI,EAAEC,MAAM,EAAE;IAC3B,IAAI,CAAC,IAAI,CAAC3B,sBAAsB,CAACY,GAAG,CAACa,IAAI,CAAC,EAAE;MACxC,MAAMG,UAAU,GAAGF,IAAI,CAACG,GAAG,CAAEC,GAAG,IAAKA,GAAG,GAAG,cAAc,CAAC,CAAC1C,IAAI,CAACN,KAAK,CAAC;MACtE,IAAI,CAACiD,EAAE,CAACH,UAAU,EAAE,MAAM;QACtB,IAAI,CAAClB,WAAW,CAACe,IAAI,CAAC;MAC1B,CAAC,CAAC;MACF,IAAI,CAACzB,sBAAsB,CAACuB,GAAG,CAACE,IAAI,EAAE,IAAI,CAAC;IAC/C;IACA,OAAO,IAAI,CAACT,SAAS,CAACS,IAAI,EAAEE,MAAM,CAAC;EACvC;EACAK,eAAe,GAAG;IACd,OAAO,IAAI,CAAClC,MAAM,CAACc,GAAG,CAACxC,MAAM,CAAC;EAClC;EACA6D,4BAA4B,CAACtB,IAAI,EAAE;IAC/B,IAAI,CAACD,WAAW,CAACC,IAAI,CAAC;IACtB,IAAIA,IAAI,KAAKzC,kBAAkB,EAAE;MAC7B,IAAI,CAACgE,IAAI,CAAC,yBAAyB,CAAC;IACxC;EACJ;EACAC,UAAU,GAAG;IACT,IAAI,IAAI,CAACrC,MAAM,CAACsC,GAAG,CAAChE,MAAM,CAAC,EAAE;MACzB,MAAM;QAAEiE,KAAK;QAAEC,MAAM;QAAEC;MAAI,CAAC,GAAG,IAAI,CAACzC,MAAM,CAACc,GAAG,CAACxC,MAAM,CAAC;MACtDX,MAAM,CAAC+E,IAAI,CAACC,aAAa,CAACJ,KAAK,EAAEC,MAAM,EAAEC,GAAG,CAAC;MAC7C,IAAI,CAACzC,MAAM,CAACgB,MAAM,CAAC1C,MAAM,CAAC;IAC9B;IACA,IAAI,CAAC6D,4BAA4B,EAAE;IACnC,IAAI,CAACS,YAAY,EAAE;IACnB,OAAO,IAAI;EACf;EACAxB,KAAK,CAAC3B,MAAM,EAAE;IACV,IAAIoD,IAAI,GAAGpD,MAAM,IAAI,CAAC,CAAC;IACvB,IAAIqD,IAAI,GAAG,CAAC,CAAC;IACb,IAAID,IAAI,CAACE,CAAC,KAAKxB,SAAS,IACpBsB,IAAI,CAACG,CAAC,KAAKzB,SAAS,IACpBsB,IAAI,CAACI,KAAK,KAAK1B,SAAS,IACxBsB,IAAI,CAACK,MAAM,KAAK3B,SAAS,EAAE;MAC3BuB,IAAI,GAAG,IAAI,CAACK,aAAa,CAAC;QACtBC,aAAa,EAAE,IAAI;QACnBC,UAAU,EAAE,IAAI,CAACC,SAAS;MAC9B,CAAC,CAAC;IACN;IACA,IAAIL,KAAK,GAAGM,IAAI,CAACC,IAAI,CAACX,IAAI,CAACI,KAAK,IAAIH,IAAI,CAACG,KAAK,CAAC;MAAEC,MAAM,GAAGK,IAAI,CAACC,IAAI,CAACX,IAAI,CAACK,MAAM,IAAIJ,IAAI,CAACI,MAAM,CAAC;MAAEO,UAAU,GAAGZ,IAAI,CAACY,UAAU;MAAEV,CAAC,GAAGF,IAAI,CAACE,CAAC,KAAKxB,SAAS,GAAGgC,IAAI,CAACG,KAAK,CAACZ,IAAI,CAACC,CAAC,CAAC,GAAGF,IAAI,CAACE,CAAC;MAAEC,CAAC,GAAGH,IAAI,CAACG,CAAC,KAAKzB,SAAS,GAAGgC,IAAI,CAACG,KAAK,CAACZ,IAAI,CAACE,CAAC,CAAC,GAAGH,IAAI,CAACG,CAAC;MAAEW,MAAM,GAAGd,IAAI,CAACc,MAAM,IAAI,CAAC;MAAEC,UAAU,GAAGf,IAAI,CAACe,UAAU,IAAI,KAAK;MAAEC,mBAAmB,GAAGhB,IAAI,CAACgB,mBAAmB,IAAI,CAAC;IACpW,IAAI,CAACZ,KAAK,IAAI,CAACC,MAAM,EAAE;MACnBvF,MAAM,CAAC+E,IAAI,CAACoB,KAAK,CAAC,mFAAmF,CAAC;MACtG;IACJ;IACAb,KAAK,IAAIU,MAAM,GAAG,CAAC,GAAG,CAAC;IACvBT,MAAM,IAAIS,MAAM,GAAG,CAAC,GAAG,CAAC;IACxBZ,CAAC,IAAIY,MAAM;IACXX,CAAC,IAAIW,MAAM;IACX,IAAII,iBAAiB,GAAG,IAAIjG,QAAQ,CAACkG,WAAW,CAAC;QAC7CP,UAAU,EAAEA,UAAU;QACtBR,KAAK,EAAEA,KAAK;QACZC,MAAM,EAAEA;MACZ,CAAC,CAAC;MAAEe,kBAAkB,GAAG,IAAInG,QAAQ,CAACkG,WAAW,CAAC;QAC9CP,UAAU,EAAEA,UAAU;QACtBR,KAAK,EAAE,CAAC;QACRC,MAAM,EAAE,CAAC;QACTgB,kBAAkB,EAAE;MACxB,CAAC,CAAC;MAAEC,eAAe,GAAG,IAAIrG,QAAQ,CAACsG,SAAS,CAAC;QACzCX,UAAU,EAAEI,mBAAmB;QAC/BZ,KAAK,EAAEA,KAAK;QACZC,MAAM,EAAEA;MACZ,CAAC,CAAC;MAAEmB,YAAY,GAAGN,iBAAiB,CAACO,UAAU,EAAE;MAAEC,UAAU,GAAGJ,eAAe,CAACG,UAAU,EAAE;IAC5FH,eAAe,CAACK,OAAO,GAAG,IAAI;IAC9BT,iBAAiB,CAACS,OAAO,GAAG,IAAI;IAChC,IAAI,CAACxE,MAAM,CAACgB,MAAM,CAAC1C,MAAM,CAAC;IAC1B,IAAI,CAACgC,eAAe,GAAG,KAAK;IAC5B,IAAIuC,IAAI,CAAC4B,qBAAqB,KAAK,KAAK,EAAE;MACtCV,iBAAiB,CAACO,UAAU,EAAE,CAACI,QAAQ,CAACD,qBAAqB,GAAG,KAAK;MACrER,kBAAkB,CAACK,UAAU,EAAE,CAACI,QAAQ,CAACD,qBAAqB,GAAG,KAAK;IAC1E;IACAJ,YAAY,CAACM,IAAI,EAAE;IACnBJ,UAAU,CAACI,IAAI,EAAE;IACjBN,YAAY,CAACO,SAAS,CAAC,CAAC7B,CAAC,EAAE,CAACC,CAAC,CAAC;IAC9BuB,UAAU,CAACK,SAAS,CAAC,CAAC7B,CAAC,EAAE,CAACC,CAAC,CAAC;IAC5B,IAAI,CAACzC,aAAa,GAAG,IAAI;IACzB,IAAI,CAAC4B,4BAA4B,CAACjE,gBAAgB,CAAC;IACnD,IAAI,CAACiE,4BAA4B,CAAC9D,cAAc,CAAC;IACjD,IAAI,CAACwG,SAAS,CAACd,iBAAiB,EAAE,IAAI,CAAC;IACvC,IAAI,CAACe,OAAO,CAACX,eAAe,EAAE,IAAI,CAAC;IACnC,IAAI,CAAC5D,aAAa,GAAG,KAAK;IAC1B8D,YAAY,CAACU,OAAO,EAAE;IACtBR,UAAU,CAACQ,OAAO,EAAE;IACpB,IAAInB,UAAU,EAAE;MACZS,YAAY,CAACM,IAAI,EAAE;MACnBN,YAAY,CAACW,SAAS,EAAE;MACxBX,YAAY,CAACvB,IAAI,CAAC,CAAC,EAAE,CAAC,EAAEG,KAAK,EAAEC,MAAM,CAAC;MACtCmB,YAAY,CAACY,SAAS,EAAE;MACxBZ,YAAY,CAACa,OAAO,CAAC,aAAa,EAAE,KAAK,CAAC;MAC1Cb,YAAY,CAACa,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC;MACpCb,YAAY,CAACc,MAAM,EAAE;MACrBd,YAAY,CAACU,OAAO,EAAE;IAC1B;IACA,IAAI,CAAC/E,MAAM,CAACyB,GAAG,CAACnD,MAAM,EAAE;MACpBiE,KAAK,EAAEwB,iBAAiB;MACxBvB,MAAM,EAAEyB,kBAAkB;MAC1BxB,GAAG,EAAE0B,eAAe;MACpBpB,CAAC,EAAEA,CAAC;MACJC,CAAC,EAAEA;IACP,CAAC,CAAC;IACF,IAAI,CAACJ,YAAY,EAAE;IACnB,OAAO,IAAI;EACf;EACAwC,QAAQ,GAAG;IACP,OAAO,IAAI,CAACpF,MAAM,CAACsC,GAAG,CAAChE,MAAM,CAAC;EAClC;EACA6E,aAAa,CAAC1D,MAAM,EAAE;IAClB,MAAM,IAAI4F,KAAK,CAAC,sCAAsC,CAAC;EAC3D;EACAC,gBAAgB,CAACxC,IAAI,EAAEyC,GAAG,EAAE;IACxB,IAAIC,MAAM,GAAG,CACT;MAAEzC,CAAC,EAAED,IAAI,CAACC,CAAC;MAAEC,CAAC,EAAEF,IAAI,CAACE;IAAE,CAAC,EACxB;MAAED,CAAC,EAAED,IAAI,CAACC,CAAC,GAAGD,IAAI,CAACG,KAAK;MAAED,CAAC,EAAEF,IAAI,CAACE;IAAE,CAAC,EACrC;MAAED,CAAC,EAAED,IAAI,CAACC,CAAC,GAAGD,IAAI,CAACG,KAAK;MAAED,CAAC,EAAEF,IAAI,CAACE,CAAC,GAAGF,IAAI,CAACI;IAAO,CAAC,EACnD;MAAEH,CAAC,EAAED,IAAI,CAACC,CAAC;MAAEC,CAAC,EAAEF,IAAI,CAACE,CAAC,GAAGF,IAAI,CAACI;IAAO,CAAC,CACzC;IACD,IAAIuC,IAAI,EAAEC,IAAI,EAAEC,IAAI,EAAEC,IAAI;IAC1B,IAAIC,KAAK,GAAG,IAAI,CAACC,oBAAoB,CAACP,GAAG,CAAC;IAC1CC,MAAM,CAACO,OAAO,CAAC,UAAUC,KAAK,EAAE;MAC5B,IAAIC,WAAW,GAAGJ,KAAK,CAACG,KAAK,CAACA,KAAK,CAAC;MACpC,IAAIP,IAAI,KAAKlE,SAAS,EAAE;QACpBkE,IAAI,GAAGE,IAAI,GAAGM,WAAW,CAAClD,CAAC;QAC3B2C,IAAI,GAAGE,IAAI,GAAGK,WAAW,CAACjD,CAAC;MAC/B;MACAyC,IAAI,GAAGlC,IAAI,CAAC2C,GAAG,CAACT,IAAI,EAAEQ,WAAW,CAAClD,CAAC,CAAC;MACpC2C,IAAI,GAAGnC,IAAI,CAAC2C,GAAG,CAACR,IAAI,EAAEO,WAAW,CAACjD,CAAC,CAAC;MACpC2C,IAAI,GAAGpC,IAAI,CAAC4C,GAAG,CAACR,IAAI,EAAEM,WAAW,CAAClD,CAAC,CAAC;MACpC6C,IAAI,GAAGrC,IAAI,CAAC4C,GAAG,CAACP,IAAI,EAAEK,WAAW,CAACjD,CAAC,CAAC;IACxC,CAAC,CAAC;IACF,OAAO;MACHD,CAAC,EAAE0C,IAAI;MACPzC,CAAC,EAAE0C,IAAI;MACPzC,KAAK,EAAE0C,IAAI,GAAGF,IAAI;MAClBvC,MAAM,EAAE0C,IAAI,GAAGF;IACnB,CAAC;EACL;EACAU,sBAAsB,CAACC,OAAO,EAAE;IAC5BA,OAAO,CAAC1B,IAAI,EAAE;IACd0B,OAAO,CAACC,aAAa,CAAC,IAAI,CAAC;IAC3BD,OAAO,CAACE,8BAA8B,CAAC,IAAI,CAAC;IAC5C,MAAMC,WAAW,GAAG,IAAI,CAACtE,eAAe,EAAE;IAC1CmE,OAAO,CAACzB,SAAS,CAAC4B,WAAW,CAACzD,CAAC,EAAEyD,WAAW,CAACxD,CAAC,CAAC;IAC/C,IAAIyD,WAAW,GAAG,IAAI,CAACC,qBAAqB,EAAE;IAC9C,IAAIC,KAAK,GAAGF,WAAW,CAAChD,UAAU;IAClC4C,OAAO,CAACO,SAAS,CAACH,WAAW,CAACI,OAAO,EAAE,CAAC,EAAE,CAAC,EAAEJ,WAAW,CAACxD,KAAK,GAAG0D,KAAK,EAAEF,WAAW,CAACvD,MAAM,GAAGyD,KAAK,CAAC;IACnGN,OAAO,CAACtB,OAAO,EAAE;EACrB;EACA+B,oBAAoB,CAACT,OAAO,EAAE;IAC1B,IAAIG,WAAW,GAAG,IAAI,CAACtE,eAAe,EAAE;MAAE6E,SAAS,GAAGP,WAAW,CAAC/D,GAAG;IACrE4D,OAAO,CAAC1B,IAAI,EAAE;IACd0B,OAAO,CAACzB,SAAS,CAAC4B,WAAW,CAACzD,CAAC,EAAEyD,WAAW,CAACxD,CAAC,CAAC;IAC/CqD,OAAO,CAACO,SAAS,CAACG,SAAS,CAACF,OAAO,EAAE,CAAC,EAAE,CAAC,EAAEE,SAAS,CAAC9D,KAAK,GAAG8D,SAAS,CAACtD,UAAU,EAAEsD,SAAS,CAAC7D,MAAM,GAAG6D,SAAS,CAACtD,UAAU,CAAC;IAC3H4C,OAAO,CAACtB,OAAO,EAAE;EACrB;EACA2B,qBAAqB,GAAG;IACpB,IAAIM,OAAO,GAAG,IAAI,CAACA,OAAO,EAAE;MAAEC,YAAY,GAAG,IAAI,CAAC/E,eAAe,EAAE;MAAEgF,WAAW,GAAGD,YAAY,CAAC1E,KAAK;MAAE4E,YAAY,GAAGF,YAAY,CAACzE,MAAM;MAAE4E,aAAa,GAAGD,YAAY,CAAC7C,UAAU,EAAE;MAAE+C,GAAG;MAAEC,SAAS;MAAEC,CAAC;MAAE/E,MAAM;IAC/M,IAAIwE,OAAO,EAAE;MACT,IAAI,CAAC,IAAI,CAAC1G,eAAe,EAAE;QACvB,IAAIqG,KAAK,GAAGO,WAAW,CAACzD,UAAU;QAClC0D,YAAY,CAACK,OAAO,CAACN,WAAW,CAACjE,KAAK,GAAGiE,WAAW,CAACzD,UAAU,EAAEyD,WAAW,CAAChE,MAAM,GAAGgE,WAAW,CAACzD,UAAU,CAAC;QAC7G,IAAI;UACA4D,GAAG,GAAGL,OAAO,CAACS,MAAM;UACpBL,aAAa,CAACnG,KAAK,EAAE;UACrBmG,aAAa,CAACR,SAAS,CAACM,WAAW,CAACL,OAAO,EAAE,CAAC,EAAE,CAAC,EAAEK,WAAW,CAACQ,QAAQ,EAAE,GAAGf,KAAK,EAAEO,WAAW,CAACS,SAAS,EAAE,GAAGhB,KAAK,CAAC;UACnHW,SAAS,GAAGF,aAAa,CAACQ,YAAY,CAAC,CAAC,EAAE,CAAC,EAAET,YAAY,CAACO,QAAQ,EAAE,EAAEP,YAAY,CAACQ,SAAS,EAAE,CAAC;UAC/F,KAAKJ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,GAAG,EAAEE,CAAC,EAAE,EAAE;YACtB/E,MAAM,GAAGwE,OAAO,CAACO,CAAC,CAAC;YACnB,IAAI,OAAO/E,MAAM,KAAK,UAAU,EAAE;cAC9B7E,MAAM,CAAC+E,IAAI,CAACoB,KAAK,CAAC,6CAA6C,GAC3D,OAAOtB,MAAM,GACb,wCAAwC,CAAC;cAC7C;YACJ;YACAA,MAAM,CAAChB,IAAI,CAAC,IAAI,EAAE8F,SAAS,CAAC;YAC5BF,aAAa,CAACS,YAAY,CAACP,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC;UAC/C;QACJ,CAAC,CACD,OAAOQ,CAAC,EAAE;UACNnK,MAAM,CAAC+E,IAAI,CAACoB,KAAK,CAAC,0BAA0B,GACxCgE,CAAC,CAACC,OAAO,GACT,4EAA4E,CAAC;QACrF;QACA,IAAI,CAACzH,eAAe,GAAG,IAAI;MAC/B;MACA,OAAO6G,YAAY;IACvB;IACA,OAAOD,WAAW;EACtB;EACAjF,EAAE,CAAC+F,MAAM,EAAEC,OAAO,EAAE;IAChB,IAAI,CAACjI,MAAM,IAAI,IAAI,CAACA,MAAM,CAACgB,MAAM,CAAC7C,aAAa,CAAC;IAChD,IAAI+J,SAAS,CAACT,MAAM,KAAK,CAAC,EAAE;MACxB,OAAO,IAAI,CAACU,SAAS,CAACC,KAAK,CAAC,IAAI,EAAEF,SAAS,CAAC;IAChD;IACA,IAAIG,MAAM,GAAGL,MAAM,CAACM,KAAK,CAACtJ,KAAK,CAAC;MAAEqI,GAAG,GAAGgB,MAAM,CAACZ,MAAM;MAAEF,CAAC;MAAEgB,KAAK;MAAEC,KAAK;MAAEC,SAAS;MAAE9G,IAAI;IACvF,KAAK4F,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,GAAG,EAAEE,CAAC,EAAE,EAAE;MACtBgB,KAAK,GAAGF,MAAM,CAACd,CAAC,CAAC;MACjBiB,KAAK,GAAGD,KAAK,CAACD,KAAK,CAAC,GAAG,CAAC;MACxBG,SAAS,GAAGD,KAAK,CAAC,CAAC,CAAC;MACpB7G,IAAI,GAAG6G,KAAK,CAAC,CAAC,CAAC,IAAI,EAAE;MACrB,IAAI,CAAC,IAAI,CAAC7I,cAAc,CAAC8I,SAAS,CAAC,EAAE;QACjC,IAAI,CAAC9I,cAAc,CAAC8I,SAAS,CAAC,GAAG,EAAE;MACvC;MACA,IAAI,CAAC9I,cAAc,CAAC8I,SAAS,CAAC,CAACC,IAAI,CAAC;QAChC/G,IAAI,EAAEA,IAAI;QACVsG,OAAO,EAAEA;MACb,CAAC,CAAC;IACN;IACA,OAAO,IAAI;EACf;EACAU,GAAG,CAACX,MAAM,EAAEY,QAAQ,EAAE;IAClB,IAAIP,MAAM,GAAG,CAACL,MAAM,IAAI,EAAE,EAAEM,KAAK,CAACtJ,KAAK,CAAC;MAAEqI,GAAG,GAAGgB,MAAM,CAACZ,MAAM;MAAEF,CAAC;MAAEsB,CAAC;MAAEN,KAAK;MAAEC,KAAK;MAAEC,SAAS;MAAE9G,IAAI;IAClG,IAAI,CAAC3B,MAAM,IAAI,IAAI,CAACA,MAAM,CAACgB,MAAM,CAAC7C,aAAa,CAAC;IAChD,IAAI,CAAC6J,MAAM,EAAE;MACT,KAAKa,CAAC,IAAI,IAAI,CAAClJ,cAAc,EAAE;QAC3B,IAAI,CAACmJ,IAAI,CAACD,CAAC,CAAC;MAChB;IACJ;IACA,KAAKtB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,GAAG,EAAEE,CAAC,EAAE,EAAE;MACtBgB,KAAK,GAAGF,MAAM,CAACd,CAAC,CAAC;MACjBiB,KAAK,GAAGD,KAAK,CAACD,KAAK,CAAC,GAAG,CAAC;MACxBG,SAAS,GAAGD,KAAK,CAAC,CAAC,CAAC;MACpB7G,IAAI,GAAG6G,KAAK,CAAC,CAAC,CAAC;MACf,IAAIC,SAAS,EAAE;QACX,IAAI,IAAI,CAAC9I,cAAc,CAAC8I,SAAS,CAAC,EAAE;UAChC,IAAI,CAACK,IAAI,CAACL,SAAS,EAAE9G,IAAI,EAAEiH,QAAQ,CAAC;QACxC;MACJ,CAAC,MACI;QACD,KAAKC,CAAC,IAAI,IAAI,CAAClJ,cAAc,EAAE;UAC3B,IAAI,CAACmJ,IAAI,CAACD,CAAC,EAAElH,IAAI,EAAEiH,QAAQ,CAAC;QAChC;MACJ;IACJ;IACA,OAAO,IAAI;EACf;EACAG,aAAa,CAACC,GAAG,EAAE;IACf,IAAIlB,CAAC,GAAG;MACJmB,MAAM,EAAE,IAAI;MACZC,IAAI,EAAEF,GAAG,CAACE,IAAI;MACdF,GAAG,EAAEA;IACT,CAAC;IACD,IAAI,CAAC5G,IAAI,CAAC4G,GAAG,CAACE,IAAI,EAAEpB,CAAC,CAAC;IACtB,OAAO,IAAI;EACf;EACAqB,gBAAgB,CAACD,IAAI,EAAEjB,OAAO,EAAE;IAC5B,IAAI,CAAChG,EAAE,CAACiH,IAAI,EAAE,UAAUF,GAAG,EAAE;MACzBf,OAAO,CAACzG,IAAI,CAAC,IAAI,EAAEwH,GAAG,CAACA,GAAG,CAAC;IAC/B,CAAC,CAAC;IACF,OAAO,IAAI;EACf;EACAI,mBAAmB,CAACF,IAAI,EAAE;IACtB,IAAI,CAACP,GAAG,CAACO,IAAI,CAAC;IACd,OAAO,IAAI;EACf;EACAf,SAAS,CAACI,KAAK,EAAEc,QAAQ,EAAEpB,OAAO,EAAE;IAChC,IAAIqB,QAAQ,GAAG,IAAI;IACnB,IAAI,CAACrH,EAAE,CAACsG,KAAK,EAAE,UAAUS,GAAG,EAAE;MAC1B,IAAIO,OAAO,GAAGP,GAAG,CAACC,MAAM,CAACO,aAAa,CAACH,QAAQ,EAAE,IAAI,EAAEC,QAAQ,CAAC;MAChE,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,OAAO,CAAC9B,MAAM,EAAEgC,CAAC,EAAE,EAAE;QACrCT,GAAG,GAAGrL,MAAM,CAAC+E,IAAI,CAACgH,WAAW,CAACV,GAAG,CAAC;QAClCA,GAAG,CAACW,aAAa,GAAGJ,OAAO,CAACE,CAAC,CAAC;QAC9BxB,OAAO,CAACzG,IAAI,CAAC+H,OAAO,CAACE,CAAC,CAAC,EAAET,GAAG,CAAC;MACjC;IACJ,CAAC,CAAC;EACN;EACAY,MAAM,GAAG;IACL,IAAI,IAAI,CAACC,UAAU,EAAE,EAAE;MACnB,IAAI,CAACC,QAAQ,EAAE;IACnB;IACA9L,aAAa,CAAC+L,EAAE,CAACC,aAAa,CAAChJ,MAAM,CAAC,IAAI,CAACtB,GAAG,CAAC;IAC/C,IAAI,CAACuK,OAAO,EAAE;IACd,OAAO,IAAI;EACf;EACAC,YAAY,GAAG;IACX,IAAI,CAAC/H,4BAA4B,CAAC/D,kBAAkB,CAAC;IACrD,IAAI,CAAC+D,4BAA4B,CAACjE,gBAAgB,CAAC;IACnD,IAAI,CAACiE,4BAA4B,CAAC9D,cAAc,CAAC;IACjD,IAAI,CAAC8D,4BAA4B,CAAClD,KAAK,CAAC;IACxC,IAAI,CAACkD,4BAA4B,CAAC/C,OAAO,CAAC;IAC1C,IAAI,CAAC+C,4BAA4B,CAACzD,SAAS,CAAC;EAChD;EACAuL,OAAO,GAAG;IACN,IAAI,CAACC,YAAY,EAAE;IACnB,IAAInK,MAAM,GAAG,IAAI,CAACuD,SAAS,EAAE;IAC7B,IAAIvD,MAAM,IAAIA,MAAM,CAACoK,QAAQ,EAAE;MAC3BpK,MAAM,CAACoK,QAAQ,CAACC,MAAM,CAAC,IAAI,CAACvK,KAAK,EAAE,CAAC,CAAC;MACrCE,MAAM,CAACsK,mBAAmB,EAAE;MAC5B,IAAI,CAACtK,MAAM,GAAG,IAAI;IACtB;EACJ;EACAuK,OAAO,GAAG;IACN,IAAI,CAACV,MAAM,EAAE;IACb,IAAI,CAACvH,UAAU,EAAE;IACjB,OAAO,IAAI;EACf;EACAkI,OAAO,CAAC1J,IAAI,EAAE;IACV,IAAI2J,MAAM,GAAG,KAAK,GAAG7M,MAAM,CAAC+E,IAAI,CAAC+H,WAAW,CAAC5J,IAAI,CAAC;IAClD,IAAIlD,MAAM,CAAC+E,IAAI,CAACgI,WAAW,CAAC,IAAI,CAACF,MAAM,CAAC,CAAC,EAAE;MACvC,OAAO,IAAI,CAACA,MAAM,CAAC,EAAE;IACzB;IACA,OAAO,IAAI,CAAC5K,KAAK,CAACiB,IAAI,CAAC;EAC3B;EACA8J,YAAY,GAAG;IACX,IAAI5K,MAAM,GAAG,IAAI,CAACuD,SAAS,EAAE;MAAEsH,SAAS,GAAG,EAAE;IAC7C,OAAO7K,MAAM,EAAE;MACX6K,SAAS,CAAClC,IAAI,CAAC3I,MAAM,CAAC;MACtBA,MAAM,GAAGA,MAAM,CAACuD,SAAS,EAAE;IAC/B;IACA,OAAOsH,SAAS;EACpB;EACAC,QAAQ,GAAG;IACP,OAAO,IAAI,CAACjL,KAAK,IAAI,CAAC,CAAC;EAC3B;EACAc,QAAQ,CAACjB,MAAM,EAAE;IACb,IAAI,CAACqL,sBAAsB,CAAC,MAAM;MAC9B,IAAIC,GAAG,EAAEP,MAAM;MACf,IAAI,CAAC/K,MAAM,EAAE;QACT,OAAO,IAAI;MACf;MACA,KAAKsL,GAAG,IAAItL,MAAM,EAAE;QAChB,IAAIsL,GAAG,KAAKvM,QAAQ,EAAE;UAClB;QACJ;QACAgM,MAAM,GAAG1L,GAAG,GAAGnB,MAAM,CAAC+E,IAAI,CAAC+H,WAAW,CAACM,GAAG,CAAC;QAC3C,IAAIpN,MAAM,CAAC+E,IAAI,CAACgI,WAAW,CAAC,IAAI,CAACF,MAAM,CAAC,CAAC,EAAE;UACvC,IAAI,CAACA,MAAM,CAAC,CAAC/K,MAAM,CAACsL,GAAG,CAAC,CAAC;QAC7B,CAAC,MACI;UACD,IAAI,CAACC,QAAQ,CAACD,GAAG,EAAEtL,MAAM,CAACsL,GAAG,CAAC,CAAC;QACnC;MACJ;IACJ,CAAC,CAAC;IACF,OAAO,IAAI;EACf;EACAE,WAAW,GAAG;IACV,OAAO,IAAI,CAAC/J,SAAS,CAACxC,SAAS,EAAE,IAAI,CAACwM,YAAY,CAAC;EACvD;EACAA,YAAY,CAAC7H,UAAU,EAAE;IACrB,MAAM8H,SAAS,GAAG,IAAI,CAACA,SAAS,EAAE;IAClC,IAAI,CAACA,SAAS,EAAE;MACZ,OAAO,KAAK;IAChB;IACA,MAAMpL,MAAM,GAAG,IAAI,CAACuD,SAAS,EAAE;IAC/B,IAAIvD,MAAM,IAAIA,MAAM,KAAKsD,UAAU,IAAI,IAAI,KAAKA,UAAU,EAAE;MACxD,OAAOtD,MAAM,CAACmL,YAAY,CAAC7H,UAAU,CAAC;IAC1C,CAAC,MACI;MACD,OAAO,IAAI;IACf;EACJ;EACA+H,SAAS,GAAG;IACR,OAAO,IAAI,CAAClK,SAAS,CAAC9B,OAAO,EAAE,IAAI,CAACiM,UAAU,CAAC;EACnD;EACAA,UAAU,CAAChI,UAAU,EAAE;IACnB,MAAMiI,OAAO,GAAG,IAAI,CAACA,OAAO,EAAE;IAC9B,IAAI,CAACA,OAAO,EAAE;MACV,OAAO,KAAK;IAChB;IACA,MAAMvL,MAAM,GAAG,IAAI,CAACuD,SAAS,EAAE;IAC/B,IAAIvD,MAAM,IAAIA,MAAM,KAAKsD,UAAU,IAAI,IAAI,KAAKA,UAAU,EAAE;MACxD,OAAOtD,MAAM,CAACsL,UAAU,CAAChI,UAAU,CAAC;IACxC,CAAC,MACI;MACD,OAAO,IAAI;IACf;EACJ;EACAkI,aAAa,CAAChG,GAAG,EAAyB;IAAA,IAAvBiG,aAAa,uEAAG,KAAK;IACpC,IAAIjG,GAAG,EAAE;MACL,OAAO,IAAI,CAAC8F,UAAU,CAAC9F,GAAG,CAAC,IAAI,IAAI,CAAC2F,YAAY,CAAC3F,GAAG,CAAC;IACzD;IACA,IAAIkG,KAAK,GAAG,IAAI,CAACC,QAAQ,EAAE;IAC3B,IAAIC,cAAc,GAAG,KAAK;IAC1B3N,aAAa,CAAC+L,EAAE,CAACC,aAAa,CAACjE,OAAO,CAAE6F,IAAI,IAAK;MAC7C,IAAIA,IAAI,CAACC,UAAU,KAAK,UAAU,EAAE;QAChC;MACJ,CAAC,MACI,IAAID,IAAI,CAACE,IAAI,CAACC,QAAQ,KAAK,OAAO,EAAE;QACrCJ,cAAc,GAAG,IAAI;MACzB,CAAC,MACI,IAAIC,IAAI,CAACE,IAAI,CAACJ,QAAQ,EAAE,KAAKD,KAAK,EAAE;QACrCE,cAAc,GAAG,IAAI;MACzB;IACJ,CAAC,CAAC;IACF,IAAIK,QAAQ,GAAG,CAACR,aAAa,IAAI,CAACzN,QAAQ,CAACkO,KAAK,CAACC,gBAAgB,IAAIP,cAAc;IACnF,OAAO,IAAI,CAACV,WAAW,EAAE,IAAI,IAAI,CAACG,SAAS,EAAE,IAAI,CAACY,QAAQ;EAC9D;EACAG,IAAI,GAAG;IACH,IAAI,CAACb,OAAO,CAAC,IAAI,CAAC;IAClB,OAAO,IAAI;EACf;EACAc,IAAI,GAAG;IACH,IAAI,CAACd,OAAO,CAAC,KAAK,CAAC;IACnB,OAAO,IAAI;EACf;EACAe,SAAS,GAAG;IACR,OAAO,IAAI,CAACxM,KAAK,IAAI,CAAC;EAC1B;EACAyM,iBAAiB,GAAG;IAChB,IAAIC,KAAK,GAAG,IAAI,CAACC,QAAQ,EAAE;MAAEC,IAAI,GAAG,IAAI;MAAE5M,KAAK,GAAG,CAAC;MAAE6M,KAAK;MAAErF,GAAG;MAAEE,CAAC;MAAEoF,KAAK;IACzE,SAASC,WAAW,CAACzC,QAAQ,EAAE;MAC3BuC,KAAK,GAAG,EAAE;MACVrF,GAAG,GAAG8C,QAAQ,CAAC1C,MAAM;MACrB,KAAKF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,GAAG,EAAEE,CAAC,EAAE,EAAE;QACtBoF,KAAK,GAAGxC,QAAQ,CAAC5C,CAAC,CAAC;QACnB1H,KAAK,EAAE;QACP,IAAI8M,KAAK,CAACZ,QAAQ,KAAKhN,KAAK,EAAE;UAC1B2N,KAAK,GAAGA,KAAK,CAACG,MAAM,CAACF,KAAK,CAACG,WAAW,EAAE,CAACC,KAAK,EAAE,CAAC;QACrD;QACA,IAAIJ,KAAK,CAACjN,GAAG,KAAK+M,IAAI,CAAC/M,GAAG,EAAE;UACxB6H,CAAC,GAAGF,GAAG;QACX;MACJ;MACA,IAAIqF,KAAK,CAACjF,MAAM,GAAG,CAAC,IAAIiF,KAAK,CAAC,CAAC,CAAC,CAACF,QAAQ,EAAE,IAAID,KAAK,EAAE;QAClDK,WAAW,CAACF,KAAK,CAAC;MACtB;IACJ;IACA,IAAID,IAAI,CAACV,QAAQ,KAAK5M,WAAW,EAAE;MAC/ByN,WAAW,CAACH,IAAI,CAACO,QAAQ,EAAE,CAACF,WAAW,EAAE,CAAC;IAC9C;IACA,OAAOjN,KAAK;EAChB;EACA2M,QAAQ,GAAG;IACP,IAAID,KAAK,GAAG,CAAC;MAAExM,MAAM,GAAG,IAAI,CAACA,MAAM;IACnC,OAAOA,MAAM,EAAE;MACXwM,KAAK,EAAE;MACPxM,MAAM,GAAGA,MAAM,CAACA,MAAM;IAC1B;IACA,OAAOwM,KAAK;EAChB;EACAzB,sBAAsB,CAACmC,IAAI,EAAE;IACzB,IAAI,CAAC7M,wBAAwB,GAAG,IAAI;IACpC6M,IAAI,EAAE;IACN,IAAI,CAAC7M,wBAAwB,GAAG,KAAK;IACrC,IAAI,IAAI,CAACC,wBAAwB,EAAE;MAC/B,IAAI,CAACO,WAAW,CAAC1B,SAAS,CAAC;MAC3B,IAAI,CAACiD,4BAA4B,CAAC/D,kBAAkB,CAAC;IACzD;IACA,IAAI,CAACiC,wBAAwB,GAAG,KAAK;EACzC;EACA6M,WAAW,CAACC,GAAG,EAAE;IACb,IAAI,CAACrC,sBAAsB,CAAC,MAAM;MAC9B,IAAI,CAAC/H,CAAC,CAACoK,GAAG,CAACpK,CAAC,CAAC;MACb,IAAI,CAACC,CAAC,CAACmK,GAAG,CAACnK,CAAC,CAAC;IACjB,CAAC,CAAC;IACF,OAAO,IAAI;EACf;EACAoK,WAAW,GAAG;IACV,OAAO;MACHrK,CAAC,EAAE,IAAI,CAACA,CAAC,EAAE;MACXC,CAAC,EAAE,IAAI,CAACA,CAAC;IACb,CAAC;EACL;EACAqK,0BAA0B,GAAG;IACzB,IAAI,CAAC,IAAI,CAACL,QAAQ,EAAE,EAAE;MAClB,OAAO,IAAI;IACf;IACA,IAAIG,GAAG,GAAG,IAAI,CAACH,QAAQ,EAAE,CAACM,kBAAkB,EAAE;IAC9C,IAAI,CAACH,GAAG,EAAE;MACN,OAAO,IAAI;IACf;IACA,IAAII,SAAS,GAAG,IAAI,CAACzH,oBAAoB,EAAE,CAAC0H,IAAI,EAAE;IAClDD,SAAS,CAACE,MAAM,EAAE;IAClB,OAAOF,SAAS,CAACvH,KAAK,CAACmH,GAAG,CAAC;EAC/B;EACAO,mBAAmB,CAACnI,GAAG,EAAE;IACrB,IAAIoI,gBAAgB,GAAG,KAAK;IAC5B,IAAI5N,MAAM,GAAG,IAAI,CAACA,MAAM;IACxB,OAAOA,MAAM,EAAE;MACX,IAAIA,MAAM,CAACqF,QAAQ,EAAE,EAAE;QACnBuI,gBAAgB,GAAG,IAAI;QACvB;MACJ;MACA5N,MAAM,GAAGA,MAAM,CAACA,MAAM;IAC1B;IACA,IAAI4N,gBAAgB,IAAI,CAACpI,GAAG,EAAE;MAC1BA,GAAG,GAAG,IAAI;IACd;IACA,IAAIqI,cAAc,GAAG,IAAI,CAAC9H,oBAAoB,CAACP,GAAG,CAAC,CAACsI,SAAS,EAAE;MAAEC,iBAAiB,GAAG,IAAInQ,MAAM,CAACoQ,SAAS,EAAE;MAAEpK,MAAM,GAAG,IAAI,CAACA,MAAM,EAAE;IACnImK,iBAAiB,CAACE,CAAC,GAAGJ,cAAc,CAACb,KAAK,EAAE;IAC5Ce,iBAAiB,CAAClJ,SAAS,CAACjB,MAAM,CAACZ,CAAC,EAAEY,MAAM,CAACX,CAAC,CAAC;IAC/C,OAAO8K,iBAAiB,CAACG,cAAc,EAAE;EAC7C;EACAC,mBAAmB,CAACf,GAAG,EAAE;IACrB,IAAIgB,SAAS,GAAG,IAAI,CAACC,eAAe,EAAE;IACtC,IAAI,CAACxO,KAAK,CAACmD,CAAC,GAAGoL,SAAS,CAACpL,CAAC;IAC1B,IAAI,CAACnD,KAAK,CAACoD,CAAC,GAAGmL,SAAS,CAACnL,CAAC;IAC1B,OAAOmL,SAAS,CAACpL,CAAC;IAClB,OAAOoL,SAAS,CAACnL,CAAC;IAClB,IAAI,CAACpC,WAAW,CAAC1B,SAAS,CAAC;IAC3B,IAAImP,EAAE,GAAG,IAAI,CAACC,qBAAqB,EAAE,CAACd,IAAI,EAAE;IAC5Ca,EAAE,CAACZ,MAAM,EAAE;IACXY,EAAE,CAACzJ,SAAS,CAACuI,GAAG,CAACpK,CAAC,EAAEoK,GAAG,CAACnK,CAAC,CAAC;IAC1BmK,GAAG,GAAG;MACFpK,CAAC,EAAE,IAAI,CAACnD,KAAK,CAACmD,CAAC,GAAGsL,EAAE,CAACJ,cAAc,EAAE,CAAClL,CAAC;MACvCC,CAAC,EAAE,IAAI,CAACpD,KAAK,CAACoD,CAAC,GAAGqL,EAAE,CAACJ,cAAc,EAAE,CAACjL;IAC1C,CAAC;IACD,IAAI,CAACuL,aAAa,CAACJ,SAAS,CAAC;IAC7B,IAAI,CAACjB,WAAW,CAAC;MAAEnK,CAAC,EAAEoK,GAAG,CAACpK,CAAC;MAAEC,CAAC,EAAEmK,GAAG,CAACnK;IAAE,CAAC,CAAC;IACxC,IAAI,CAACpC,WAAW,CAAC1B,SAAS,CAAC;IAC3B,IAAI,CAACiD,4BAA4B,CAAC/D,kBAAkB,CAAC;IACrD,OAAO,IAAI;EACf;EACAmQ,aAAa,CAAC1I,KAAK,EAAE;IACjB,IAAIkF,GAAG;IACP,KAAKA,GAAG,IAAIlF,KAAK,EAAE;MACf,IAAI,CAACjG,KAAK,CAACmL,GAAG,CAAC,GAAGlF,KAAK,CAACkF,GAAG,CAAC;IAChC;EACJ;EACAqD,eAAe,GAAG;IACd,IAAIvI,KAAK,GAAG;MACR9C,CAAC,EAAE,IAAI,CAACA,CAAC,EAAE;MACXC,CAAC,EAAE,IAAI,CAACA,CAAC,EAAE;MACXwL,QAAQ,EAAE,IAAI,CAACA,QAAQ,EAAE;MACzBC,MAAM,EAAE,IAAI,CAACA,MAAM,EAAE;MACrBC,MAAM,EAAE,IAAI,CAACA,MAAM,EAAE;MACrBC,OAAO,EAAE,IAAI,CAACA,OAAO,EAAE;MACvBC,OAAO,EAAE,IAAI,CAACA,OAAO,EAAE;MACvBC,KAAK,EAAE,IAAI,CAACA,KAAK,EAAE;MACnBC,KAAK,EAAE,IAAI,CAACA,KAAK;IACrB,CAAC;IACD,IAAI,CAAClP,KAAK,CAACmD,CAAC,GAAG,CAAC;IAChB,IAAI,CAACnD,KAAK,CAACoD,CAAC,GAAG,CAAC;IAChB,IAAI,CAACpD,KAAK,CAAC4O,QAAQ,GAAG,CAAC;IACvB,IAAI,CAAC5O,KAAK,CAAC6O,MAAM,GAAG,CAAC;IACrB,IAAI,CAAC7O,KAAK,CAAC8O,MAAM,GAAG,CAAC;IACrB,IAAI,CAAC9O,KAAK,CAAC+O,OAAO,GAAG,CAAC;IACtB,IAAI,CAAC/O,KAAK,CAACgP,OAAO,GAAG,CAAC;IACtB,IAAI,CAAChP,KAAK,CAACiP,KAAK,GAAG,CAAC;IACpB,IAAI,CAACjP,KAAK,CAACkP,KAAK,GAAG,CAAC;IACpB,OAAOjJ,KAAK;EAChB;EACAkJ,IAAI,CAACC,MAAM,EAAE;IACT,IAAIC,OAAO,GAAGD,MAAM,CAACjM,CAAC;MAAEmM,OAAO,GAAGF,MAAM,CAAChM,CAAC;MAAED,CAAC,GAAG,IAAI,CAACA,CAAC,EAAE;MAAEC,CAAC,GAAG,IAAI,CAACA,CAAC,EAAE;IACtE,IAAIiM,OAAO,KAAK1N,SAAS,EAAE;MACvBwB,CAAC,IAAIkM,OAAO;IAChB;IACA,IAAIC,OAAO,KAAK3N,SAAS,EAAE;MACvByB,CAAC,IAAIkM,OAAO;IAChB;IACA,IAAI,CAAChC,WAAW,CAAC;MAAEnK,CAAC,EAAEA,CAAC;MAAEC,CAAC,EAAEA;IAAE,CAAC,CAAC;IAChC,OAAO,IAAI;EACf;EACAmM,oBAAoB,CAAClC,IAAI,EAAE1H,GAAG,EAAE;IAC5B,IAAI6J,MAAM,GAAG,EAAE;MAAErP,MAAM,GAAG,IAAI,CAACuD,SAAS,EAAE;MAAE+D,GAAG;MAAEE,CAAC;IAClD,IAAIhC,GAAG,IAAIA,GAAG,CAAC7F,GAAG,KAAK,IAAI,CAACA,GAAG,EAAE;MAC7B;IACJ;IACA0P,MAAM,CAACC,OAAO,CAAC,IAAI,CAAC;IACpB,OAAOtP,MAAM,KAAK,CAACwF,GAAG,IAAIxF,MAAM,CAACL,GAAG,KAAK6F,GAAG,CAAC7F,GAAG,CAAC,EAAE;MAC/C0P,MAAM,CAACC,OAAO,CAACtP,MAAM,CAAC;MACtBA,MAAM,GAAGA,MAAM,CAACA,MAAM;IAC1B;IACAsH,GAAG,GAAG+H,MAAM,CAAC3H,MAAM;IACnB,KAAKF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,GAAG,EAAEE,CAAC,EAAE,EAAE;MACtB0F,IAAI,CAACmC,MAAM,CAAC7H,CAAC,CAAC,CAAC;IACnB;EACJ;EACA+H,MAAM,CAACC,KAAK,EAAE;IACV,IAAI,CAACf,QAAQ,CAAC,IAAI,CAACA,QAAQ,EAAE,GAAGe,KAAK,CAAC;IACtC,OAAO,IAAI;EACf;EACAC,SAAS,GAAG;IACR,IAAI,CAAC,IAAI,CAACzP,MAAM,EAAE;MACdpC,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,oDAAoD,CAAC;MACtE,OAAO,KAAK;IAChB;IACA,IAAI5P,KAAK,GAAG,IAAI,CAACA,KAAK;MAAEwH,GAAG,GAAG,IAAI,CAACtH,MAAM,CAAC+M,WAAW,EAAE,CAACrF,MAAM;IAC9D,IAAI5H,KAAK,GAAGwH,GAAG,GAAG,CAAC,EAAE;MACjB,IAAI,CAACtH,MAAM,CAACoK,QAAQ,CAACC,MAAM,CAACvK,KAAK,EAAE,CAAC,CAAC;MACrC,IAAI,CAACE,MAAM,CAACoK,QAAQ,CAACzB,IAAI,CAAC,IAAI,CAAC;MAC/B,IAAI,CAAC3I,MAAM,CAACsK,mBAAmB,EAAE;MACjC,OAAO,IAAI;IACf;IACA,OAAO,KAAK;EAChB;EACAqF,MAAM,GAAG;IACL,IAAI,CAAC,IAAI,CAAC3P,MAAM,EAAE;MACdpC,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,iDAAiD,CAAC;MACnE,OAAO,KAAK;IAChB;IACA,IAAI5P,KAAK,GAAG,IAAI,CAACA,KAAK;MAAEwH,GAAG,GAAG,IAAI,CAACtH,MAAM,CAAC+M,WAAW,EAAE,CAACrF,MAAM;IAC9D,IAAI5H,KAAK,GAAGwH,GAAG,GAAG,CAAC,EAAE;MACjB,IAAI,CAACtH,MAAM,CAACoK,QAAQ,CAACC,MAAM,CAACvK,KAAK,EAAE,CAAC,CAAC;MACrC,IAAI,CAACE,MAAM,CAACoK,QAAQ,CAACC,MAAM,CAACvK,KAAK,GAAG,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC;MAC/C,IAAI,CAACE,MAAM,CAACsK,mBAAmB,EAAE;MACjC,OAAO,IAAI;IACf;IACA,OAAO,KAAK;EAChB;EACAsF,QAAQ,GAAG;IACP,IAAI,CAAC,IAAI,CAAC5P,MAAM,EAAE;MACdpC,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,mDAAmD,CAAC;MACrE,OAAO,KAAK;IAChB;IACA,IAAI5P,KAAK,GAAG,IAAI,CAACA,KAAK;IACtB,IAAIA,KAAK,GAAG,CAAC,EAAE;MACX,IAAI,CAACE,MAAM,CAACoK,QAAQ,CAACC,MAAM,CAACvK,KAAK,EAAE,CAAC,CAAC;MACrC,IAAI,CAACE,MAAM,CAACoK,QAAQ,CAACC,MAAM,CAACvK,KAAK,GAAG,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC;MAC/C,IAAI,CAACE,MAAM,CAACsK,mBAAmB,EAAE;MACjC,OAAO,IAAI;IACf;IACA,OAAO,KAAK;EAChB;EACAuF,YAAY,GAAG;IACX,IAAI,CAAC,IAAI,CAAC7P,MAAM,EAAE;MACdpC,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,uDAAuD,CAAC;MACzE,OAAO,KAAK;IAChB;IACA,IAAI5P,KAAK,GAAG,IAAI,CAACA,KAAK;IACtB,IAAIA,KAAK,GAAG,CAAC,EAAE;MACX,IAAI,CAACE,MAAM,CAACoK,QAAQ,CAACC,MAAM,CAACvK,KAAK,EAAE,CAAC,CAAC;MACrC,IAAI,CAACE,MAAM,CAACoK,QAAQ,CAACkF,OAAO,CAAC,IAAI,CAAC;MAClC,IAAI,CAACtP,MAAM,CAACsK,mBAAmB,EAAE;MACjC,OAAO,IAAI;IACf;IACA,OAAO,KAAK;EAChB;EACAwF,SAAS,CAACC,MAAM,EAAE;IACd,IAAI,CAAC,IAAI,CAAC/P,MAAM,EAAE;MACdpC,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,kDAAkD,CAAC;MACpE,OAAO,IAAI;IACf;IACA,IAAIK,MAAM,GAAG,CAAC,IAAIA,MAAM,IAAI,IAAI,CAAC/P,MAAM,CAACoK,QAAQ,CAAC1C,MAAM,EAAE;MACrD9J,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,mBAAmB,GAChCK,MAAM,GACN,8GAA8G,IAC7G,IAAI,CAAC/P,MAAM,CAACoK,QAAQ,CAAC1C,MAAM,GAAG,CAAC,CAAC,GACjC,GAAG,CAAC;IACZ;IACA,IAAI5H,KAAK,GAAG,IAAI,CAACA,KAAK;IACtB,IAAI,CAACE,MAAM,CAACoK,QAAQ,CAACC,MAAM,CAACvK,KAAK,EAAE,CAAC,CAAC;IACrC,IAAI,CAACE,MAAM,CAACoK,QAAQ,CAACC,MAAM,CAAC0F,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC;IAC5C,IAAI,CAAC/P,MAAM,CAACsK,mBAAmB,EAAE;IACjC,OAAO,IAAI;EACf;EACA0F,kBAAkB,GAAG;IACjB,OAAO,IAAI,CAAC7O,SAAS,CAAChD,gBAAgB,EAAE,IAAI,CAAC8R,mBAAmB,CAAC;EACrE;EACAA,mBAAmB,GAAG;IAClB,IAAIC,UAAU,GAAG,IAAI,CAACC,OAAO,EAAE;IAC/B,IAAInQ,MAAM,GAAG,IAAI,CAACuD,SAAS,EAAE;IAC7B,IAAIvD,MAAM,IAAI,CAACA,MAAM,CAACQ,aAAa,EAAE;MACjC0P,UAAU,IAAIlQ,MAAM,CAACgQ,kBAAkB,EAAE;IAC7C;IACA,OAAOE,UAAU;EACrB;EACAE,MAAM,CAACC,YAAY,EAAE;IACjB,IAAI,IAAI,CAAC9M,SAAS,EAAE,KAAK8M,YAAY,EAAE;MACnC,IAAI,CAACnG,OAAO,EAAE;MACdmG,YAAY,CAACC,GAAG,CAAC,IAAI,CAAC;IAC1B;IACA,OAAO,IAAI;EACf;EACAC,QAAQ,GAAG;IACP,IAAIC,GAAG,GAAG,CAAC,CAAC;MAAE3Q,KAAK,GAAG,IAAI,CAACiL,QAAQ,EAAE;MAAEE,GAAG;MAAEyF,GAAG;MAAE3O,MAAM;MAAE4O,YAAY;MAAEC,cAAc;IACrFH,GAAG,CAAC3Q,KAAK,GAAG,CAAC,CAAC;IACd,KAAKmL,GAAG,IAAInL,KAAK,EAAE;MACf4Q,GAAG,GAAG5Q,KAAK,CAACmL,GAAG,CAAC;MAChB2F,cAAc,GACV/S,MAAM,CAAC+E,IAAI,CAACiO,QAAQ,CAACH,GAAG,CAAC,IAAI,CAAC7S,MAAM,CAAC+E,IAAI,CAACkO,cAAc,CAACJ,GAAG,CAAC,IAAI,CAAC7S,MAAM,CAAC+E,IAAI,CAACmO,QAAQ,CAACL,GAAG,CAAC;MAC/F,IAAIE,cAAc,EAAE;QAChB;MACJ;MACA7O,MAAM,GAAG,OAAO,IAAI,CAACkJ,GAAG,CAAC,KAAK,UAAU,IAAI,IAAI,CAACA,GAAG,CAAC;MACrD,OAAOnL,KAAK,CAACmL,GAAG,CAAC;MACjB0F,YAAY,GAAG5O,MAAM,GAAGA,MAAM,CAACL,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI;MAChD5B,KAAK,CAACmL,GAAG,CAAC,GAAGyF,GAAG;MAChB,IAAIC,YAAY,KAAKD,GAAG,EAAE;QACtBD,GAAG,CAAC3Q,KAAK,CAACmL,GAAG,CAAC,GAAGyF,GAAG;MACxB;IACJ;IACAD,GAAG,CAACO,SAAS,GAAG,IAAI,CAACC,YAAY,EAAE;IACnC,OAAOpT,MAAM,CAAC+E,IAAI,CAACsO,mBAAmB,CAACT,GAAG,CAAC;EAC/C;EACAU,MAAM,GAAG;IACL,OAAOC,IAAI,CAACC,SAAS,CAAC,IAAI,CAACb,QAAQ,EAAE,CAAC;EAC1C;EACAhN,SAAS,GAAG;IACR,OAAO,IAAI,CAACvD,MAAM;EACtB;EACAyJ,aAAa,CAACH,QAAQ,EAAE+H,WAAW,EAAE9H,QAAQ,EAAE;IAC3C,IAAI+H,GAAG,GAAG,EAAE;IACZ,IAAID,WAAW,IAAI,IAAI,CAACE,QAAQ,CAACjI,QAAQ,CAAC,EAAE;MACxCgI,GAAG,CAAC3I,IAAI,CAAC,IAAI,CAAC;IAClB;IACA,IAAI6I,QAAQ,GAAG,IAAI,CAACxR,MAAM;IAC1B,OAAOwR,QAAQ,EAAE;MACb,IAAIA,QAAQ,KAAKjI,QAAQ,EAAE;QACvB,OAAO+H,GAAG;MACd;MACA,IAAIE,QAAQ,CAACD,QAAQ,CAACjI,QAAQ,CAAC,EAAE;QAC7BgI,GAAG,CAAC3I,IAAI,CAAC6I,QAAQ,CAAC;MACtB;MACAA,QAAQ,GAAGA,QAAQ,CAACxR,MAAM;IAC9B;IACA,OAAOsR,GAAG;EACd;EACAG,YAAY,CAAC1F,IAAI,EAAE;IACf,OAAO,KAAK;EAChB;EACA2F,YAAY,CAACpI,QAAQ,EAAE+H,WAAW,EAAE9H,QAAQ,EAAE;IAC1C,OAAO,IAAI,CAACE,aAAa,CAACH,QAAQ,EAAE+H,WAAW,EAAE9H,QAAQ,CAAC,CAAC,CAAC,CAAC;EACjE;EACAgI,QAAQ,CAACjI,QAAQ,EAAE;IACf,IAAI,CAACA,QAAQ,EAAE;MACX,OAAO,KAAK;IAChB;IACA,IAAI,OAAOA,QAAQ,KAAK,UAAU,EAAE;MAChC,OAAOA,QAAQ,CAAC,IAAI,CAAC;IACzB;IACA,IAAIqI,WAAW,GAAGrI,QAAQ,CAACsI,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAACrJ,KAAK,CAAC,GAAG,CAAC;MAAEjB,GAAG,GAAGqK,WAAW,CAACjK,MAAM;MAAEF,CAAC;MAAEqK,GAAG;IACzF,KAAKrK,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,GAAG,EAAEE,CAAC,EAAE,EAAE;MACtBqK,GAAG,GAAGF,WAAW,CAACnK,CAAC,CAAC;MACpB,IAAI,CAAC5J,MAAM,CAAC+E,IAAI,CAACmP,eAAe,CAACD,GAAG,CAAC,EAAE;QACnCjU,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,YAAY,GACzBmC,GAAG,GACH,yEAAyE,CAAC;QAC9EjU,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,8GAA8G,CAAC;QAChI9R,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,0BAA0B,CAAC;MAChD;MACA,IAAImC,GAAG,CAACE,MAAM,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;QACvB,IAAI,IAAI,CAACC,EAAE,EAAE,KAAKH,GAAG,CAAC7E,KAAK,CAAC,CAAC,CAAC,EAAE;UAC5B,OAAO,IAAI;QACf;MACJ,CAAC,MACI,IAAI6E,GAAG,CAACE,MAAM,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;QAC5B,IAAI,IAAI,CAACE,OAAO,CAACJ,GAAG,CAAC7E,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE;UAC5B,OAAO,IAAI;QACf;MACJ,CAAC,MACI,IAAI,IAAI,CAAC+D,SAAS,KAAKc,GAAG,IAAI,IAAI,CAAC7F,QAAQ,KAAK6F,GAAG,EAAE;QACtD,OAAO,IAAI;MACf;IACJ;IACA,OAAO,KAAK;EAChB;EACAlG,QAAQ,GAAG;IACP,IAAI3L,MAAM,GAAG,IAAI,CAACuD,SAAS,EAAE;IAC7B,OAAOvD,MAAM,GAAGA,MAAM,CAAC2L,QAAQ,EAAE,GAAG,IAAI;EAC5C;EACAsB,QAAQ,GAAG;IACP,OAAO,IAAI,CAAC9L,SAAS,CAACjC,KAAK,EAAE,IAAI,CAACgT,SAAS,CAAC;EAChD;EACAA,SAAS,GAAG;IACR,IAAIlS,MAAM,GAAG,IAAI,CAACuD,SAAS,EAAE;IAC7B,IAAIvD,MAAM,EAAE;MACR,OAAOA,MAAM,CAACiN,QAAQ,EAAE;IAC5B,CAAC,MACI;MACD,OAAOzL,SAAS;IACpB;EACJ;EACAa,IAAI,CAAC8P,SAAS,EAAoB;IAAA,IAAlBlJ,GAAG,uEAAG,CAAC,CAAC;IAAA,IAAEmJ,MAAM;IAC5BnJ,GAAG,CAACC,MAAM,GAAGD,GAAG,CAACC,MAAM,IAAI,IAAI;IAC/B,IAAIkJ,MAAM,EAAE;MACR,IAAI,CAACC,cAAc,CAACF,SAAS,EAAElJ,GAAG,CAAC;IACvC,CAAC,MACI;MACD,IAAI,CAACqJ,KAAK,CAACH,SAAS,EAAElJ,GAAG,CAAC;IAC9B;IACA,OAAO,IAAI;EACf;EACAlD,oBAAoB,CAACP,GAAG,EAAE;IACtB,IAAIA,GAAG,EAAE;MACL,OAAO,IAAI,CAAC+I,qBAAqB,CAAC/I,GAAG,CAAC;IAC1C,CAAC,MACI;MACD,OAAO,IAAI,CAACrE,SAAS,CAAC9C,kBAAkB,EAAE,IAAI,CAACkQ,qBAAqB,CAAC;IACzE;EACJ;EACAA,qBAAqB,CAAC/I,GAAG,EAAE;IACvB,IAAI+M,EAAE;IACN,IAAI/M,GAAG,EAAE;MACL+M,EAAE,GAAG,IAAI3U,MAAM,CAACoQ,SAAS,EAAE;MAC3B,IAAI,CAACoB,oBAAoB,CAAC,UAAUrD,IAAI,EAAE;QACtC,IAAIyG,iBAAiB,GAAGzG,IAAI,CAACyG,iBAAiB,EAAE;QAChD,IAAIA,iBAAiB,KAAK,KAAK,EAAE;UAC7BD,EAAE,CAACE,QAAQ,CAAC1G,IAAI,CAAC2G,YAAY,EAAE,CAAC;QACpC,CAAC,MACI,IAAIF,iBAAiB,KAAK,UAAU,EAAE;UACvCD,EAAE,CAAC1N,SAAS,CAACkH,IAAI,CAAC/I,CAAC,EAAE,GAAG+I,IAAI,CAAC6C,OAAO,EAAE,EAAE7C,IAAI,CAAC9I,CAAC,EAAE,GAAG8I,IAAI,CAAC8C,OAAO,EAAE,CAAC;QACtE;MACJ,CAAC,EAAErJ,GAAG,CAAC;MACP,OAAO+M,EAAE;IACb,CAAC,MACI;MACDA,EAAE,GAAG,IAAI,CAACtS,MAAM,CAACc,GAAG,CAAC1C,kBAAkB,CAAC,IAAI,IAAIT,MAAM,CAACoQ,SAAS,EAAE;MAClE,IAAI,IAAI,CAAChO,MAAM,EAAE;QACb,IAAI,CAACA,MAAM,CAAC+F,oBAAoB,EAAE,CAAC4M,QAAQ,CAACJ,EAAE,CAAC;MACnD,CAAC,MACI;QACDA,EAAE,CAACK,KAAK,EAAE;MACd;MACA,IAAIJ,iBAAiB,GAAG,IAAI,CAACA,iBAAiB,EAAE;MAChD,IAAIA,iBAAiB,KAAK,KAAK,EAAE;QAC7BD,EAAE,CAACE,QAAQ,CAAC,IAAI,CAACC,YAAY,EAAE,CAAC;MACpC,CAAC,MACI,IAAIF,iBAAiB,KAAK,UAAU,EAAE;QACvC,MAAMxP,CAAC,GAAG,IAAI,CAACnD,KAAK,CAACmD,CAAC,IAAI,CAAC;QAC3B,MAAMC,CAAC,GAAG,IAAI,CAACpD,KAAK,CAACoD,CAAC,IAAI,CAAC;QAC3B,MAAM2L,OAAO,GAAG,IAAI,CAAC/O,KAAK,CAAC+O,OAAO,IAAI,CAAC;QACvC,MAAMC,OAAO,GAAG,IAAI,CAAChP,KAAK,CAACgP,OAAO,IAAI,CAAC;QACvC0D,EAAE,CAAC1N,SAAS,CAAC7B,CAAC,GAAG4L,OAAO,EAAE3L,CAAC,GAAG4L,OAAO,CAAC;MAC1C;MACA0D,EAAE,CAACvR,KAAK,GAAG,KAAK;MAChB,OAAOuR,EAAE;IACb;EACJ;EACAM,gBAAgB,CAACrN,GAAG,EAAE;IAClB,IAAIxF,MAAM,GAAG,IAAI;IACjB,OAAOA,MAAM,EAAE;MACX,IAAIA,MAAM,CAACQ,aAAa,EAAE;QACtBgF,GAAG,GAAGxF,MAAM;MAChB;MACAA,MAAM,GAAGA,MAAM,CAACuD,SAAS,EAAE;IAC/B;IACA,MAAMiK,SAAS,GAAG,IAAI,CAACzH,oBAAoB,CAACP,GAAG,CAAC;IAChD,MAAM3F,KAAK,GAAG2N,SAAS,CAACsF,SAAS,EAAE;IACnC,OAAO;MACH9P,CAAC,EAAEnD,KAAK,CAAC6O,MAAM;MACfzL,CAAC,EAAEpD,KAAK,CAAC8O;IACb,CAAC;EACL;EACAoE,mBAAmB,GAAG;IAClB,OAAO,IAAI,CAAChN,oBAAoB,EAAE,CAAC+M,SAAS,EAAE,CAACrE,QAAQ;EAC3D;EACAiE,YAAY,GAAG;IACX,OAAO,IAAI,CAACvR,SAAS,CAAChC,SAAS,EAAE,IAAI,CAAC6T,aAAa,CAAC;EACxD;EACAA,aAAa,GAAG;IACZ,IAAIC,EAAE,EAAEC,EAAE;IACV,IAAIjF,CAAC,GAAG,IAAI,CAAChO,MAAM,CAACc,GAAG,CAAC5B,SAAS,CAAC,IAAI,IAAIvB,MAAM,CAACoQ,SAAS,EAAE;IAC5DC,CAAC,CAAC2E,KAAK,EAAE;IACT,IAAI5P,CAAC,GAAG,IAAI,CAACA,CAAC,EAAE;MAAEC,CAAC,GAAG,IAAI,CAACA,CAAC,EAAE;MAAEwL,QAAQ,GAAGzQ,QAAQ,CAACkO,KAAK,CAACiH,QAAQ,CAAC,IAAI,CAAC1E,QAAQ,EAAE,CAAC;MAAEC,MAAM,GAAG,CAACuE,EAAE,GAAG,IAAI,CAACpT,KAAK,CAAC6O,MAAM,MAAM,IAAI,IAAIuE,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,CAAC;MAAEtE,MAAM,GAAG,CAACuE,EAAE,GAAG,IAAI,CAACrT,KAAK,CAAC8O,MAAM,MAAM,IAAI,IAAIuE,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,CAAC;MAAEpE,KAAK,GAAG,IAAI,CAACjP,KAAK,CAACiP,KAAK,IAAI,CAAC;MAAEC,KAAK,GAAG,IAAI,CAAClP,KAAK,CAACkP,KAAK,IAAI,CAAC;MAAEH,OAAO,GAAG,IAAI,CAAC/O,KAAK,CAAC+O,OAAO,IAAI,CAAC;MAAEC,OAAO,GAAG,IAAI,CAAChP,KAAK,CAACgP,OAAO,IAAI,CAAC;IACnW,IAAI7L,CAAC,KAAK,CAAC,IAAIC,CAAC,KAAK,CAAC,EAAE;MACpBgL,CAAC,CAACpJ,SAAS,CAAC7B,CAAC,EAAEC,CAAC,CAAC;IACrB;IACA,IAAIwL,QAAQ,KAAK,CAAC,EAAE;MAChBR,CAAC,CAACsB,MAAM,CAACd,QAAQ,CAAC;IACtB;IACA,IAAIK,KAAK,KAAK,CAAC,IAAIC,KAAK,KAAK,CAAC,EAAE;MAC5Bd,CAAC,CAACmF,IAAI,CAACtE,KAAK,EAAEC,KAAK,CAAC;IACxB;IACA,IAAIL,MAAM,KAAK,CAAC,IAAIC,MAAM,KAAK,CAAC,EAAE;MAC9BV,CAAC,CAACoF,KAAK,CAAC3E,MAAM,EAAEC,MAAM,CAAC;IAC3B;IACA,IAAIC,OAAO,KAAK,CAAC,IAAIC,OAAO,KAAK,CAAC,EAAE;MAChCZ,CAAC,CAACpJ,SAAS,CAAC,CAAC,CAAC,GAAG+J,OAAO,EAAE,CAAC,CAAC,GAAGC,OAAO,CAAC;IAC3C;IACAZ,CAAC,CAACjN,KAAK,GAAG,KAAK;IACf,OAAOiN,CAAC;EACZ;EACAqF,KAAK,CAAC9C,GAAG,EAAE;IACP,IAAI3Q,KAAK,GAAGjC,MAAM,CAAC+E,IAAI,CAACgH,WAAW,CAAC,IAAI,CAAC9J,KAAK,CAAC;MAAEmL,GAAG;MAAEuI,YAAY;MAAEjM,GAAG;MAAEE,CAAC;MAAEgM,QAAQ;IACpF,KAAKxI,GAAG,IAAIwF,GAAG,EAAE;MACb3Q,KAAK,CAACmL,GAAG,CAAC,GAAGwF,GAAG,CAACxF,GAAG,CAAC;IACzB;IACA,IAAIe,IAAI,GAAG,IAAI,IAAI,CAACtM,WAAW,CAACI,KAAK,CAAC;IACtC,KAAKmL,GAAG,IAAI,IAAI,CAACpL,cAAc,EAAE;MAC7B2T,YAAY,GAAG,IAAI,CAAC3T,cAAc,CAACoL,GAAG,CAAC;MACvC1D,GAAG,GAAGiM,YAAY,CAAC7L,MAAM;MACzB,KAAKF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,GAAG,EAAEE,CAAC,EAAE,EAAE;QACtBgM,QAAQ,GAAGD,YAAY,CAAC/L,CAAC,CAAC;QAC1B,IAAIgM,QAAQ,CAAC5R,IAAI,CAAC6R,OAAO,CAAC/U,KAAK,CAAC,GAAG,CAAC,EAAE;UAClC,IAAI,CAACqN,IAAI,CAACnM,cAAc,CAACoL,GAAG,CAAC,EAAE;YAC3Be,IAAI,CAACnM,cAAc,CAACoL,GAAG,CAAC,GAAG,EAAE;UACjC;UACAe,IAAI,CAACnM,cAAc,CAACoL,GAAG,CAAC,CAACrC,IAAI,CAAC6K,QAAQ,CAAC;QAC3C;MACJ;IACJ;IACA,OAAOzH,IAAI;EACf;EACA2H,cAAc,CAAChU,MAAM,EAAE;IACnBA,MAAM,GAAGA,MAAM,IAAI,CAAC,CAAC;IACrB,IAAIiU,GAAG,GAAG,IAAI,CAACvQ,aAAa,EAAE;IAC9B,IAAIwQ,KAAK,GAAG,IAAI,CAAC3G,QAAQ,EAAE;MAAEjK,CAAC,GAAGtD,MAAM,CAACsD,CAAC,KAAKxB,SAAS,GAAG9B,MAAM,CAACsD,CAAC,GAAGQ,IAAI,CAACG,KAAK,CAACgQ,GAAG,CAAC3Q,CAAC,CAAC;MAAEC,CAAC,GAAGvD,MAAM,CAACuD,CAAC,KAAKzB,SAAS,GAAG9B,MAAM,CAACuD,CAAC,GAAGO,IAAI,CAACG,KAAK,CAACgQ,GAAG,CAAC1Q,CAAC,CAAC;MAAES,UAAU,GAAGhE,MAAM,CAACgE,UAAU,IAAI,CAAC;MAAEmQ,MAAM,GAAG,IAAI9V,QAAQ,CAACkG,WAAW,CAAC;QACtNf,KAAK,EAAExD,MAAM,CAACwD,KAAK,IAAIM,IAAI,CAACC,IAAI,CAACkQ,GAAG,CAACzQ,KAAK,CAAC,KAAK0Q,KAAK,GAAGA,KAAK,CAAC1Q,KAAK,EAAE,GAAG,CAAC,CAAC;QAC1EC,MAAM,EAAEzD,MAAM,CAACyD,MAAM,IACjBK,IAAI,CAACC,IAAI,CAACkQ,GAAG,CAACxQ,MAAM,CAAC,KACpByQ,KAAK,GAAGA,KAAK,CAACzQ,MAAM,EAAE,GAAG,CAAC,CAAC;QAChCO,UAAU,EAAEA;MAChB,CAAC,CAAC;MAAE4C,OAAO,GAAGuN,MAAM,CAACtP,UAAU,EAAE;IACjC,IAAI7E,MAAM,CAACgF,qBAAqB,KAAK,KAAK,EAAE;MACxC4B,OAAO,CAAC3B,QAAQ,CAACD,qBAAqB,GAAG,KAAK;IAClD;IACA4B,OAAO,CAAC1B,IAAI,EAAE;IACd,IAAI5B,CAAC,IAAIC,CAAC,EAAE;MACRqD,OAAO,CAACzB,SAAS,CAAC,CAAC,CAAC,GAAG7B,CAAC,EAAE,CAAC,CAAC,GAAGC,CAAC,CAAC;IACrC;IACA,IAAI,CAAC6B,SAAS,CAAC+O,MAAM,CAAC;IACtBvN,OAAO,CAACtB,OAAO,EAAE;IACjB,OAAO6O,MAAM;EACjB;EACAC,QAAQ,CAACpU,MAAM,EAAE;IACb,OAAO,IAAI,CAACgU,cAAc,CAAChU,MAAM,CAAC,CAACoH,OAAO;EAC9C;EACAiN,SAAS,CAACrU,MAAM,EAAE;IACdA,MAAM,GAAGA,MAAM,IAAI,CAAC,CAAC;IACrB,IAAIsU,QAAQ,GAAGtU,MAAM,CAACsU,QAAQ,IAAI,IAAI;MAAEC,OAAO,GAAGvU,MAAM,CAACuU,OAAO,IAAI,IAAI;IACxE,IAAIC,GAAG,GAAG,IAAI,CAACR,cAAc,CAAChU,MAAM,CAAC,CAACqU,SAAS,CAACC,QAAQ,EAAEC,OAAO,CAAC;IAClE,IAAIvU,MAAM,CAACmJ,QAAQ,EAAE;MACjBnJ,MAAM,CAACmJ,QAAQ,CAACqL,GAAG,CAAC;IACxB;IACA,OAAOA,GAAG;EACd;EACAC,OAAO,CAACzU,MAAM,EAAE;IACZ,OAAO,IAAI0U,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACpC,IAAI;QACA,MAAMzL,QAAQ,GAAGnJ,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,MAAM,CAACmJ,QAAQ;QAChF,IAAIA,QAAQ,EACR,OAAOnJ,MAAM,CAACmJ,QAAQ;QAC1BjL,MAAM,CAAC+E,IAAI,CAAC4R,WAAW,CAAC,IAAI,CAACR,SAAS,CAACrU,MAAM,CAAC,EAAE,UAAU8U,GAAG,EAAE;UAC3DH,OAAO,CAACG,GAAG,CAAC;UACZ3L,QAAQ,KAAK,IAAI,IAAIA,QAAQ,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,QAAQ,CAAC2L,GAAG,CAAC;QACrE,CAAC,CAAC;MACN,CAAC,CACD,OAAOC,GAAG,EAAE;QACRH,MAAM,CAACG,GAAG,CAAC;MACf;IACJ,CAAC,CAAC;EACN;EACAC,MAAM,CAAChV,MAAM,EAAE;IACX,OAAO,IAAI0U,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACpC,IAAI;QACA,MAAMzL,QAAQ,GAAGnJ,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,MAAM,CAACmJ,QAAQ;QAChF,IAAIA,QAAQ,EACR,OAAOnJ,MAAM,CAACmJ,QAAQ;QAC1B,IAAI,CAACiL,QAAQ,CAACpU,MAAM,CAAC,CAACgV,MAAM,CAAEC,IAAI,IAAK;UACnCN,OAAO,CAACM,IAAI,CAAC;UACb9L,QAAQ,KAAK,IAAI,IAAIA,QAAQ,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,QAAQ,CAAC8L,IAAI,CAAC;QACtE,CAAC,CAAC;MACN,CAAC,CACD,OAAOF,GAAG,EAAE;QACRH,MAAM,CAACG,GAAG,CAAC;MACf;IACJ,CAAC,CAAC;EACN;EACAhN,OAAO,CAACmN,IAAI,EAAE;IACV,IAAI,CAAC1R,KAAK,CAAC0R,IAAI,CAAC1R,KAAK,CAAC;IACtB,IAAI,CAACC,MAAM,CAACyR,IAAI,CAACzR,MAAM,CAAC;IACxB,OAAO,IAAI;EACf;EACA0R,OAAO,GAAG;IACN,OAAO;MACH3R,KAAK,EAAE,IAAI,CAACA,KAAK,EAAE;MACnBC,MAAM,EAAE,IAAI,CAACA,MAAM;IACvB,CAAC;EACL;EACA6N,YAAY,GAAG;IACX,OAAO,IAAI,CAACD,SAAS,IAAI,IAAI,CAAC/E,QAAQ;EAC1C;EACA8I,OAAO,GAAG;IACN,OAAO,IAAI,CAAC9I,QAAQ;EACxB;EACA+I,eAAe,GAAG;IACd,IAAI,IAAI,CAAClV,KAAK,CAACmV,YAAY,KAAKxT,SAAS,EAAE;MACvC,OAAO,IAAI,CAAC3B,KAAK,CAACmV,YAAY;IAClC,CAAC,MACI,IAAI,IAAI,CAAChV,MAAM,EAAE;MAClB,OAAO,IAAI,CAACA,MAAM,CAAC+U,eAAe,EAAE;IACxC,CAAC,MACI;MACD,OAAO/W,QAAQ,CAACkO,KAAK,CAAC8I,YAAY;IACtC;EACJ;EACAjM,IAAI,CAACI,IAAI,EAAEvH,IAAI,EAAEiH,QAAQ,EAAE;IACvB,IAAIoM,YAAY,GAAG,IAAI,CAACrV,cAAc,CAACuJ,IAAI,CAAC;MAAEO,CAAC;MAAEwL,OAAO;MAAEhN,OAAO;IACjE,KAAKwB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuL,YAAY,CAACvN,MAAM,EAAEgC,CAAC,EAAE,EAAE;MACtCwL,OAAO,GAAGD,YAAY,CAACvL,CAAC,CAAC,CAAC9H,IAAI;MAC9BsG,OAAO,GAAG+M,YAAY,CAACvL,CAAC,CAAC,CAACxB,OAAO;MACjC,IAAI,CAACgN,OAAO,KAAK,OAAO,IAAItT,IAAI,KAAK,OAAO,MACvC,CAACA,IAAI,IAAIsT,OAAO,KAAKtT,IAAI,CAAC,KAC1B,CAACiH,QAAQ,IAAIA,QAAQ,KAAKX,OAAO,CAAC,EAAE;QACrC+M,YAAY,CAAC5K,MAAM,CAACX,CAAC,EAAE,CAAC,CAAC;QACzB,IAAIuL,YAAY,CAACvN,MAAM,KAAK,CAAC,EAAE;UAC3B,OAAO,IAAI,CAAC9H,cAAc,CAACuJ,IAAI,CAAC;UAChC;QACJ;QACAO,CAAC,EAAE;MACP;IACJ;EACJ;EACAyL,gBAAgB,CAACrU,IAAI,EAAEsU,MAAM,EAAEC,MAAM,EAAE;IACnC,IAAI,CAAC/C,KAAK,CAACxR,IAAI,GAAGtC,MAAM,EAAE;MACtB4W,MAAM,EAAEA,MAAM;MACdC,MAAM,EAAEA;IACZ,CAAC,CAAC;EACN;EACAC,OAAO,CAAC1T,IAAI,EAAE;IACV,IAAI,CAAC,IAAI,CAACqQ,OAAO,CAACrQ,IAAI,CAAC,EAAE;MACrB,IAAI2T,OAAO,GAAG,IAAI,CAAC3T,IAAI,EAAE;MACzB,IAAI4T,OAAO,GAAGD,OAAO,GAAGA,OAAO,GAAG,GAAG,GAAG3T,IAAI,GAAGA,IAAI;MACnD,IAAI,CAACA,IAAI,CAAC4T,OAAO,CAAC;IACtB;IACA,OAAO,IAAI;EACf;EACAvD,OAAO,CAACrQ,IAAI,EAAE;IACV,IAAI,CAACA,IAAI,EAAE;MACP,OAAO,KAAK;IAChB;IACA,MAAM6T,QAAQ,GAAG,IAAI,CAAC7T,IAAI,EAAE;IAC5B,IAAI,CAAC6T,QAAQ,EAAE;MACX,OAAO,KAAK;IAChB;IACA,IAAIC,KAAK,GAAG,CAACD,QAAQ,IAAI,EAAE,EAAElN,KAAK,CAAC,KAAK,CAAC;IACzC,OAAOmN,KAAK,CAACjC,OAAO,CAAC7R,IAAI,CAAC,KAAK,CAAC,CAAC;EACrC;EACA+T,UAAU,CAAC/T,IAAI,EAAE;IACb,IAAI8T,KAAK,GAAG,CAAC,IAAI,CAAC9T,IAAI,EAAE,IAAI,EAAE,EAAE2G,KAAK,CAAC,KAAK,CAAC;IAC5C,IAAIzI,KAAK,GAAG4V,KAAK,CAACjC,OAAO,CAAC7R,IAAI,CAAC;IAC/B,IAAI9B,KAAK,KAAK,CAAC,CAAC,EAAE;MACd4V,KAAK,CAACrL,MAAM,CAACvK,KAAK,EAAE,CAAC,CAAC;MACtB,IAAI,CAAC8B,IAAI,CAAC8T,KAAK,CAACnW,IAAI,CAAC,GAAG,CAAC,CAAC;IAC9B;IACA,OAAO,IAAI;EACf;EACA4F,OAAO,CAACrE,IAAI,EAAE2P,GAAG,EAAE;IACf,IAAIvD,IAAI,GAAG,IAAI,CAACnO,GAAG,GAAGnB,MAAM,CAAC+E,IAAI,CAAC+H,WAAW,CAAC5J,IAAI,CAAC,CAAC;IACpD,IAAIlD,MAAM,CAAC+E,IAAI,CAACgI,WAAW,CAACuC,IAAI,CAAC,EAAE;MAC/BA,IAAI,CAACzL,IAAI,CAAC,IAAI,EAAEgP,GAAG,CAAC;IACxB,CAAC,MACI;MACD,IAAI,CAACxF,QAAQ,CAACnK,IAAI,EAAE2P,GAAG,CAAC;IAC5B;IACA,OAAO,IAAI;EACf;EACA5N,YAAY,GAAG;IACX,IAAI7E,QAAQ,CAACkO,KAAK,CAAC0J,eAAe,EAAE;MAChC,MAAMC,QAAQ,GAAG,IAAI,CAAClK,QAAQ,EAAE,IAAI,IAAI,CAACsB,QAAQ,EAAE;MACnD4I,QAAQ,KAAK,IAAI,IAAIA,QAAQ,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,QAAQ,CAACC,SAAS,EAAE;IAC5E;EACJ;EACA7K,QAAQ,CAACD,GAAG,EAAEyF,GAAG,EAAE;IACf,IAAI2E,MAAM,GAAG,IAAI,CAACvV,KAAK,CAACmL,GAAG,CAAC;IAC5B,IAAIoK,MAAM,KAAK3E,GAAG,IAAI,CAAC7S,MAAM,CAAC+E,IAAI,CAACiO,QAAQ,CAACH,GAAG,CAAC,EAAE;MAC9C;IACJ;IACA,IAAIA,GAAG,KAAKjP,SAAS,IAAIiP,GAAG,KAAK,IAAI,EAAE;MACnC,OAAO,IAAI,CAAC5Q,KAAK,CAACmL,GAAG,CAAC;IAC1B,CAAC,MACI;MACD,IAAI,CAACnL,KAAK,CAACmL,GAAG,CAAC,GAAGyF,GAAG;IACzB;IACA,IAAI,IAAI,CAAC/P,uBAAuB,EAAE;MAC9B,IAAI,CAACyU,gBAAgB,CAACnK,GAAG,EAAEoK,MAAM,EAAE3E,GAAG,CAAC;IAC3C;IACA,IAAI,CAAC5N,YAAY,EAAE;EACvB;EACAkT,iBAAiB,CAAC/K,GAAG,EAAEgL,SAAS,EAAEvF,GAAG,EAAE;IACnC,IAAI2E,MAAM;IACV,IAAI3E,GAAG,KAAKjP,SAAS,EAAE;MACnB4T,MAAM,GAAG,IAAI,CAACvV,KAAK,CAACmL,GAAG,CAAC;MACxB,IAAI,CAACoK,MAAM,EAAE;QACT,IAAI,CAACvV,KAAK,CAACmL,GAAG,CAAC,GAAG,IAAI,CAACR,OAAO,CAACQ,GAAG,CAAC;MACvC;MACA,IAAI,CAACnL,KAAK,CAACmL,GAAG,CAAC,CAACgL,SAAS,CAAC,GAAGvF,GAAG;MAChC,IAAI,CAAC0E,gBAAgB,CAACnK,GAAG,EAAEoK,MAAM,EAAE3E,GAAG,CAAC;IAC3C;EACJ;EACA4B,cAAc,CAACF,SAAS,EAAElJ,GAAG,EAAEgN,YAAY,EAAE;IACzC,IAAIhN,GAAG,IAAI,IAAI,CAAC+C,QAAQ,KAAKhN,KAAK,EAAE;MAChCiK,GAAG,CAACC,MAAM,GAAG,IAAI;IACrB;IACA,IAAIgN,UAAU,GAAG,CAAC/D,SAAS,KAAKvT,UAAU,IAAIuT,SAAS,KAAKtT,UAAU,MAChEoX,YAAY,KACT,IAAI,KAAKA,YAAY,IACjB,IAAI,CAACxE,YAAY,IAAI,IAAI,CAACA,YAAY,CAACwE,YAAY,CAAE,CAAC,IAC1D,IAAI,CAACjK,QAAQ,KAAK,OAAO,IAAI,CAACiK,YAAa,CAAC;IACrD,IAAI,CAACC,UAAU,EAAE;MACb,IAAI,CAAC5D,KAAK,CAACH,SAAS,EAAElJ,GAAG,CAAC;MAC1B,IAAIkN,UAAU,GAAG,CAAChE,SAAS,KAAKvT,UAAU,IAAIuT,SAAS,KAAKtT,UAAU,KAClEoX,YAAY,IACZA,YAAY,CAACxE,YAAY,IACzBwE,YAAY,CAACxE,YAAY,CAAC,IAAI,CAAC,IAC/B,CAACwE,YAAY,CAACxE,YAAY,CAAC,IAAI,CAACzR,MAAM,CAAC;MAC3C,IAAI,CAAEiJ,GAAG,IAAI,CAACA,GAAG,CAACmN,YAAY,IAAK,CAACnN,GAAG,KACnC,IAAI,CAACjJ,MAAM,IACX,IAAI,CAACA,MAAM,CAACkL,WAAW,EAAE,IACzB,CAACiL,UAAU,EAAE;QACb,IAAIF,YAAY,IAAIA,YAAY,CAACjW,MAAM,EAAE;UACrC,IAAI,CAACqS,cAAc,CAAC5Q,IAAI,CAAC,IAAI,CAACzB,MAAM,EAAEmS,SAAS,EAAElJ,GAAG,EAAEgN,YAAY,CAAC;QACvE,CAAC,MACI;UACD,IAAI,CAAC5D,cAAc,CAAC5Q,IAAI,CAAC,IAAI,CAACzB,MAAM,EAAEmS,SAAS,EAAElJ,GAAG,CAAC;QACzD;MACJ;IACJ;EACJ;EACAoN,kBAAkB,CAAClE,SAAS,EAAE;IAC1B,IAAIc,EAAE,EAAEC,EAAE,EAAEoD,EAAE;IACd,MAAM/C,YAAY,GAAG,CAACN,EAAE,GAAG,IAAI,CAAChT,MAAM,CAACc,GAAG,CAAC3C,aAAa,CAAC,MAAM,IAAI,IAAI6U,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,CAAC,CAAC;IAC9F,IAAI3K,MAAM,GAAGiL,YAAY,KAAK,IAAI,IAAIA,YAAY,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,YAAY,CAACpB,SAAS,CAAC;IAChG,IAAI7J,MAAM,KAAK9G,SAAS,EAAE;MACtB8G,MAAM,GAAG,EAAE;MACX,IAAIkI,GAAG,GAAGjT,MAAM,CAACgZ,cAAc,CAAC,IAAI,CAAC;MACrC,OAAO/F,GAAG,EAAE;QACR,MAAMgG,eAAe,GAAG,CAACF,EAAE,GAAG,CAACpD,EAAE,GAAG1C,GAAG,CAAC5Q,cAAc,MAAM,IAAI,IAAIsT,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACf,SAAS,CAAC,MAAM,IAAI,IAAImE,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,EAAE;QAC/IhO,MAAM,CAACK,IAAI,CAAC,GAAG6N,eAAe,CAAC;QAC/BhG,GAAG,GAAGjT,MAAM,CAACgZ,cAAc,CAAC/F,GAAG,CAAC;MACpC;MACA+C,YAAY,CAACpB,SAAS,CAAC,GAAG7J,MAAM;MAChC,IAAI,CAACrI,MAAM,CAACyB,GAAG,CAACtD,aAAa,EAAEmV,YAAY,CAAC;IAChD;IACA,OAAOjL,MAAM;EACjB;EACAgK,KAAK,CAACH,SAAS,EAAElJ,GAAG,EAAE;IAClBA,GAAG,GAAGA,GAAG,IAAI,CAAC,CAAC;IACfA,GAAG,CAACW,aAAa,GAAG,IAAI;IACxBX,GAAG,CAACE,IAAI,GAAGgJ,SAAS;IACpB,MAAMsE,YAAY,GAAG,IAAI,CAACJ,kBAAkB,CAAClE,SAAS,CAAC;IACvD,IAAIsE,YAAY,EAAE;MACd,KAAK,IAAI/M,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG+M,YAAY,CAAC/O,MAAM,EAAEgC,CAAC,EAAE,EAAE;QAC1C+M,YAAY,CAAC/M,CAAC,CAAC,CAACxB,OAAO,CAACzG,IAAI,CAAC,IAAI,EAAEwH,GAAG,CAAC;MAC3C;IACJ;IACA,MAAMyN,aAAa,GAAG,IAAI,CAAC9W,cAAc,CAACuS,SAAS,CAAC;IACpD,IAAIuE,aAAa,EAAE;MACf,KAAK,IAAIhN,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgN,aAAa,CAAChP,MAAM,EAAEgC,CAAC,EAAE,EAAE;QAC3CgN,aAAa,CAAChN,CAAC,CAAC,CAACxB,OAAO,CAACzG,IAAI,CAAC,IAAI,EAAEwH,GAAG,CAAC;MAC5C;IACJ;EACJ;EACA0N,IAAI,GAAG;IACH,IAAI,CAAC7R,SAAS,EAAE;IAChB,IAAI,CAACC,OAAO,EAAE;IACd,OAAO,IAAI;EACf;EACA6R,kBAAkB,CAAC3N,GAAG,EAAE;IACpB,IAAI4N,SAAS,GAAG5N,GAAG,GAAGA,GAAG,CAAC4N,SAAS,GAAGrV,SAAS;IAC/C,IAAIoS,KAAK,GAAG,IAAI,CAAC3G,QAAQ,EAAE;IAC3B,IAAI6J,EAAE,GAAG,IAAI,CAACnJ,mBAAmB,EAAE;IACnC,IAAIP,GAAG,GAAGwG,KAAK,CAACmD,eAAe,CAACF,SAAS,CAAC,IACtCjD,KAAK,CAACoD,wBAAwB,CAAC,CAAC,CAAC,IACjCF,EAAE;IACN7Y,aAAa,CAAC+L,EAAE,CAACC,aAAa,CAACvI,GAAG,CAAC,IAAI,CAAC/B,GAAG,EAAE;MACzCoM,IAAI,EAAE,IAAI;MACVkL,eAAe,EAAE7J,GAAG;MACpBxJ,MAAM,EAAE;QACJZ,CAAC,EAAEoK,GAAG,CAACpK,CAAC,GAAG8T,EAAE,CAAC9T,CAAC;QACfC,CAAC,EAAEmK,GAAG,CAACnK,CAAC,GAAG6T,EAAE,CAAC7T;MAClB,CAAC;MACD6I,UAAU,EAAE,OAAO;MACnB+K;IACJ,CAAC,CAAC;EACN;EACAK,SAAS,CAACjO,GAAG,EAAsB;IAAA,IAApBkO,WAAW,uEAAG,IAAI;IAC7B,IAAI,CAAClZ,aAAa,CAAC+L,EAAE,CAACC,aAAa,CAAC1H,GAAG,CAAC,IAAI,CAAC5C,GAAG,CAAC,EAAE;MAC/C,IAAI,CAACiX,kBAAkB,CAAC3N,GAAG,CAAC;IAChC;IACA,MAAM4C,IAAI,GAAG5N,aAAa,CAAC+L,EAAE,CAACC,aAAa,CAAClJ,GAAG,CAAC,IAAI,CAACpB,GAAG,CAAC;IACzDkM,IAAI,CAACC,UAAU,GAAG,UAAU;IAC5B,IAAI,CAACzJ,IAAI,CAAC,WAAW,EAAE;MACnB8G,IAAI,EAAE,WAAW;MACjBD,MAAM,EAAE,IAAI;MACZD,GAAG,EAAEA,GAAG,IAAIA,GAAG,CAACA;IACpB,CAAC,EAAEkO,WAAW,CAAC;EACnB;EACAC,gBAAgB,CAACnO,GAAG,EAAE4C,IAAI,EAAE;IACxB,MAAMuB,GAAG,GAAG,IAAI,CAACH,QAAQ,EAAE,CAAC8J,eAAe,CAAClL,IAAI,CAACgL,SAAS,CAAC;IAC3D,IAAI,CAACzJ,GAAG,EAAE;MACN;IACJ;IACA,IAAIiK,UAAU,GAAG;MACbrU,CAAC,EAAEoK,GAAG,CAACpK,CAAC,GAAG6I,IAAI,CAACjI,MAAM,CAACZ,CAAC;MACxBC,CAAC,EAAEmK,GAAG,CAACnK,CAAC,GAAG4I,IAAI,CAACjI,MAAM,CAACX;IAC3B,CAAC;IACD,IAAIqU,GAAG,GAAG,IAAI,CAACC,aAAa,EAAE;IAC9B,IAAID,GAAG,KAAK9V,SAAS,EAAE;MACnB,MAAMgW,OAAO,GAAGF,GAAG,CAAC7V,IAAI,CAAC,IAAI,EAAE4V,UAAU,EAAEpO,GAAG,CAAC;MAC/C,IAAI,CAACuO,OAAO,EAAE;QACV5Z,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,gIAAgI,CAAC;MACtJ,CAAC,MACI;QACD2H,UAAU,GAAGG,OAAO;MACxB;IACJ;IACA,IAAI,CAAC,IAAI,CAACpX,QAAQ,IACd,IAAI,CAACA,QAAQ,CAAC4C,CAAC,KAAKqU,UAAU,CAACrU,CAAC,IAChC,IAAI,CAAC5C,QAAQ,CAAC6C,CAAC,KAAKoU,UAAU,CAACpU,CAAC,EAAE;MAClC,IAAI,CAACkL,mBAAmB,CAACkJ,UAAU,CAAC;MACpC,IAAI,CAACxU,YAAY,EAAE;IACvB;IACA,IAAI,CAACzC,QAAQ,GAAGiX,UAAU;EAC9B;EACAtN,QAAQ,CAACd,GAAG,EAAE;IACV,MAAM4C,IAAI,GAAG5N,aAAa,CAAC+L,EAAE,CAACC,aAAa,CAAClJ,GAAG,CAAC,IAAI,CAACpB,GAAG,CAAC;IACzD,IAAIkM,IAAI,EAAE;MACNA,IAAI,CAACC,UAAU,GAAG,SAAS;IAC/B;IACA7N,aAAa,CAAC+L,EAAE,CAACyN,cAAc,CAACxO,GAAG,CAAC;IACpChL,aAAa,CAAC+L,EAAE,CAAC0N,aAAa,CAACzO,GAAG,CAAC;EACvC;EACA0O,YAAY,CAACC,SAAS,EAAE;IACpB,IAAI,CAAC3M,QAAQ,CAAC,WAAW,EAAE2M,SAAS,CAAC;IACrC,IAAI,CAACC,WAAW,EAAE;EACtB;EACA/N,UAAU,GAAG;IACT,MAAM+B,IAAI,GAAG5N,aAAa,CAAC+L,EAAE,CAACC,aAAa,CAAClJ,GAAG,CAAC,IAAI,CAACpB,GAAG,CAAC;IACzD,OAAOkM,IAAI,GAAGA,IAAI,CAACC,UAAU,KAAK,UAAU,GAAG,KAAK;EACxD;EACAgM,WAAW,GAAG;IACV,IAAI,CAACC,YAAY,EAAE;IACnB,IAAI,CAAC7V,EAAE,CAAC,kCAAkC,EAAE,UAAU+G,GAAG,EAAE;MACvD,IAAI+O,iBAAiB,GAAG/O,GAAG,CAACA,GAAG,CAAC,QAAQ,CAAC,KAAKzH,SAAS;MACvD,IAAIyW,OAAO,GAAG,CAACD,iBAAiB,IAAIha,QAAQ,CAACkO,KAAK,CAACgM,WAAW,CAACzE,OAAO,CAACxK,GAAG,CAACA,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC;MAC9F,IAAI,CAACgP,OAAO,EAAE;QACV;MACJ;MACA,IAAI,IAAI,CAACnO,UAAU,EAAE,EAAE;QACnB;MACJ;MACA,IAAIqO,gBAAgB,GAAG,KAAK;MAC5Bla,aAAa,CAAC+L,EAAE,CAACC,aAAa,CAACjE,OAAO,CAAE6F,IAAI,IAAK;QAC7C,IAAI,IAAI,CAAC4F,YAAY,CAAC5F,IAAI,CAACE,IAAI,CAAC,EAAE;UAC9BoM,gBAAgB,GAAG,IAAI;QAC3B;MACJ,CAAC,CAAC;MACF,IAAI,CAACA,gBAAgB,EAAE;QACnB,IAAI,CAACvB,kBAAkB,CAAC3N,GAAG,CAAC;MAChC;IACJ,CAAC,CAAC;EACN;EACA4O,WAAW,GAAG;IACV,IAAI,IAAI,CAAChY,KAAK,CAAC+X,SAAS,EAAE;MACtB,IAAI,CAACE,WAAW,EAAE;IACtB,CAAC,MACI;MACD,IAAI,CAACC,YAAY,EAAE;MACnB,IAAInE,KAAK,GAAG,IAAI,CAAC3G,QAAQ,EAAE;MAC3B,IAAI,CAAC2G,KAAK,EAAE;QACR;MACJ;MACA,MAAMwE,WAAW,GAAGna,aAAa,CAAC+L,EAAE,CAACC,aAAa,CAAClJ,GAAG,CAAC,IAAI,CAACpB,GAAG,CAAC;MAChE,MAAMmK,UAAU,GAAGsO,WAAW,IAAIA,WAAW,CAACtM,UAAU,KAAK,UAAU;MACvE,MAAMuM,OAAO,GAAGD,WAAW,IAAIA,WAAW,CAACtM,UAAU,KAAK,OAAO;MACjE,IAAIhC,UAAU,EAAE;QACZ,IAAI,CAACC,QAAQ,EAAE;MACnB,CAAC,MACI,IAAIsO,OAAO,EAAE;QACdpa,aAAa,CAAC+L,EAAE,CAACC,aAAa,CAAChJ,MAAM,CAAC,IAAI,CAACtB,GAAG,CAAC;MACnD;IACJ;EACJ;EACAoY,YAAY,GAAG;IACX,IAAI,CAACnP,GAAG,CAAC,iBAAiB,CAAC;IAC3B,IAAI,CAACA,GAAG,CAAC,kBAAkB,CAAC;EAChC;EACA0P,oBAAoB,GAA0B;IAAA,IAAzBC,MAAM,uEAAG;MAAEvV,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE;IAAE,CAAC;IACxC,MAAM2Q,KAAK,GAAG,IAAI,CAAC3G,QAAQ,EAAE;IAC7B,IAAI,CAAC2G,KAAK,EAAE;MACR,OAAO,KAAK;IAChB;IACA,MAAM4E,UAAU,GAAG;MACfxV,CAAC,EAAE,CAACuV,MAAM,CAACvV,CAAC;MACZC,CAAC,EAAE,CAACsV,MAAM,CAACtV,CAAC;MACZC,KAAK,EAAE0Q,KAAK,CAAC1Q,KAAK,EAAE,GAAG,CAAC,GAAGqV,MAAM,CAACvV,CAAC;MACnCG,MAAM,EAAEyQ,KAAK,CAACzQ,MAAM,EAAE,GAAG,CAAC,GAAGoV,MAAM,CAACtV;IACxC,CAAC;IACD,OAAOrF,MAAM,CAAC+E,IAAI,CAAC8V,gBAAgB,CAACD,UAAU,EAAE,IAAI,CAACpV,aAAa,EAAE,CAAC;EACzE;EACA,OAAOsV,MAAM,CAACC,IAAI,EAAEC,SAAS,EAAE;IAC3B,IAAIhb,MAAM,CAAC+E,IAAI,CAACkW,SAAS,CAACF,IAAI,CAAC,EAAE;MAC7BA,IAAI,GAAGxH,IAAI,CAAC2H,KAAK,CAACH,IAAI,CAAC;IAC3B;IACA,OAAO,IAAI,CAACI,WAAW,CAACJ,IAAI,EAAEC,SAAS,CAAC;EAC5C;EACA,OAAOG,WAAW,CAACvI,GAAG,EAAEoI,SAAS,EAAE;IAC/B,IAAI7H,SAAS,GAAGpT,IAAI,CAACqb,SAAS,CAAChI,YAAY,CAACvP,IAAI,CAAC+O,GAAG,CAAC;MAAEpG,QAAQ,GAAGoG,GAAG,CAACpG,QAAQ;MAAE6O,EAAE;MAAE3R,GAAG;MAAEE,CAAC;IAC1F,IAAIoR,SAAS,EAAE;MACXpI,GAAG,CAAC3Q,KAAK,CAAC+Y,SAAS,GAAGA,SAAS;IACnC;IACA,IAAI,CAAC5a,QAAQ,CAACkO,KAAK,CAAC6E,SAAS,CAAC,EAAE;MAC5BnT,MAAM,CAAC+E,IAAI,CAAC+M,IAAI,CAAC,uCAAuC,GACpDqB,SAAS,GACT,yBAAyB,CAAC;MAC9BA,SAAS,GAAG,OAAO;IACvB;IACA,MAAMmI,KAAK,GAAGlb,QAAQ,CAACkO,KAAK,CAAC6E,SAAS,CAAC;IACvCkI,EAAE,GAAG,IAAIC,KAAK,CAAC1I,GAAG,CAAC3Q,KAAK,CAAC;IACzB,IAAIuK,QAAQ,EAAE;MACV9C,GAAG,GAAG8C,QAAQ,CAAC1C,MAAM;MACrB,KAAKF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,GAAG,EAAEE,CAAC,EAAE,EAAE;QACtByR,EAAE,CAAC3I,GAAG,CAAC3S,IAAI,CAACob,WAAW,CAAC3O,QAAQ,CAAC5C,CAAC,CAAC,CAAC,CAAC;MACzC;IACJ;IACA,OAAOyR,EAAE;EACb;AACJ;AACAxb,OAAO,CAACE,IAAI,GAAGA,IAAI;AACnBA,IAAI,CAACqb,SAAS,CAAChN,QAAQ,GAAG,MAAM;AAChCrO,IAAI,CAACqb,SAAS,CAACG,mBAAmB,GAAG,EAAE;AACvCxb,IAAI,CAACqb,SAAS,CAACpZ,cAAc,GAAG,CAAC,CAAC;AAClCjC,IAAI,CAACqb,SAAS,CAAC9W,EAAE,CAACT,IAAI,CAAC9D,IAAI,CAACqb,SAAS,EAAE1Z,oBAAoB,EAAE,YAAY;EACrE,IAAI,IAAI,CAACe,wBAAwB,EAAE;IAC/B,IAAI,CAACC,wBAAwB,GAAG,IAAI;IACpC;EACJ;EACA,IAAI,CAACO,WAAW,CAAC1B,SAAS,CAAC;EAC3B,IAAI,CAACiD,4BAA4B,CAAC/D,kBAAkB,CAAC;AACzD,CAAC,CAAC;AACFV,IAAI,CAACqb,SAAS,CAAC9W,EAAE,CAACT,IAAI,CAAC9D,IAAI,CAACqb,SAAS,EAAE,qBAAqB,EAAE,YAAY;EACtE,IAAI,CAAC5W,4BAA4B,CAAC/C,OAAO,CAAC;AAC9C,CAAC,CAAC;AACF1B,IAAI,CAACqb,SAAS,CAAC9W,EAAE,CAACT,IAAI,CAAC9D,IAAI,CAACqb,SAAS,EAAE,uBAAuB,EAAE,YAAY;EACxE,IAAI,CAAC5W,4BAA4B,CAACzD,SAAS,CAAC;AAChD,CAAC,CAAC;AACFhB,IAAI,CAACqb,SAAS,CAAC9W,EAAE,CAACT,IAAI,CAAC9D,IAAI,CAACqb,SAAS,EAAE,qBAAqB,EAAE,YAAY;EACtE,IAAI,CAAC5W,4BAA4B,CAACjE,gBAAgB,CAAC;AACvD,CAAC,CAAC;AACF,MAAMib,eAAe,GAAGtb,SAAS,CAACub,OAAO,CAACD,eAAe;AACzDA,eAAe,CAACzb,IAAI,EAAE,QAAQ,CAAC;AAC/Byb,eAAe,CAACzb,IAAI,EAAE,kBAAkB,CAAC;AACzCyb,eAAe,CAACzb,IAAI,EAAE,UAAU,CAAC;AACjCyb,eAAe,CAACzb,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AACrEF,eAAe,CAACzb,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AACrEF,eAAe,CAACzb,IAAI,EAAE,0BAA0B,EAAE,aAAa,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACqb,kBAAkB,GAAG,CAAC;AACxGH,eAAe,CAACzb,IAAI,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AAC3EF,eAAe,CAACzb,IAAI,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACqb,kBAAkB,GAAG,CAAC;AACzEH,eAAe,CAACzb,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACqb,kBAAkB,GAAG,CAAC;AACvEH,eAAe,CAACzb,IAAI,EAAE,UAAU,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AAC5Exb,SAAS,CAACub,OAAO,CAACG,yBAAyB,CAAC7b,IAAI,EAAE,OAAO,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AACtEyb,eAAe,CAACzb,IAAI,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AAC1EF,eAAe,CAACzb,IAAI,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AAC1Exb,SAAS,CAACub,OAAO,CAACG,yBAAyB,CAAC7b,IAAI,EAAE,MAAM,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AACrEyb,eAAe,CAACzb,IAAI,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AACzEF,eAAe,CAACzb,IAAI,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AACzExb,SAAS,CAACub,OAAO,CAACG,yBAAyB,CAAC7b,IAAI,EAAE,QAAQ,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AACvEyb,eAAe,CAACzb,IAAI,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AAC3EF,eAAe,CAACzb,IAAI,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AAC3EF,eAAe,CAACzb,IAAI,EAAE,cAAc,EAAE,IAAI,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AACnFF,eAAe,CAACzb,IAAI,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AACzEF,eAAe,CAACzb,IAAI,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACob,kBAAkB,GAAG,CAAC;AAC1EF,eAAe,CAACzb,IAAI,EAAE,WAAW,EAAE,IAAI,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACub,mBAAmB,GAAG,CAAC;AACjFL,eAAe,CAACzb,IAAI,EAAE,gBAAgB,EAAE,IAAI,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACub,mBAAmB,GAAG,CAAC;AACtFL,eAAe,CAACzb,IAAI,EAAE,SAAS,EAAE,IAAI,EAAE,UAAU8S,GAAG,EAAE;EAClD,IAAI,CAAClQ,eAAe,GAAG,KAAK;EAC5B,OAAOkQ,GAAG;AACd,CAAC,CAAC;AACF2I,eAAe,CAACzb,IAAI,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACub,mBAAmB,GAAG,CAAC;AAC/EL,eAAe,CAACzb,IAAI,EAAE,mBAAmB,EAAE,KAAK,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACqb,kBAAkB,GAAG,CAAC;AACzFH,eAAe,CAACzb,IAAI,EAAE,MAAM,CAAC;AAC7Byb,eAAe,CAACzb,IAAI,EAAE,eAAe,CAAC;AACtCyb,eAAe,CAACzb,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC,CAAC,EAAEO,YAAY,CAACub,mBAAmB,GAAG,CAAC;AAClF3b,SAAS,CAACub,OAAO,CAACK,UAAU,CAAC/b,IAAI,EAAE;EAC/Bgc,SAAS,EAAE,QAAQ;EACnBC,cAAc,EAAE,aAAa;EAC7BC,cAAc,EAAE;AACpB,CAAC,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}